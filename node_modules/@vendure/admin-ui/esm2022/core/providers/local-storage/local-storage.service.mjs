import { Injectable } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
/**
 * These keys are stored specific to a particular AdminId, so that multiple
 * admins can use the same browser without interfering with each other's data.
 */
const ADMIN_SPECIFIC_KEYS = [
    'activeTheme',
    'dashboardWidgetLayout',
    'activeTheme',
    'livePreviewCollectionContents',
    'dataTableConfig',
];
const PREFIX = 'vnd_';
/**
 * Wrapper around the browser's LocalStorage / SessionStorage object, for persisting data to the browser.
 */
export class LocalStorageService {
    constructor(location) {
        this.location = location;
        this.adminId = '__global__';
    }
    setAdminId(adminId) {
        this.adminId = adminId ?? '__global__';
    }
    /**
     * Set a key-value pair in the browser's LocalStorage
     */
    set(key, value) {
        const keyName = this.keyName(key);
        localStorage.setItem(keyName, JSON.stringify(value));
    }
    /**
     * Set a key-value pair specific to the current location (url)
     */
    setForCurrentLocation(key, value) {
        const compositeKey = this.getLocationBasedKey(key);
        this.set(compositeKey, value);
    }
    /**
     * Set a key-value pair in the browser's SessionStorage
     */
    setForSession(key, value) {
        const keyName = this.keyName(key);
        sessionStorage.setItem(keyName, JSON.stringify(value));
    }
    /**
     * Get the value of the given key from the SessionStorage or LocalStorage.
     */
    get(key) {
        const keyName = this.keyName(key);
        const item = sessionStorage.getItem(keyName) || localStorage.getItem(keyName);
        let result;
        try {
            result = JSON.parse(item || 'null');
        }
        catch (e) {
            // eslint-disable-next-line no-console
            console.error(`Could not parse the localStorage value for "${key}" (${item})`);
        }
        return result;
    }
    /**
     * Get the value of the given key for the current location (url)
     */
    getForCurrentLocation(key) {
        const compositeKey = this.getLocationBasedKey(key);
        return this.get(compositeKey);
    }
    remove(key) {
        const keyName = this.keyName(key);
        sessionStorage.removeItem(keyName);
        localStorage.removeItem(keyName);
    }
    getLocationBasedKey(key) {
        const path = this.location.path();
        return key + path;
    }
    keyName(key) {
        if (ADMIN_SPECIFIC_KEYS.includes(key)) {
            return `${PREFIX}_${this.adminId}_${key}`;
        }
        else {
            return `${PREFIX}_${key}`;
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.2.4", ngImport: i0, type: LocalStorageService, deps: [{ token: i1.Location }], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "17.2.4", ngImport: i0, type: LocalStorageService, providedIn: 'root' }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.2.4", ngImport: i0, type: LocalStorageService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root',
                }]
        }], ctorParameters: () => [{ type: i1.Location }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9jYWwtc3RvcmFnZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2xpYi9jb3JlL3NyYy9wcm92aWRlcnMvbG9jYWwtc3RvcmFnZS9sb2NhbC1zdG9yYWdlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQzs7O0FBK0IzQzs7O0dBR0c7QUFDSCxNQUFNLG1CQUFtQixHQUFxQztJQUMxRCxhQUFhO0lBQ2IsdUJBQXVCO0lBQ3ZCLGFBQWE7SUFDYiwrQkFBK0I7SUFDL0IsaUJBQWlCO0NBQ3BCLENBQUM7QUFFRixNQUFNLE1BQU0sR0FBRyxNQUFNLENBQUM7QUFFdEI7O0dBRUc7QUFJSCxNQUFNLE9BQU8sbUJBQW1CO0lBRTVCLFlBQW9CLFFBQWtCO1FBQWxCLGFBQVEsR0FBUixRQUFRLENBQVU7UUFEOUIsWUFBTyxHQUFHLFlBQVksQ0FBQztJQUNVLENBQUM7SUFFbkMsVUFBVSxDQUFDLE9BQXVCO1FBQ3JDLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxJQUFJLFlBQVksQ0FBQztJQUMzQyxDQUFDO0lBRUQ7O09BRUc7SUFDSSxHQUFHLENBQXNDLEdBQU0sRUFBRSxLQUE2QjtRQUNqRixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2xDLFlBQVksQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUN6RCxDQUFDO0lBRUQ7O09BRUc7SUFDSSxxQkFBcUIsQ0FDeEIsR0FBTSxFQUNOLEtBQTBDO1FBRTFDLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNuRCxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQW1CLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDekMsQ0FBQztJQUVEOztPQUVHO0lBQ0ksYUFBYSxDQUFzQyxHQUFNLEVBQUUsS0FBNkI7UUFDM0YsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNsQyxjQUFjLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDM0QsQ0FBQztJQUVEOztPQUVHO0lBQ0ksR0FBRyxDQUFzQyxHQUFNO1FBQ2xELE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbEMsTUFBTSxJQUFJLEdBQUcsY0FBYyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxZQUFZLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzlFLElBQUksTUFBVyxDQUFDO1FBQ2hCLElBQUksQ0FBQztZQUNELE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksSUFBSSxNQUFNLENBQUMsQ0FBQztRQUN4QyxDQUFDO1FBQUMsT0FBTyxDQUFNLEVBQUUsQ0FBQztZQUNkLHNDQUFzQztZQUN0QyxPQUFPLENBQUMsS0FBSyxDQUFDLCtDQUErQyxHQUFHLE1BQU0sSUFBSSxHQUFHLENBQUMsQ0FBQztRQUNuRixDQUFDO1FBQ0QsT0FBTyxNQUFNLENBQUM7SUFDbEIsQ0FBQztJQUVEOztPQUVHO0lBQ0kscUJBQXFCLENBQ3hCLEdBQU07UUFFTixNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbkQsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQW1CLENBQUMsQ0FBQztJQUN6QyxDQUFDO0lBRU0sTUFBTSxDQUFDLEdBQThCO1FBQ3hDLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbEMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNuQyxZQUFZLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFFTyxtQkFBbUIsQ0FBQyxHQUFXO1FBQ25DLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDbEMsT0FBTyxHQUFHLEdBQUcsSUFBSSxDQUFDO0lBQ3RCLENBQUM7SUFFTyxPQUFPLENBQUMsR0FBOEI7UUFDMUMsSUFBSSxtQkFBbUIsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUNwQyxPQUFPLEdBQUcsTUFBTSxJQUFJLElBQUksQ0FBQyxPQUFPLElBQUksR0FBRyxFQUFFLENBQUM7UUFDOUMsQ0FBQzthQUFNLENBQUM7WUFDSixPQUFPLEdBQUcsTUFBTSxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQzlCLENBQUM7SUFDTCxDQUFDOzhHQTlFUSxtQkFBbUI7a0hBQW5CLG1CQUFtQixjQUZoQixNQUFNOzsyRkFFVCxtQkFBbUI7a0JBSC9CLFVBQVU7bUJBQUM7b0JBQ1IsVUFBVSxFQUFFLE1BQU07aUJBQ3JCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTG9jYXRpb24gfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xyXG5pbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcblxyXG5pbXBvcnQgeyBMYW5ndWFnZUNvZGUgfSBmcm9tICcuLi8uLi9jb21tb24vZ2VuZXJhdGVkLXR5cGVzJztcclxuaW1wb3J0IHsgV2lkZ2V0TGF5b3V0RGVmaW5pdGlvbiB9IGZyb20gJy4uL2Rhc2hib2FyZC13aWRnZXQvZGFzaGJvYXJkLXdpZGdldC10eXBlcyc7XHJcblxyXG5leHBvcnQgdHlwZSBEYXRhVGFibGVDb25maWcgPSB7XHJcbiAgICBbaWQ6IHN0cmluZ106IHtcclxuICAgICAgICB2aXNpYmlsaXR5OiBzdHJpbmdbXTtcclxuICAgICAgICBvcmRlcjogeyBbaWQ6IHN0cmluZ106IG51bWJlciB9O1xyXG4gICAgICAgIHNob3dTZWFyY2hGaWx0ZXJSb3c6IGJvb2xlYW47XHJcbiAgICAgICAgZmlsdGVyUHJlc2V0czogQXJyYXk8eyBuYW1lOiBzdHJpbmc7IHZhbHVlOiBzdHJpbmcgfT47XHJcbiAgICB9O1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgTG9jYWxTdG9yYWdlVHlwZU1hcCA9IHtcclxuICAgIGFjdGl2ZUNoYW5uZWxUb2tlbjogc3RyaW5nO1xyXG4gICAgYXV0aFRva2VuOiBzdHJpbmc7XHJcbiAgICB1aUxhbmd1YWdlQ29kZTogTGFuZ3VhZ2VDb2RlO1xyXG4gICAgdWlMb2NhbGU6IHN0cmluZyB8IHVuZGVmaW5lZDtcclxuICAgIGNvbnRlbnRMYW5ndWFnZUNvZGU6IExhbmd1YWdlQ29kZTtcclxuICAgIGRhc2hib2FyZFdpZGdldExheW91dDogV2lkZ2V0TGF5b3V0RGVmaW5pdGlvbjtcclxuICAgIGFjdGl2ZVRoZW1lOiBzdHJpbmc7XHJcbiAgICBsaXZlUHJldmlld0NvbGxlY3Rpb25Db250ZW50czogYm9vbGVhbjtcclxuICAgIGRhdGFUYWJsZUNvbmZpZzogRGF0YVRhYmxlQ29uZmlnO1xyXG59O1xyXG5cclxuZXhwb3J0IHR5cGUgTG9jYWxTdG9yYWdlTG9jYXRpb25CYXNlZFR5cGVNYXAgPSB7XHJcbiAgICBzaGlwcGluZ1Rlc3RPcmRlcjogYW55O1xyXG4gICAgc2hpcHBpbmdUZXN0QWRkcmVzczogYW55O1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFRoZXNlIGtleXMgYXJlIHN0b3JlZCBzcGVjaWZpYyB0byBhIHBhcnRpY3VsYXIgQWRtaW5JZCwgc28gdGhhdCBtdWx0aXBsZVxyXG4gKiBhZG1pbnMgY2FuIHVzZSB0aGUgc2FtZSBicm93c2VyIHdpdGhvdXQgaW50ZXJmZXJpbmcgd2l0aCBlYWNoIG90aGVyJ3MgZGF0YS5cclxuICovXHJcbmNvbnN0IEFETUlOX1NQRUNJRklDX0tFWVM6IEFycmF5PGtleW9mIExvY2FsU3RvcmFnZVR5cGVNYXA+ID0gW1xyXG4gICAgJ2FjdGl2ZVRoZW1lJyxcclxuICAgICdkYXNoYm9hcmRXaWRnZXRMYXlvdXQnLFxyXG4gICAgJ2FjdGl2ZVRoZW1lJyxcclxuICAgICdsaXZlUHJldmlld0NvbGxlY3Rpb25Db250ZW50cycsXHJcbiAgICAnZGF0YVRhYmxlQ29uZmlnJyxcclxuXTtcclxuXHJcbmNvbnN0IFBSRUZJWCA9ICd2bmRfJztcclxuXHJcbi8qKlxyXG4gKiBXcmFwcGVyIGFyb3VuZCB0aGUgYnJvd3NlcidzIExvY2FsU3RvcmFnZSAvIFNlc3Npb25TdG9yYWdlIG9iamVjdCwgZm9yIHBlcnNpc3RpbmcgZGF0YSB0byB0aGUgYnJvd3Nlci5cclxuICovXHJcbkBJbmplY3RhYmxlKHtcclxuICAgIHByb3ZpZGVkSW46ICdyb290JyxcclxufSlcclxuZXhwb3J0IGNsYXNzIExvY2FsU3RvcmFnZVNlcnZpY2Uge1xyXG4gICAgcHJpdmF0ZSBhZG1pbklkID0gJ19fZ2xvYmFsX18nO1xyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBsb2NhdGlvbjogTG9jYXRpb24pIHt9XHJcblxyXG4gICAgcHVibGljIHNldEFkbWluSWQoYWRtaW5JZD86IHN0cmluZyB8IG51bGwpIHtcclxuICAgICAgICB0aGlzLmFkbWluSWQgPSBhZG1pbklkID8/ICdfX2dsb2JhbF9fJztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFNldCBhIGtleS12YWx1ZSBwYWlyIGluIHRoZSBicm93c2VyJ3MgTG9jYWxTdG9yYWdlXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzZXQ8SyBleHRlbmRzIGtleW9mIExvY2FsU3RvcmFnZVR5cGVNYXA+KGtleTogSywgdmFsdWU6IExvY2FsU3RvcmFnZVR5cGVNYXBbS10pOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBrZXlOYW1lID0gdGhpcy5rZXlOYW1lKGtleSk7XHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5TmFtZSwgSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFNldCBhIGtleS12YWx1ZSBwYWlyIHNwZWNpZmljIHRvIHRoZSBjdXJyZW50IGxvY2F0aW9uICh1cmwpXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBzZXRGb3JDdXJyZW50TG9jYXRpb248SyBleHRlbmRzIGtleW9mIExvY2FsU3RvcmFnZUxvY2F0aW9uQmFzZWRUeXBlTWFwPihcclxuICAgICAgICBrZXk6IEssXHJcbiAgICAgICAgdmFsdWU6IExvY2FsU3RvcmFnZUxvY2F0aW9uQmFzZWRUeXBlTWFwW0tdLFxyXG4gICAgKSB7XHJcbiAgICAgICAgY29uc3QgY29tcG9zaXRlS2V5ID0gdGhpcy5nZXRMb2NhdGlvbkJhc2VkS2V5KGtleSk7XHJcbiAgICAgICAgdGhpcy5zZXQoY29tcG9zaXRlS2V5IGFzIGFueSwgdmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogU2V0IGEga2V5LXZhbHVlIHBhaXIgaW4gdGhlIGJyb3dzZXIncyBTZXNzaW9uU3RvcmFnZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgc2V0Rm9yU2Vzc2lvbjxLIGV4dGVuZHMga2V5b2YgTG9jYWxTdG9yYWdlVHlwZU1hcD4oa2V5OiBLLCB2YWx1ZTogTG9jYWxTdG9yYWdlVHlwZU1hcFtLXSk6IHZvaWQge1xyXG4gICAgICAgIGNvbnN0IGtleU5hbWUgPSB0aGlzLmtleU5hbWUoa2V5KTtcclxuICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKGtleU5hbWUsIEpTT04uc3RyaW5naWZ5KHZhbHVlKSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXQgdGhlIHZhbHVlIG9mIHRoZSBnaXZlbiBrZXkgZnJvbSB0aGUgU2Vzc2lvblN0b3JhZ2Ugb3IgTG9jYWxTdG9yYWdlLlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZ2V0PEsgZXh0ZW5kcyBrZXlvZiBMb2NhbFN0b3JhZ2VUeXBlTWFwPihrZXk6IEspOiBMb2NhbFN0b3JhZ2VUeXBlTWFwW0tdIHwgbnVsbCB7XHJcbiAgICAgICAgY29uc3Qga2V5TmFtZSA9IHRoaXMua2V5TmFtZShrZXkpO1xyXG4gICAgICAgIGNvbnN0IGl0ZW0gPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKGtleU5hbWUpIHx8IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleU5hbWUpO1xyXG4gICAgICAgIGxldCByZXN1bHQ6IGFueTtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICByZXN1bHQgPSBKU09OLnBhcnNlKGl0ZW0gfHwgJ251bGwnKTtcclxuICAgICAgICB9IGNhdGNoIChlOiBhbnkpIHtcclxuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgQ291bGQgbm90IHBhcnNlIHRoZSBsb2NhbFN0b3JhZ2UgdmFsdWUgZm9yIFwiJHtrZXl9XCIgKCR7aXRlbX0pYCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXQgdGhlIHZhbHVlIG9mIHRoZSBnaXZlbiBrZXkgZm9yIHRoZSBjdXJyZW50IGxvY2F0aW9uICh1cmwpXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRGb3JDdXJyZW50TG9jYXRpb248SyBleHRlbmRzIGtleW9mIExvY2FsU3RvcmFnZUxvY2F0aW9uQmFzZWRUeXBlTWFwPihcclxuICAgICAgICBrZXk6IEssXHJcbiAgICApOiBMb2NhbFN0b3JhZ2VMb2NhdGlvbkJhc2VkVHlwZU1hcFtLXSB7XHJcbiAgICAgICAgY29uc3QgY29tcG9zaXRlS2V5ID0gdGhpcy5nZXRMb2NhdGlvbkJhc2VkS2V5KGtleSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KGNvbXBvc2l0ZUtleSBhcyBhbnkpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyByZW1vdmUoa2V5OiBrZXlvZiBMb2NhbFN0b3JhZ2VUeXBlTWFwKTogdm9pZCB7XHJcbiAgICAgICAgY29uc3Qga2V5TmFtZSA9IHRoaXMua2V5TmFtZShrZXkpO1xyXG4gICAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oa2V5TmFtZSk7XHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5TmFtZSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBnZXRMb2NhdGlvbkJhc2VkS2V5KGtleTogc3RyaW5nKSB7XHJcbiAgICAgICAgY29uc3QgcGF0aCA9IHRoaXMubG9jYXRpb24ucGF0aCgpO1xyXG4gICAgICAgIHJldHVybiBrZXkgKyBwYXRoO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUga2V5TmFtZShrZXk6IGtleW9mIExvY2FsU3RvcmFnZVR5cGVNYXApOiBzdHJpbmcge1xyXG4gICAgICAgIGlmIChBRE1JTl9TUEVDSUZJQ19LRVlTLmluY2x1ZGVzKGtleSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGAke1BSRUZJWH1fJHt0aGlzLmFkbWluSWR9XyR7a2V5fWA7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIGAke1BSRUZJWH1fJHtrZXl9YDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuIl19