import { ChangeDetectionStrategy, Component } from '@angular/core';
import { Subject, finalize, take, takeUntil } from 'rxjs';
import { CurrencyCode } from '../../common/generated-types';
import * as i0 from "@angular/core";
import * as i1 from "../../data/providers/data.service";
import * as i2 from "@angular/common";
import * as i3 from "@angular/forms";
import * as i4 from "@ng-select/ng-select";
import * as i5 from "../../shared/components/form-field/form-field.component";
import * as i6 from "../../shared/components/form-field/form-field-control.directive";
import * as i7 from "../../shared/components/modal-dialog/dialog-buttons.directive";
import * as i8 from "../../shared/components/modal-dialog/dialog-title.directive";
import * as i9 from "../../shared/components/labeled-data/labeled-data.component";
import * as i10 from "@ngx-translate/core";
import * as i11 from "../../shared/pipes/locale-currency-name.pipe";
import * as i12 from "../../shared/pipes/sort.pipe";
import * as i13 from "../../shared/pipes/locale-date.pipe";
import * as i14 from "../../shared/pipes/locale-currency.pipe";
import * as i15 from "../../shared/pipes/locale-language-name.pipe";
import * as i16 from "../../shared/pipes/locale-region-name.pipe";
export class UiLanguageSwitcherDialogComponent {
    constructor(dataService, changeDetector) {
        this.dataService = dataService;
        this.changeDetector = changeDetector;
        this.isLoading = true;
        this.destroy$ = new Subject();
        this.availableLanguages = [];
        this.availableLocales = [];
        this.availableCurrencyCodes = Object.values(CurrencyCode);
        this.now = new Date().toISOString();
        const browserLanguage = navigator.language.split('-');
        this.browserDefaultLocale = browserLanguage.length === 1 ? undefined : browserLanguage[1];
    }
    ngOnInit() {
        this.updatePreviewLocale();
        this.dataService.settings
            .getActiveChannel()
            .mapStream(data => data.activeChannel.defaultCurrencyCode)
            .pipe(take(1), takeUntil(this.destroy$), finalize(() => {
            this.isLoading = false;
            this.changeDetector.markForCheck();
        }))
            .subscribe(x => {
            this.selectedCurrencyCode = x;
        });
    }
    ngOnDestroy() {
        this.destroy$.next();
        this.destroy$.complete();
    }
    updatePreviewLocale() {
        if (!this.currentLocale || this.currentLocale.length === 0 || this.currentLocale.length === 2) {
            this.previewLocale = this.createLocaleString(this.currentLanguage, this.currentLocale);
        }
    }
    setLanguage() {
        this.resolveWith([this.currentLanguage, this.currentLocale?.toUpperCase()]);
    }
    cancel() {
        this.resolveWith();
    }
    createLocaleString(languageCode, region) {
        if (!region) {
            return languageCode;
        }
        return [languageCode, region.toUpperCase()].join('-');
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.2.4", ngImport: i0, type: UiLanguageSwitcherDialogComponent, deps: [{ token: i1.DataService }, { token: i0.ChangeDetectorRef }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "17.2.4", type: UiLanguageSwitcherDialogComponent, selector: "vdr-ui-language-switcher", ngImport: i0, template: "<ng-template vdrDialogTitle>{{ 'common.select-display-language' | translate }}</ng-template>\r\n\r\n<ng-container *ngIf=\"isLoading\">\r\n    <div class=\"progress loop\"></div>\r\n</ng-container>\r\n\r\n<ng-container *ngIf=\"!isLoading\">\r\n    <div class=\"clr-row\">\r\n        <div class=\"flex pl-2 mb-2\">\r\n            <vdr-form-field [label]=\"'common.language' | translate\" class=\"mr-2\">\r\n                <select name=\"options\" [(ngModel)]=\"currentLanguage\" (ngModelChange)=\"updatePreviewLocale()\">\r\n                    <option *ngFor=\"let code of availableLanguages | sort\" [value]=\"code\">\r\n                        {{ code | uppercase }} ({{ code | localeLanguageName }})\r\n                    </option>\r\n                </select>\r\n            </vdr-form-field>\r\n            <vdr-form-field [label]=\"'common.locale' | translate\">\r\n                <ng-select appendTo=\"body\" [items]=\"availableLocales\" [(ngModel)]=\"currentLocale\"\r\n                    (ngModelChange)=\"updatePreviewLocale()\" [placeholder]=\"'common.browser-default' | translate\">\r\n                    <ng-template ng-label-tmp let-item=\"item\" let-clear=\"clear\">\r\n                        {{ item }} ({{ item | localeRegionName }})\r\n                    </ng-template>\r\n                    <ng-template ng-option-tmp let-item=\"item\">\r\n                        {{ item }} ({{ item | localeRegionName }})\r\n                    </ng-template>\r\n                </ng-select>\r\n            </vdr-form-field>\r\n        </div>\r\n    </div>\r\n    <div class=\"card\">\r\n        <div class=\"card-header\">\r\n            <span class=\"pr-1\">{{ 'common.sample-formatting' | translate }}:</span><strong>{{ previewLocale |\r\n                localeLanguageName : previewLocale }}</strong>\r\n        </div>\r\n        <div class=\"card-block\">\r\n            <div class=\"clr-row\">\r\n                <div class=\"clr-col-sm-4\">\r\n                    <vdr-labeled-data [label]=\"'common.medium-date' | translate\">\r\n                        {{ now | localeDate : 'medium' : previewLocale }}\r\n                    </vdr-labeled-data>\r\n                    <vdr-labeled-data [label]=\"'common.short-date' | translate\">\r\n                        {{ now | localeDate : 'short' : previewLocale }}\r\n                    </vdr-labeled-data>\r\n                </div>\r\n                <div class=\"clr-col-sm-4\">\r\n                    <select name=\"currency\" class=\"currency\" [(ngModel)]=\"selectedCurrencyCode\">\r\n                        <option *ngFor=\"let code of availableCurrencyCodes | sort\" [value]=\"code\">\r\n                            {{ code | uppercase }} ({{ code | localeCurrencyName : 'full' : previewLocale }})\r\n                        </option>\r\n                    </select>\r\n                </div>\r\n                <div class=\"clr-col-sm-4\">\r\n                    <vdr-labeled-data [label]=\"'common.price' | translate\">\r\n                        {{ 12345 | localeCurrency : selectedCurrencyCode : previewLocale }}\r\n                    </vdr-labeled-data>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</ng-container>\r\n\r\n<ng-template vdrDialogButtons>\r\n    <button type=\"button\" class=\"btn\" (click)=\"cancel()\">{{ 'common.cancel' | translate }}</button>\r\n    <button type=\"submit\" (click)=\"setLanguage()\" class=\"btn btn-primary\">\r\n        {{ 'common.set-language' | translate }}\r\n    </button>\r\n</ng-template>", styles: ["select.currency{max-width:200px}input.locale{text-transform:uppercase}\n"], dependencies: [{ kind: "directive", type: i2.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i2.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i3.NgSelectOption, selector: "option", inputs: ["ngValue", "value"] }, { kind: "directive", type: i3.ɵNgSelectMultipleOption, selector: "option", inputs: ["ngValue", "value"] }, { kind: "directive", type: i3.SelectControlValueAccessor, selector: "select:not([multiple])[formControlName],select:not([multiple])[formControl],select:not([multiple])[ngModel]", inputs: ["compareWith"] }, { kind: "directive", type: i3.NgControlStatus, selector: "[formControlName],[ngModel],[formControl]" }, { kind: "directive", type: i3.NgModel, selector: "[ngModel]:not([formControlName]):not([formControl])", inputs: ["name", "disabled", "ngModel", "ngModelOptions"], outputs: ["ngModelChange"], exportAs: ["ngModel"] }, { kind: "component", type: i4.NgSelectComponent, selector: "ng-select", inputs: ["bindLabel", "bindValue", "markFirst", "placeholder", "notFoundText", "typeToSearchText", "addTagText", "loadingText", "clearAllText", "appearance", "dropdownPosition", "appendTo", "loading", "closeOnSelect", "hideSelected", "selectOnTab", "openOnEnter", "maxSelectedItems", "groupBy", "groupValue", "bufferAmount", "virtualScroll", "selectableGroup", "selectableGroupAsModel", "searchFn", "trackByFn", "clearOnBackspace", "labelForId", "inputAttrs", "tabIndex", "readonly", "searchWhileComposing", "minTermLength", "editableSearchTerm", "keyDownFn", "typeahead", "multiple", "addTag", "searchable", "clearable", "isOpen", "items", "compareWith", "clearSearchOnAdd", "deselectOnClick"], outputs: ["blur", "focus", "change", "open", "close", "search", "clear", "add", "remove", "scroll", "scrollToEnd"] }, { kind: "directive", type: i4.NgOptionTemplateDirective, selector: "[ng-option-tmp]" }, { kind: "directive", type: i4.NgLabelTemplateDirective, selector: "[ng-label-tmp]" }, { kind: "component", type: i5.FormFieldComponent, selector: "vdr-form-field", inputs: ["label", "for", "tooltip", "errors", "readOnlyToggle"], outputs: ["readOnlyToggleChange"] }, { kind: "directive", type: i6.FormFieldControlDirective, selector: "input, textarea, select, vdr-currency-input" }, { kind: "directive", type: i7.DialogButtonsDirective, selector: "[vdrDialogButtons]" }, { kind: "directive", type: i8.DialogTitleDirective, selector: "[vdrDialogTitle]" }, { kind: "component", type: i9.LabeledDataComponent, selector: "vdr-labeled-data", inputs: ["label"] }, { kind: "pipe", type: i2.UpperCasePipe, name: "uppercase" }, { kind: "pipe", type: i10.TranslatePipe, name: "translate" }, { kind: "pipe", type: i11.LocaleCurrencyNamePipe, name: "localeCurrencyName" }, { kind: "pipe", type: i12.SortPipe, name: "sort" }, { kind: "pipe", type: i13.LocaleDatePipe, name: "localeDate" }, { kind: "pipe", type: i14.LocaleCurrencyPipe, name: "localeCurrency" }, { kind: "pipe", type: i15.LocaleLanguageNamePipe, name: "localeLanguageName" }, { kind: "pipe", type: i16.LocaleRegionNamePipe, name: "localeRegionName" }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.2.4", ngImport: i0, type: UiLanguageSwitcherDialogComponent, decorators: [{
            type: Component,
            args: [{ selector: 'vdr-ui-language-switcher', changeDetection: ChangeDetectionStrategy.OnPush, template: "<ng-template vdrDialogTitle>{{ 'common.select-display-language' | translate }}</ng-template>\r\n\r\n<ng-container *ngIf=\"isLoading\">\r\n    <div class=\"progress loop\"></div>\r\n</ng-container>\r\n\r\n<ng-container *ngIf=\"!isLoading\">\r\n    <div class=\"clr-row\">\r\n        <div class=\"flex pl-2 mb-2\">\r\n            <vdr-form-field [label]=\"'common.language' | translate\" class=\"mr-2\">\r\n                <select name=\"options\" [(ngModel)]=\"currentLanguage\" (ngModelChange)=\"updatePreviewLocale()\">\r\n                    <option *ngFor=\"let code of availableLanguages | sort\" [value]=\"code\">\r\n                        {{ code | uppercase }} ({{ code | localeLanguageName }})\r\n                    </option>\r\n                </select>\r\n            </vdr-form-field>\r\n            <vdr-form-field [label]=\"'common.locale' | translate\">\r\n                <ng-select appendTo=\"body\" [items]=\"availableLocales\" [(ngModel)]=\"currentLocale\"\r\n                    (ngModelChange)=\"updatePreviewLocale()\" [placeholder]=\"'common.browser-default' | translate\">\r\n                    <ng-template ng-label-tmp let-item=\"item\" let-clear=\"clear\">\r\n                        {{ item }} ({{ item | localeRegionName }})\r\n                    </ng-template>\r\n                    <ng-template ng-option-tmp let-item=\"item\">\r\n                        {{ item }} ({{ item | localeRegionName }})\r\n                    </ng-template>\r\n                </ng-select>\r\n            </vdr-form-field>\r\n        </div>\r\n    </div>\r\n    <div class=\"card\">\r\n        <div class=\"card-header\">\r\n            <span class=\"pr-1\">{{ 'common.sample-formatting' | translate }}:</span><strong>{{ previewLocale |\r\n                localeLanguageName : previewLocale }}</strong>\r\n        </div>\r\n        <div class=\"card-block\">\r\n            <div class=\"clr-row\">\r\n                <div class=\"clr-col-sm-4\">\r\n                    <vdr-labeled-data [label]=\"'common.medium-date' | translate\">\r\n                        {{ now | localeDate : 'medium' : previewLocale }}\r\n                    </vdr-labeled-data>\r\n                    <vdr-labeled-data [label]=\"'common.short-date' | translate\">\r\n                        {{ now | localeDate : 'short' : previewLocale }}\r\n                    </vdr-labeled-data>\r\n                </div>\r\n                <div class=\"clr-col-sm-4\">\r\n                    <select name=\"currency\" class=\"currency\" [(ngModel)]=\"selectedCurrencyCode\">\r\n                        <option *ngFor=\"let code of availableCurrencyCodes | sort\" [value]=\"code\">\r\n                            {{ code | uppercase }} ({{ code | localeCurrencyName : 'full' : previewLocale }})\r\n                        </option>\r\n                    </select>\r\n                </div>\r\n                <div class=\"clr-col-sm-4\">\r\n                    <vdr-labeled-data [label]=\"'common.price' | translate\">\r\n                        {{ 12345 | localeCurrency : selectedCurrencyCode : previewLocale }}\r\n                    </vdr-labeled-data>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</ng-container>\r\n\r\n<ng-template vdrDialogButtons>\r\n    <button type=\"button\" class=\"btn\" (click)=\"cancel()\">{{ 'common.cancel' | translate }}</button>\r\n    <button type=\"submit\" (click)=\"setLanguage()\" class=\"btn btn-primary\">\r\n        {{ 'common.set-language' | translate }}\r\n    </button>\r\n</ng-template>", styles: ["select.currency{max-width:200px}input.locale{text-transform:uppercase}\n"] }]
        }], ctorParameters: () => [{ type: i1.DataService }, { type: i0.ChangeDetectorRef }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidWktbGFuZ3VhZ2Utc3dpdGNoZXItZGlhbG9nLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29yZS9zcmMvY29tcG9uZW50cy91aS1sYW5ndWFnZS1zd2l0Y2hlci1kaWFsb2cvdWktbGFuZ3VhZ2Utc3dpdGNoZXItZGlhbG9nLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29yZS9zcmMvY29tcG9uZW50cy91aS1sYW5ndWFnZS1zd2l0Y2hlci1kaWFsb2cvdWktbGFuZ3VhZ2Utc3dpdGNoZXItZGlhbG9nLmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSx1QkFBdUIsRUFBcUIsU0FBUyxFQUFxQixNQUFNLGVBQWUsQ0FBQztBQUV6RyxPQUFPLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQzFELE9BQU8sRUFBRSxZQUFZLEVBQWdCLE1BQU0sOEJBQThCLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQVcxRSxNQUFNLE9BQU8saUNBQWlDO0lBZ0IxQyxZQUFvQixXQUF3QixFQUFVLGNBQWlDO1FBQW5FLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBQVUsbUJBQWMsR0FBZCxjQUFjLENBQW1CO1FBYnZGLGNBQVMsR0FBRyxJQUFJLENBQUM7UUFDVCxhQUFRLEdBQUcsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQUd2Qyx1QkFBa0IsR0FBbUIsRUFBRSxDQUFDO1FBRXhDLHFCQUFnQixHQUFhLEVBQUUsQ0FBQztRQUNoQywyQkFBc0IsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBSTVDLFFBQUcsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBR3BDLE1BQU0sZUFBZSxHQUFHLFNBQVMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3RELElBQUksQ0FBQyxvQkFBb0IsR0FBRyxlQUFlLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDOUYsQ0FBQztJQUVELFFBQVE7UUFDSixJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztRQUUzQixJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVE7YUFDcEIsZ0JBQWdCLEVBQUU7YUFDbEIsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxtQkFBbUIsQ0FBQzthQUN6RCxJQUFJLENBQ0QsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUNQLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQ3hCLFFBQVEsQ0FBQyxHQUFHLEVBQUU7WUFDVixJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztZQUN2QixJQUFJLENBQUMsY0FBYyxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3ZDLENBQUMsQ0FBQyxDQUNMO2FBQ0EsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFO1lBQ1gsSUFBSSxDQUFDLG9CQUFvQixHQUFHLENBQUMsQ0FBQztRQUNsQyxDQUFDLENBQUMsQ0FBQztJQUNYLENBQUM7SUFFRCxXQUFXO1FBQ1AsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNyQixJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFFRCxtQkFBbUI7UUFDZixJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sS0FBSyxDQUFDLElBQUksSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7WUFDNUYsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDM0YsQ0FBQztJQUNMLENBQUM7SUFFRCxXQUFXO1FBQ1AsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsSUFBSSxDQUFDLGFBQWEsRUFBRSxXQUFXLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDaEYsQ0FBQztJQUVELE1BQU07UUFDRixJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7SUFDdkIsQ0FBQztJQUVPLGtCQUFrQixDQUFDLFlBQTBCLEVBQUUsTUFBc0I7UUFDekUsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ1YsT0FBTyxZQUFZLENBQUM7UUFDeEIsQ0FBQztRQUNELE9BQU8sQ0FBQyxZQUFZLEVBQUUsTUFBTSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzFELENBQUM7OEdBaEVRLGlDQUFpQztrR0FBakMsaUNBQWlDLGdFQ2Q5Qyw4OUdBa0VjOzsyRkRwREQsaUNBQWlDO2tCQU43QyxTQUFTOytCQUNJLDBCQUEwQixtQkFHbkIsdUJBQXVCLENBQUMsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBPbkRlc3Ryb3ksIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5cclxuaW1wb3J0IHsgU3ViamVjdCwgZmluYWxpemUsIHRha2UsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBDdXJyZW5jeUNvZGUsIExhbmd1YWdlQ29kZSB9IGZyb20gJy4uLy4uL2NvbW1vbi9nZW5lcmF0ZWQtdHlwZXMnO1xyXG5pbXBvcnQgeyBEaWFsb2cgfSBmcm9tICcuLi8uLi9wcm92aWRlcnMvbW9kYWwvbW9kYWwudHlwZXMnO1xyXG5pbXBvcnQgeyBEYXRhU2VydmljZSB9IGZyb20gJy4uLy4uL2RhdGEvcHJvdmlkZXJzL2RhdGEuc2VydmljZSc7XHJcbmltcG9ydCB7IGdldEFwcENvbmZpZyB9IGZyb20gJy4uLy4uL2FwcC5jb25maWcnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ3Zkci11aS1sYW5ndWFnZS1zd2l0Y2hlcicsXHJcbiAgICB0ZW1wbGF0ZVVybDogJy4vdWktbGFuZ3VhZ2Utc3dpdGNoZXItZGlhbG9nLmNvbXBvbmVudC5odG1sJyxcclxuICAgIHN0eWxlVXJsczogWycuL3VpLWxhbmd1YWdlLXN3aXRjaGVyLWRpYWxvZy5jb21wb25lbnQuc2NzcyddLFxyXG4gICAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBVaUxhbmd1YWdlU3dpdGNoZXJEaWFsb2dDb21wb25lbnRcclxuICAgIGltcGxlbWVudHMgRGlhbG9nPFtMYW5ndWFnZUNvZGUsIHN0cmluZyB8IHVuZGVmaW5lZF0+LCBPbkluaXQsIE9uRGVzdHJveVxyXG57XHJcbiAgICBpc0xvYWRpbmcgPSB0cnVlO1xyXG4gICAgcHJpdmF0ZSBkZXN0cm95JCA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XHJcbiAgICByZXNvbHZlV2l0aDogKHJlc3VsdD86IFtMYW5ndWFnZUNvZGUsIHN0cmluZyB8IHVuZGVmaW5lZF0pID0+IHZvaWQ7XHJcbiAgICBjdXJyZW50TGFuZ3VhZ2U6IExhbmd1YWdlQ29kZTtcclxuICAgIGF2YWlsYWJsZUxhbmd1YWdlczogTGFuZ3VhZ2VDb2RlW10gPSBbXTtcclxuICAgIGN1cnJlbnRMb2NhbGU6IHN0cmluZyB8IHVuZGVmaW5lZDtcclxuICAgIGF2YWlsYWJsZUxvY2FsZXM6IHN0cmluZ1tdID0gW107XHJcbiAgICBhdmFpbGFibGVDdXJyZW5jeUNvZGVzID0gT2JqZWN0LnZhbHVlcyhDdXJyZW5jeUNvZGUpO1xyXG4gICAgc2VsZWN0ZWRDdXJyZW5jeUNvZGU6IHN0cmluZztcclxuICAgIHByZXZpZXdMb2NhbGU6IHN0cmluZztcclxuICAgIHJlYWRvbmx5IGJyb3dzZXJEZWZhdWx0TG9jYWxlOiBzdHJpbmcgfCB1bmRlZmluZWQ7XHJcbiAgICByZWFkb25seSBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XHJcblxyXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBkYXRhU2VydmljZTogRGF0YVNlcnZpY2UsIHByaXZhdGUgY2hhbmdlRGV0ZWN0b3I6IENoYW5nZURldGVjdG9yUmVmKSB7XHJcbiAgICAgICAgY29uc3QgYnJvd3Nlckxhbmd1YWdlID0gbmF2aWdhdG9yLmxhbmd1YWdlLnNwbGl0KCctJyk7XHJcbiAgICAgICAgdGhpcy5icm93c2VyRGVmYXVsdExvY2FsZSA9IGJyb3dzZXJMYW5ndWFnZS5sZW5ndGggPT09IDEgPyB1bmRlZmluZWQgOiBicm93c2VyTGFuZ3VhZ2VbMV07XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgdGhpcy51cGRhdGVQcmV2aWV3TG9jYWxlKCk7XHJcblxyXG4gICAgICAgIHRoaXMuZGF0YVNlcnZpY2Uuc2V0dGluZ3NcclxuICAgICAgICAgICAgLmdldEFjdGl2ZUNoYW5uZWwoKVxyXG4gICAgICAgICAgICAubWFwU3RyZWFtKGRhdGEgPT4gZGF0YS5hY3RpdmVDaGFubmVsLmRlZmF1bHRDdXJyZW5jeUNvZGUpXHJcbiAgICAgICAgICAgIC5waXBlKFxyXG4gICAgICAgICAgICAgICAgdGFrZSgxKSxcclxuICAgICAgICAgICAgICAgIHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSxcclxuICAgICAgICAgICAgICAgIGZpbmFsaXplKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3IubWFya0ZvckNoZWNrKCk7XHJcbiAgICAgICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICAuc3Vic2NyaWJlKHggPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZEN1cnJlbmN5Q29kZSA9IHg7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgICAgIHRoaXMuZGVzdHJveSQubmV4dCgpO1xyXG4gICAgICAgIHRoaXMuZGVzdHJveSQuY29tcGxldGUoKTtcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVQcmV2aWV3TG9jYWxlKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5jdXJyZW50TG9jYWxlIHx8IHRoaXMuY3VycmVudExvY2FsZS5sZW5ndGggPT09IDAgfHwgdGhpcy5jdXJyZW50TG9jYWxlLmxlbmd0aCA9PT0gMikge1xyXG4gICAgICAgICAgICB0aGlzLnByZXZpZXdMb2NhbGUgPSB0aGlzLmNyZWF0ZUxvY2FsZVN0cmluZyh0aGlzLmN1cnJlbnRMYW5ndWFnZSwgdGhpcy5jdXJyZW50TG9jYWxlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgc2V0TGFuZ3VhZ2UoKSB7XHJcbiAgICAgICAgdGhpcy5yZXNvbHZlV2l0aChbdGhpcy5jdXJyZW50TGFuZ3VhZ2UsIHRoaXMuY3VycmVudExvY2FsZT8udG9VcHBlckNhc2UoKV0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNhbmNlbCgpIHtcclxuICAgICAgICB0aGlzLnJlc29sdmVXaXRoKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBjcmVhdGVMb2NhbGVTdHJpbmcobGFuZ3VhZ2VDb2RlOiBMYW5ndWFnZUNvZGUsIHJlZ2lvbj86IHN0cmluZyB8IG51bGwpOiBzdHJpbmcge1xyXG4gICAgICAgIGlmICghcmVnaW9uKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBsYW5ndWFnZUNvZGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBbbGFuZ3VhZ2VDb2RlLCByZWdpb24udG9VcHBlckNhc2UoKV0uam9pbignLScpO1xyXG4gICAgfVxyXG59XHJcbiIsIjxuZy10ZW1wbGF0ZSB2ZHJEaWFsb2dUaXRsZT57eyAnY29tbW9uLnNlbGVjdC1kaXNwbGF5LWxhbmd1YWdlJyB8IHRyYW5zbGF0ZSB9fTwvbmctdGVtcGxhdGU+XHJcblxyXG48bmctY29udGFpbmVyICpuZ0lmPVwiaXNMb2FkaW5nXCI+XHJcbiAgICA8ZGl2IGNsYXNzPVwicHJvZ3Jlc3MgbG9vcFwiPjwvZGl2PlxyXG48L25nLWNvbnRhaW5lcj5cclxuXHJcbjxuZy1jb250YWluZXIgKm5nSWY9XCIhaXNMb2FkaW5nXCI+XHJcbiAgICA8ZGl2IGNsYXNzPVwiY2xyLXJvd1wiPlxyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJmbGV4IHBsLTIgbWItMlwiPlxyXG4gICAgICAgICAgICA8dmRyLWZvcm0tZmllbGQgW2xhYmVsXT1cIidjb21tb24ubGFuZ3VhZ2UnIHwgdHJhbnNsYXRlXCIgY2xhc3M9XCJtci0yXCI+XHJcbiAgICAgICAgICAgICAgICA8c2VsZWN0IG5hbWU9XCJvcHRpb25zXCIgWyhuZ01vZGVsKV09XCJjdXJyZW50TGFuZ3VhZ2VcIiAobmdNb2RlbENoYW5nZSk9XCJ1cGRhdGVQcmV2aWV3TG9jYWxlKClcIj5cclxuICAgICAgICAgICAgICAgICAgICA8b3B0aW9uICpuZ0Zvcj1cImxldCBjb2RlIG9mIGF2YWlsYWJsZUxhbmd1YWdlcyB8IHNvcnRcIiBbdmFsdWVdPVwiY29kZVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7eyBjb2RlIHwgdXBwZXJjYXNlIH19ICh7eyBjb2RlIHwgbG9jYWxlTGFuZ3VhZ2VOYW1lIH19KVxyXG4gICAgICAgICAgICAgICAgICAgIDwvb3B0aW9uPlxyXG4gICAgICAgICAgICAgICAgPC9zZWxlY3Q+XHJcbiAgICAgICAgICAgIDwvdmRyLWZvcm0tZmllbGQ+XHJcbiAgICAgICAgICAgIDx2ZHItZm9ybS1maWVsZCBbbGFiZWxdPVwiJ2NvbW1vbi5sb2NhbGUnIHwgdHJhbnNsYXRlXCI+XHJcbiAgICAgICAgICAgICAgICA8bmctc2VsZWN0IGFwcGVuZFRvPVwiYm9keVwiIFtpdGVtc109XCJhdmFpbGFibGVMb2NhbGVzXCIgWyhuZ01vZGVsKV09XCJjdXJyZW50TG9jYWxlXCJcclxuICAgICAgICAgICAgICAgICAgICAobmdNb2RlbENoYW5nZSk9XCJ1cGRhdGVQcmV2aWV3TG9jYWxlKClcIiBbcGxhY2Vob2xkZXJdPVwiJ2NvbW1vbi5icm93c2VyLWRlZmF1bHQnIHwgdHJhbnNsYXRlXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgPG5nLXRlbXBsYXRlIG5nLWxhYmVsLXRtcCBsZXQtaXRlbT1cIml0ZW1cIiBsZXQtY2xlYXI9XCJjbGVhclwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7eyBpdGVtIH19ICh7eyBpdGVtIHwgbG9jYWxlUmVnaW9uTmFtZSB9fSlcclxuICAgICAgICAgICAgICAgICAgICA8L25nLXRlbXBsYXRlPlxyXG4gICAgICAgICAgICAgICAgICAgIDxuZy10ZW1wbGF0ZSBuZy1vcHRpb24tdG1wIGxldC1pdGVtPVwiaXRlbVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7eyBpdGVtIH19ICh7eyBpdGVtIHwgbG9jYWxlUmVnaW9uTmFtZSB9fSlcclxuICAgICAgICAgICAgICAgICAgICA8L25nLXRlbXBsYXRlPlxyXG4gICAgICAgICAgICAgICAgPC9uZy1zZWxlY3Q+XHJcbiAgICAgICAgICAgIDwvdmRyLWZvcm0tZmllbGQ+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICA8L2Rpdj5cclxuICAgIDxkaXYgY2xhc3M9XCJjYXJkXCI+XHJcbiAgICAgICAgPGRpdiBjbGFzcz1cImNhcmQtaGVhZGVyXCI+XHJcbiAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwicHItMVwiPnt7ICdjb21tb24uc2FtcGxlLWZvcm1hdHRpbmcnIHwgdHJhbnNsYXRlIH19Ojwvc3Bhbj48c3Ryb25nPnt7IHByZXZpZXdMb2NhbGUgfFxyXG4gICAgICAgICAgICAgICAgbG9jYWxlTGFuZ3VhZ2VOYW1lIDogcHJldmlld0xvY2FsZSB9fTwvc3Ryb25nPlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJjYXJkLWJsb2NrXCI+XHJcbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJjbHItcm93XCI+XHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY2xyLWNvbC1zbS00XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgPHZkci1sYWJlbGVkLWRhdGEgW2xhYmVsXT1cIidjb21tb24ubWVkaXVtLWRhdGUnIHwgdHJhbnNsYXRlXCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHt7IG5vdyB8IGxvY2FsZURhdGUgOiAnbWVkaXVtJyA6IHByZXZpZXdMb2NhbGUgfX1cclxuICAgICAgICAgICAgICAgICAgICA8L3Zkci1sYWJlbGVkLWRhdGE+XHJcbiAgICAgICAgICAgICAgICAgICAgPHZkci1sYWJlbGVkLWRhdGEgW2xhYmVsXT1cIidjb21tb24uc2hvcnQtZGF0ZScgfCB0cmFuc2xhdGVcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAge3sgbm93IHwgbG9jYWxlRGF0ZSA6ICdzaG9ydCcgOiBwcmV2aWV3TG9jYWxlIH19XHJcbiAgICAgICAgICAgICAgICAgICAgPC92ZHItbGFiZWxlZC1kYXRhPlxyXG4gICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiY2xyLWNvbC1zbS00XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgPHNlbGVjdCBuYW1lPVwiY3VycmVuY3lcIiBjbGFzcz1cImN1cnJlbmN5XCIgWyhuZ01vZGVsKV09XCJzZWxlY3RlZEN1cnJlbmN5Q29kZVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8b3B0aW9uICpuZ0Zvcj1cImxldCBjb2RlIG9mIGF2YWlsYWJsZUN1cnJlbmN5Q29kZXMgfCBzb3J0XCIgW3ZhbHVlXT1cImNvZGVcIj5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt7IGNvZGUgfCB1cHBlcmNhc2UgfX0gKHt7IGNvZGUgfCBsb2NhbGVDdXJyZW5jeU5hbWUgOiAnZnVsbCcgOiBwcmV2aWV3TG9jYWxlIH19KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICA8L29wdGlvbj5cclxuICAgICAgICAgICAgICAgICAgICA8L3NlbGVjdD5cclxuICAgICAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cImNsci1jb2wtc20tNFwiPlxyXG4gICAgICAgICAgICAgICAgICAgIDx2ZHItbGFiZWxlZC1kYXRhIFtsYWJlbF09XCInY29tbW9uLnByaWNlJyB8IHRyYW5zbGF0ZVwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICB7eyAxMjM0NSB8IGxvY2FsZUN1cnJlbmN5IDogc2VsZWN0ZWRDdXJyZW5jeUNvZGUgOiBwcmV2aWV3TG9jYWxlIH19XHJcbiAgICAgICAgICAgICAgICAgICAgPC92ZHItbGFiZWxlZC1kYXRhPlxyXG4gICAgICAgICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgPC9kaXY+XHJcbjwvbmctY29udGFpbmVyPlxyXG5cclxuPG5nLXRlbXBsYXRlIHZkckRpYWxvZ0J1dHRvbnM+XHJcbiAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImJ0blwiIChjbGljayk9XCJjYW5jZWwoKVwiPnt7ICdjb21tb24uY2FuY2VsJyB8IHRyYW5zbGF0ZSB9fTwvYnV0dG9uPlxyXG4gICAgPGJ1dHRvbiB0eXBlPVwic3VibWl0XCIgKGNsaWNrKT1cInNldExhbmd1YWdlKClcIiBjbGFzcz1cImJ0biBidG4tcHJpbWFyeVwiPlxyXG4gICAgICAgIHt7ICdjb21tb24uc2V0LWxhbmd1YWdlJyB8IHRyYW5zbGF0ZSB9fVxyXG4gICAgPC9idXR0b24+XHJcbjwvbmctdGVtcGxhdGU+Il19