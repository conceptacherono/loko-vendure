import { ChangeDetectionStrategy, Component, HostBinding, Input, isDevMode, ViewChild, } from '@angular/core';
import { CodeJar } from 'codejar';
import { tap } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "../../../data/providers/data.service";
import * as i2 from "@clr/angular";
import * as i3 from "@angular/common";
import * as i4 from "../dropdown/dropdown.component";
import * as i5 from "../dropdown/dropdown-menu.component";
import * as i6 from "../dropdown/dropdown-trigger.directive";
export class UiExtensionPointComponent {
    constructor(dataService) {
        this.dataService = dataService;
        this.display = 'inline-block';
        this.isDevMode = isDevMode();
    }
    getCodeTemplate(api) {
        return codeTemplates[api](this.locationId, this.metadata).trim();
    }
    ngOnInit() {
        this.display$ = this.dataService.client
            .uiState()
            .mapStream(({ uiState }) => uiState.displayUiExtensionPoints)
            .pipe(tap(display => {
            if (display) {
                setTimeout(() => {
                    const highlight = (editor) => {
                        const code = editor.textContent ?? '';
                        editor.innerHTML = highlightTsCode(this.getCodeTemplate(this.api));
                    };
                    this.editorElementRef.nativeElement.contentEditable = 'false';
                    this.jar = CodeJar(this.editorElementRef.nativeElement, highlight);
                    this.jar.updateCode(this.getCodeTemplate(this.api));
                });
            }
        }));
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.2.4", ngImport: i0, type: UiExtensionPointComponent, deps: [{ token: i1.DataService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "17.2.4", type: UiExtensionPointComponent, selector: "vdr-ui-extension-point", inputs: { locationId: "locationId", metadata: "metadata", topPx: "topPx", leftPx: "leftPx", display: "display", api: "api" }, host: { properties: { "style.display": "this.display" } }, viewQueries: [{ propertyName: "editorElementRef", first: true, predicate: ["editor"], descendants: true }, { propertyName: "dropdownComponent", first: true, predicate: ["dropdownComponent"], descendants: true }], ngImport: i0, template: "<div [class.highlight]=\"isDevMode && (display$ | async)\" class=\"wrapper\" [style.display]=\"display\">\r\n    <vdr-dropdown *ngIf=\"isDevMode && (display$ | async)\" #dropdownComponent>\r\n        <button class=\"extension-point-info-trigger\"\r\n                [style.top.px]=\"topPx ?? 0\"\r\n                [style.left.px]=\"leftPx ?? 0\"\r\n                vdrDropdownTrigger>\r\n            <clr-icon shape=\"plugin\" class=\"\" size=\"12\"></clr-icon>\r\n        </button>\r\n        <vdr-dropdown-menu>\r\n            <div #editor contenteditable=\"false\" class=\"highlighted\"></div>\r\n        </vdr-dropdown-menu>\r\n    </vdr-dropdown>\r\n    <ng-content></ng-content>\r\n</div>\r\n", styles: [":host{position:relative}.wrapper{height:100%}button.extension-point-info-trigger{position:absolute;background-color:var(--color-accent-500);border-radius:50%;width:22px;height:22px;border:0;margin:0;padding:0;z-index:100;display:flex;align-items:center;justify-content:center;opacity:.8}button.extension-point-info-trigger:hover{opacity:1}button.extension-point-info-trigger clr-icon{color:#fff}.extension-info{padding:12px}pre{padding:6px;font-family:Source Code Pro,Lucida Console,Monaco,monospace;background-color:var(--color-grey-200)}::ng-deep .highlighted{margin:calc(var(--space-unit) * 2);padding:calc(var(--space-unit) * 2);border:1px solid var(--color-grey-300);border-radius:var(--border-radius);background-color:var(--color-component-bg-200);font-family:Source Code Pro,Lucida Console,Monaco,monospace;color:var(--color-json-editor-text)}::ng-deep .highlighted .ts-string{color:var(--color-accent-600)}::ng-deep .highlighted .ts-comment{color:var(--color-grey-500)}::ng-deep .highlighted .ts-keyword{color:var(--color-json-editor-key)}::ng-deep .highlighted .ts-default{color:var(--color-json-editor-text)}\n"], dependencies: [{ kind: "directive", type: i2.ClrIconCustomTag, selector: "clr-icon" }, { kind: "directive", type: i3.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i4.DropdownComponent, selector: "vdr-dropdown", inputs: ["manualToggle"] }, { kind: "component", type: i5.DropdownMenuComponent, selector: "vdr-dropdown-menu", inputs: ["vdrPosition", "customClasses"] }, { kind: "directive", type: i6.DropdownTriggerDirective, selector: "[vdrDropdownTrigger]" }, { kind: "pipe", type: i3.AsyncPipe, name: "async" }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.2.4", ngImport: i0, type: UiExtensionPointComponent, decorators: [{
            type: Component,
            args: [{ selector: 'vdr-ui-extension-point', changeDetection: ChangeDetectionStrategy.OnPush, template: "<div [class.highlight]=\"isDevMode && (display$ | async)\" class=\"wrapper\" [style.display]=\"display\">\r\n    <vdr-dropdown *ngIf=\"isDevMode && (display$ | async)\" #dropdownComponent>\r\n        <button class=\"extension-point-info-trigger\"\r\n                [style.top.px]=\"topPx ?? 0\"\r\n                [style.left.px]=\"leftPx ?? 0\"\r\n                vdrDropdownTrigger>\r\n            <clr-icon shape=\"plugin\" class=\"\" size=\"12\"></clr-icon>\r\n        </button>\r\n        <vdr-dropdown-menu>\r\n            <div #editor contenteditable=\"false\" class=\"highlighted\"></div>\r\n        </vdr-dropdown-menu>\r\n    </vdr-dropdown>\r\n    <ng-content></ng-content>\r\n</div>\r\n", styles: [":host{position:relative}.wrapper{height:100%}button.extension-point-info-trigger{position:absolute;background-color:var(--color-accent-500);border-radius:50%;width:22px;height:22px;border:0;margin:0;padding:0;z-index:100;display:flex;align-items:center;justify-content:center;opacity:.8}button.extension-point-info-trigger:hover{opacity:1}button.extension-point-info-trigger clr-icon{color:#fff}.extension-info{padding:12px}pre{padding:6px;font-family:Source Code Pro,Lucida Console,Monaco,monospace;background-color:var(--color-grey-200)}::ng-deep .highlighted{margin:calc(var(--space-unit) * 2);padding:calc(var(--space-unit) * 2);border:1px solid var(--color-grey-300);border-radius:var(--border-radius);background-color:var(--color-component-bg-200);font-family:Source Code Pro,Lucida Console,Monaco,monospace;color:var(--color-json-editor-text)}::ng-deep .highlighted .ts-string{color:var(--color-accent-600)}::ng-deep .highlighted .ts-comment{color:var(--color-grey-500)}::ng-deep .highlighted .ts-keyword{color:var(--color-json-editor-key)}::ng-deep .highlighted .ts-default{color:var(--color-json-editor-text)}\n"] }]
        }], ctorParameters: () => [{ type: i1.DataService }], propDecorators: { locationId: [{
                type: Input
            }], metadata: [{
                type: Input
            }], topPx: [{
                type: Input
            }], leftPx: [{
                type: Input
            }], display: [{
                type: HostBinding,
                args: ['style.display']
            }, {
                type: Input
            }], api: [{
                type: Input
            }], editorElementRef: [{
                type: ViewChild,
                args: ['editor']
            }], dropdownComponent: [{
                type: ViewChild,
                args: ['dropdownComponent']
            }] } });
function highlightTsCode(tsCode) {
    tsCode = tsCode.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
    return tsCode.replace(
    // eslint-disable-next-line max-len
    /\b(abstract|any|as|boolean|break|case|catch|class|const|continue|default|do|else|enum|export|extends|false|finally|for|from|function|get|if|implements|import|in|instanceof|interface|is|keyof|let|module|namespace|never|new|null|number|object|of|private|protected|public|readonly|require|return|set|static|string|super|switch|symbol|this|throw|true|try|type|typeof|undefined|var|void|while|with|yield)\b|\/\/.*|\/\*[\s\S]*?\*\/|"(?:\\[\s\S]|[^\\"])*"|'[^']*'/g, (match, ...args) => {
        if (/^"/.test(match) || /^'/.test(match)) {
            return '<span class="ts-string">' + match + '</span>';
        }
        else if (/\/\/.*|\/\*[\s\S]*?\*\//.test(match)) {
            return '<span class="ts-comment">' + match + '</span>';
        }
        else if (
        // eslint-disable-next-line max-len
        /\b(abstract|any|as|boolean|break|case|catch|class|const|continue|default|do|else|enum|export|extends|false|finally|for|from|function|get|if|implements|import|in|instanceof|interface|is|keyof|let|module|namespace|never|new|null|number|object|of|private|protected|public|readonly|require|return|set|static|string|super|switch|symbol|this|throw|true|try|type|typeof|undefined|var|void|while|with|yield)\b/.test(match)) {
            return '<span class="ts-keyword">' + match + '</span>';
        }
        else {
            return '<span class="ts-default">' + match + '</span>';
        }
    });
}
const codeTemplates = {
    actionBar: locationId => `
import { addActionBarItem } from '@vendure/admin-ui/core';

export default [
  addActionBarItem({
    id: 'my-button',
    label: 'My Action',
    locationId: '${locationId}',
  }),
];`,
    actionBarDropdown: locationId => `
import { addActionBarDropdownMenuItem } from '@vendure/admin-ui/core';

export default [
  addActionBarDropdownMenuItem({
    id: 'my-dropdown-item',
    label: 'My Action',
    locationId: '${locationId}',
  }),
];`,
    navMenu: locationId => `
import { addNavMenuSection } from '@vendure/admin-ui/core';

export default [
  addNavMenuSection({
      id: 'my-menu-item',
      label: 'My Menu Item',
      items: [{
          // ...
      }],
    },
    '${locationId}',
  ),
];`,
    detailComponent: locationId => `
import { registerCustomDetailComponent } from '@vendure/admin-ui/core';

export default [
  registerCustomDetailComponent({
    locationId: '${locationId}',
    component: MyCustomComponent,
  }),
];`,
    dataTable: (locationId, metadata) => `
import { registerDataTableComponent } from '@vendure/admin-ui/core';

export default [
  registerDataTableComponent({
    tableId: '${locationId}',
    columnId: '${metadata}',
    component: MyCustomComponent,
  }),
];`,
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidWktZXh0ZW5zaW9uLXBvaW50LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29yZS9zcmMvc2hhcmVkL2NvbXBvbmVudHMvdWktZXh0ZW5zaW9uLXBvaW50L3VpLWV4dGVuc2lvbi1wb2ludC5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvbGliL2NvcmUvc3JjL3NoYXJlZC9jb21wb25lbnRzL3VpLWV4dGVuc2lvbi1wb2ludC91aS1leHRlbnNpb24tcG9pbnQuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNILHVCQUF1QixFQUN2QixTQUFTLEVBRVQsV0FBVyxFQUNYLEtBQUssRUFDTCxTQUFTLEVBRVQsU0FBUyxHQUNaLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFFbEMsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7Ozs7OztBQWNyQyxNQUFNLE9BQU8seUJBQXlCO0lBZWxDLFlBQW9CLFdBQXdCO1FBQXhCLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBUjVDLFlBQU8sR0FBNkIsY0FBYyxDQUFDO1FBTTFDLGNBQVMsR0FBRyxTQUFTLEVBQUUsQ0FBQztJQUVjLENBQUM7SUFFaEQsZUFBZSxDQUFDLEdBQW9CO1FBQ2hDLE9BQU8sYUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3JFLENBQUM7SUFFRCxRQUFRO1FBQ0osSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU07YUFDbEMsT0FBTyxFQUFFO2FBQ1QsU0FBUyxDQUFDLENBQUMsRUFBRSxPQUFPLEVBQUUsRUFBRSxFQUFFLENBQUMsT0FBTyxD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QU8sRUFBRSxVQUFVLENBQUMsRUFBRSxDQUFDOzs7Ozs7Ozs7OztPQVdwQixVQUFVOztHQUVkO0lBQ0MsZUFBZSxFQUFFLFVBQVUsQ0FBQyxFQUFFLENBQUM7Ozs7O21CQUtoQixVQUFVOzs7R0FHMUI7SUFDQyxTQUFTLEVBQUUsQ0FBQyxVQUFVLEVBQUUsUUFBUSxFQUFFLEVBQUUsQ0FBQzs7Ozs7Z0JBS3pCLFVBQVU7aUJBQ1QsUUFBUTs7O0dBR3RCO0NBQ0YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcclxuICAgIENvbXBvbmVudCxcclxuICAgIEVsZW1lbnRSZWYsXHJcbiAgICBIb3N0QmluZGluZyxcclxuICAgIElucHV0LFxyXG4gICAgaXNEZXZNb2RlLFxyXG4gICAgT25Jbml0LFxyXG4gICAgVmlld0NoaWxkLFxyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBDb2RlSmFyIH0gZnJvbSAnY29kZWphcic7XHJcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5cclxuaW1wb3J0IHsgVUlFeHRlbnNpb25Mb2NhdGlvbklkIH0gZnJvbSAnLi4vLi4vLi4vY29tbW9uL2NvbXBvbmVudC1yZWdpc3RyeS10eXBlcyc7XHJcbmltcG9ydCB7IERhdGFTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vLi4vZGF0YS9wcm92aWRlcnMvZGF0YS5zZXJ2aWNlJztcclxuaW1wb3J0IHsgRHJvcGRvd25Db21wb25lbnQgfSBmcm9tICcuLi9kcm9wZG93bi9kcm9wZG93bi5jb21wb25lbnQnO1xyXG5cclxudHlwZSBVaUV4dGVuc2lvblR5cGUgPSAnYWN0aW9uQmFyJyB8ICdhY3Rpb25CYXJEcm9wZG93bicgfCAnbmF2TWVudScgfCAnZGV0YWlsQ29tcG9uZW50JyB8ICdkYXRhVGFibGUnO1xyXG5cclxuQENvbXBvbmVudCh7XHJcbiAgICBzZWxlY3RvcjogJ3Zkci11aS1leHRlbnNpb24tcG9pbnQnLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL3VpLWV4dGVuc2lvbi1wb2ludC5jb21wb25lbnQuaHRtbCcsXHJcbiAgICBzdHlsZVVybHM6IFsnLi91aS1leHRlbnNpb24tcG9pbnQuY29tcG9uZW50LnNjc3MnXSxcclxuICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgVWlFeHRlbnNpb25Qb2ludENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XHJcbiAgICBASW5wdXQoKSBsb2NhdGlvbklkOiBVSUV4dGVuc2lvbkxvY2F0aW9uSWQ7XHJcbiAgICBASW5wdXQoKSBtZXRhZGF0YT86IHN0cmluZztcclxuICAgIEBJbnB1dCgpIHRvcFB4OiBudW1iZXI7XHJcbiAgICBASW5wdXQoKSBsZWZ0UHg6IG51bWJlcjtcclxuICAgIEBIb3N0QmluZGluZygnc3R5bGUuZGlzcGxheScpXHJcbiAgICBASW5wdXQoKVxyXG4gICAgZGlzcGxheTogJ2Jsb2NrJyB8ICdpbmxpbmUtYmxvY2snID0gJ2lubGluZS1ibG9jayc7XHJcbiAgICBASW5wdXQoKSBhcGk6IFVpRXh0ZW5zaW9uVHlwZTtcclxuICAgIEBWaWV3Q2hpbGQoJ2VkaXRvcicpIHByaXZhdGUgZWRpdG9yRWxlbWVudFJlZjogRWxlbWVudFJlZjxIVE1MRGl2RWxlbWVudD47XHJcbiAgICBAVmlld0NoaWxkKCdkcm9wZG93bkNvbXBvbmVudCcpIHByaXZhdGUgZHJvcGRvd25Db21wb25lbnQ6IERyb3Bkb3duQ29tcG9uZW50O1xyXG4gICAgZGlzcGxheSQ6IE9ic2VydmFibGU8Ym9vbGVhbj47XHJcbiAgICBqYXI6IENvZGVKYXI7XHJcbiAgICByZWFkb25seSBpc0Rldk1vZGUgPSBpc0Rldk1vZGUoKTtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGRhdGFTZXJ2aWNlOiBEYXRhU2VydmljZSkge31cclxuXHJcbiAgICBnZXRDb2RlVGVtcGxhdGUoYXBpOiBVaUV4dGVuc2lvblR5cGUpOiBzdHJpbmcge1xyXG4gICAgICAgIHJldHVybiBjb2RlVGVtcGxhdGVzW2FwaV0odGhpcy5sb2NhdGlvbklkLCB0aGlzLm1ldGFkYXRhKS50cmltKCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAgICAgdGhpcy5kaXNwbGF5JCA9IHRoaXMuZGF0YVNlcnZpY2UuY2xpZW50XHJcbiAgICAgICAgICAgIC51aVN0YXRlKClcclxuICAgICAgICAgICAgLm1hcFN0cmVhbSgoeyB1aVN0YXRlIH0pID0+IHVpU3RhdGUuZGlzcGxheVVpRXh0ZW5zaW9uUG9pbnRzKVxyXG4gICAgICAgICAgICAucGlwZShcclxuICAgICAgICAgICAgICAgIHRhcChkaXNwbGF5ID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZGlzcGxheSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhpZ2hsaWdodCA9IChlZGl0b3I6IEhUTUxFbGVtZW50KSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29kZSA9IGVkaXRvci50ZXh0Q29udGVudCA/PyAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlZGl0b3IuaW5uZXJIVE1MID0gaGlnaGxpZ2h0VHNDb2RlKHRoaXMuZ2V0Q29kZVRlbXBsYXRlKHRoaXMuYXBpKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lZGl0b3JFbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuY29udGVudEVkaXRhYmxlID0gJ2ZhbHNlJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuamFyID0gQ29kZUphcih0aGlzLmVkaXRvckVsZW1lbnRSZWYubmF0aXZlRWxlbWVudCwgaGlnaGxpZ2h0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuamFyLnVwZGF0ZUNvZGUodGhpcy5nZXRDb2RlVGVtcGxhdGUodGhpcy5hcGkpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgICk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhpZ2hsaWdodFRzQ29kZSh0c0NvZGU6IHN0cmluZykge1xyXG4gICAgdHNDb2RlID0gdHNDb2RlLnJlcGxhY2UoLyYvZywgJyZhbXA7JykucmVwbGFjZSgvPC9nLCAnJmx0OycpLnJlcGxhY2UoLz4vZywgJyZndDsnKTtcclxuXHJcbiAgICByZXR1cm4gdHNDb2RlLnJlcGxhY2UoXHJcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1sZW5cclxuICAgICAgICAvXFxiKGFic3RyYWN0fGFueXxhc3xib29sZWFufGJyZWFrfGNhc2V8Y2F0Y2h8Y2xhc3N8Y29uc3R8Y29udGludWV8ZGVmYXVsdHxkb3xlbHNlfGVudW18ZXhwb3J0fGV4dGVuZHN8ZmFsc2V8ZmluYWxseXxmb3J8ZnJvbXxmdW5jdGlvbnxnZXR8aWZ8aW1wbGVtZW50c3xpbXBvcnR8aW58aW5zdGFuY2VvZnxpbnRlcmZhY2V8aXN8a2V5b2Z8bGV0fG1vZHVsZXxuYW1lc3BhY2V8bmV2ZXJ8bmV3fG51bGx8bnVtYmVyfG9iamVjdHxvZnxwcml2YXRlfHByb3RlY3RlZHxwdWJsaWN8cmVhZG9ubHl8cmVxdWlyZXxyZXR1cm58c2V0fHN0YXRpY3xzdHJpbmd8c3VwZXJ8c3dpdGNofHN5bWJvbHx0aGlzfHRocm93fHRydWV8dHJ5fHR5cGV8dHlwZW9mfHVuZGVmaW5lZHx2YXJ8dm9pZHx3aGlsZXx3aXRofHlpZWxkKVxcYnxcXC9cXC8uKnxcXC9cXCpbXFxzXFxTXSo/XFwqXFwvfFwiKD86XFxcXFtcXHNcXFNdfFteXFxcXFwiXSkqXCJ8J1teJ10qJy9nLFxyXG4gICAgICAgIChtYXRjaCwgLi4uYXJncykgPT4ge1xyXG4gICAgICAgICAgICBpZiAoL15cIi8udGVzdChtYXRjaCkgfHwgL14nLy50ZXN0KG1hdGNoKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz1cInRzLXN0cmluZ1wiPicgKyBtYXRjaCArICc8L3NwYW4+JztcclxuICAgICAgICAgICAgfSBlbHNlIGlmICgvXFwvXFwvLip8XFwvXFwqW1xcc1xcU10qP1xcKlxcLy8udGVzdChtYXRjaCkpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9XCJ0cy1jb21tZW50XCI+JyArIG1hdGNoICsgJzwvc3Bhbj4nO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKFxyXG4gICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG1heC1sZW5cclxuICAgICAgICAgICAgICAgIC9cXGIoYWJzdHJhY3R8YW55fGFzfGJvb2xlYW58YnJlYWt8Y2FzZXxjYXRjaHxjbGFzc3xjb25zdHxjb250aW51ZXxkZWZhdWx0fGRvfGVsc2V8ZW51bXxleHBvcnR8ZXh0ZW5kc3xmYWxzZXxmaW5hbGx5fGZvcnxmcm9tfGZ1bmN0aW9ufGdldHxpZnxpbXBsZW1lbnRzfGltcG9ydHxpbnxpbnN0YW5jZW9mfGludGVyZmFjZXxpc3xrZXlvZnxsZXR8bW9kdWxlfG5hbWVzcGFjZXxuZXZlcnxuZXd8bnVsbHxudW1iZXJ8b2JqZWN0fG9mfHByaXZhdGV8cHJvdGVjdGVkfHB1YmxpY3xyZWFkb25seXxyZXF1aXJlfHJldHVybnxzZXR8c3RhdGljfHN0cmluZ3xzdXBlcnxzd2l0Y2h8c3ltYm9sfHRoaXN8dGhyb3d8dHJ1ZXx0cnl8dHlwZXx0eXBlb2Z8dW5kZWZpbmVkfHZhcnx2b2lkfHdoaWxlfHdpdGh8eWllbGQpXFxiLy50ZXN0KFxyXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoLFxyXG4gICAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9XCJ0cy1rZXl3b3JkXCI+JyArIG1hdGNoICsgJzwvc3Bhbj4nO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz1cInRzLWRlZmF1bHRcIj4nICsgbWF0Y2ggKyAnPC9zcGFuPic7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgKTtcclxufVxyXG5cclxuY29uc3QgY29kZVRlbXBsYXRlczogUmVjb3JkPFxyXG4gICAgVWlFeHRlbnNpb25UeXBlLFxyXG4gICAgKGxvY2F0aW9uSWQ6IFVJRXh0ZW5zaW9uTG9jYXRpb25JZCwgbWV0YWRhdGE/OiBzdHJpbmcpID0+IHN0cmluZ1xyXG4+ID0ge1xyXG4gICAgYWN0aW9uQmFyOiBsb2NhdGlvbklkID0+IGBcclxuaW1wb3J0IHsgYWRkQWN0aW9uQmFySXRlbSB9IGZyb20gJ0B2ZW5kdXJlL2FkbWluLXVpL2NvcmUnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgW1xyXG4gIGFkZEFjdGlvbkJhckl0ZW0oe1xyXG4gICAgaWQ6ICdteS1idXR0b24nLFxyXG4gICAgbGFiZWw6ICdNeSBBY3Rpb24nLFxyXG4gICAgbG9jYXRpb25JZDogJyR7bG9jYXRpb25JZH0nLFxyXG4gIH0pLFxyXG5dO2AsXHJcbiAgICBhY3Rpb25CYXJEcm9wZG93bjogbG9jYXRpb25JZCA9PiBgXHJcbmltcG9ydCB7IGFkZEFjdGlvbkJhckRyb3Bkb3duTWVudUl0ZW0gfSBmcm9tICdAdmVuZHVyZS9hZG1pbi11aS9jb3JlJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IFtcclxuICBhZGRBY3Rpb25CYXJEcm9wZG93bk1lbnVJdGVtKHtcclxuICAgIGlkOiAnbXktZHJvcGRvd24taXRlbScsXHJcbiAgICBsYWJlbDogJ015IEFjdGlvbicsXHJcbiAgICBsb2NhdGlvbklkOiAnJHtsb2NhdGlvbklkfScsXHJcbiAgfSksXHJcbl07YCxcclxuICAgIG5hdk1lbnU6IGxvY2F0aW9uSWQgPT4gYFxyXG5pbXBvcnQgeyBhZGROYXZNZW51U2VjdGlvbiB9IGZyb20gJ0B2ZW5kdXJlL2FkbWluLXVpL2NvcmUnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgW1xyXG4gIGFkZE5hdk1lbnVTZWN0aW9uKHtcclxuICAgICAgaWQ6ICdteS1tZW51LWl0ZW0nLFxyXG4gICAgICBsYWJlbDogJ015IE1lbnUgSXRlbScsXHJcbiAgICAgIGl0ZW1zOiBbe1xyXG4gICAgICAgICAgLy8gLi4uXHJcbiAgICAgIH1dLFxyXG4gICAgfSxcclxuICAgICcke2xvY2F0aW9uSWR9JyxcclxuICApLFxyXG5dO2AsXHJcbiAgICBkZXRhaWxDb21wb25lbnQ6IGxvY2F0aW9uSWQgPT4gYFxyXG5pbXBvcnQgeyByZWdpc3RlckN1c3RvbURldGFpbENvbXBvbmVudCB9IGZyb20gJ0B2ZW5kdXJlL2FkbWluLXVpL2NvcmUnO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgW1xyXG4gIHJlZ2lzdGVyQ3VzdG9tRGV0YWlsQ29tcG9uZW50KHtcclxuICAgIGxvY2F0aW9uSWQ6ICcke2xvY2F0aW9uSWR9JyxcclxuICAgIGNvbXBvbmVudDogTXlDdXN0b21Db21wb25lbnQsXHJcbiAgfSksXHJcbl07YCxcclxuICAgIGRhdGFUYWJsZTogKGxvY2F0aW9uSWQsIG1ldGFkYXRhKSA9PiBgXHJcbmltcG9ydCB7IHJlZ2lzdGVyRGF0YVRhYmxlQ29tcG9uZW50IH0gZnJvbSAnQHZlbmR1cmUvYWRtaW4tdWkvY29yZSc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBbXHJcbiAgcmVnaXN0ZXJEYXRhVGFibGVDb21wb25lbnQoe1xyXG4gICAgdGFibGVJZDogJyR7bG9jYXRpb25JZH0nLFxyXG4gICAgY29sdW1uSWQ6ICcke21ldGFkYXRhfScsXHJcbiAgICBjb21wb25lbnQ6IE15Q3VzdG9tQ29tcG9uZW50LFxyXG4gIH0pLFxyXG5dO2AsXHJcbn07XHJcbiIsIjxkaXYgW2NsYXNzLmhpZ2hsaWdodF09XCJpc0Rldk1vZGUgJiYgKGRpc3BsYXkkIHwgYXN5bmMpXCIgY2xhc3M9XCJ3cmFwcGVyXCIgW3N0eWxlLmRpc3BsYXldPVwiZGlzcGxheVwiPlxyXG4gICAgPHZkci1kcm9wZG93biAqbmdJZj1cImlzRGV2TW9kZSAmJiAoZGlzcGxheSQgfCBhc3luYylcIiAjZHJvcGRvd25Db21wb25lbnQ+XHJcbiAgICAgICAgPGJ1dHRvbiBjbGFzcz1cImV4dGVuc2lvbi1wb2ludC1pbmZvLXRyaWdnZXJcIlxyXG4gICAgICAgICAgICAgICAgW3N0eWxlLnRvcC5weF09XCJ0b3BQeCA/PyAwXCJcclxuICAgICAgICAgICAgICAgIFtzdHlsZS5sZWZ0LnB4XT1cImxlZnRQeCA/PyAwXCJcclxuICAgICAgICAgICAgICAgIHZkckRyb3Bkb3duVHJpZ2dlcj5cclxuICAgICAgICAgICAgPGNsci1pY29uIHNoYXBlPVwicGx1Z2luXCIgY2xhc3M9XCJcIiBzaXplPVwiMTJcIj48L2Nsci1pY29uPlxyXG4gICAgICAgIDwvYnV0dG9uPlxyXG4gICAgICAgIDx2ZHItZHJvcGRvd24tbWVudT5cclxuICAgICAgICAgICAgPGRpdiAjZWRpdG9yIGNvbnRlbnRlZGl0YWJsZT1cImZhbHNlXCIgY2xhc3M9XCJoaWdobGlnaHRlZFwiPjwvZGl2PlxyXG4gICAgICAgIDwvdmRyLWRyb3Bkb3duLW1lbnU+XHJcbiAgICA8L3Zkci1kcm9wZG93bj5cclxuICAgIDxuZy1jb250ZW50PjwvbmctY29udGVudD5cclxuPC9kaXY+XHJcbiJdfQ==