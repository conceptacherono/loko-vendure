import { Pipe } from '@angular/core';
import { marker as _ } from '@biesbjerg/ngx-translate-extract-marker';
import dayjs from 'dayjs';
import * as i0 from "@angular/core";
import * as i1 from "../../providers/i18n/i18n.service";
/**
 * @description
 * Converts a date into the format "3 minutes ago", "5 hours ago" etc.
 *
 * @example
 * ```HTML
 * {{ order.orderPlacedAt | timeAgo }}
 * ```
 *
 * @docsCategory pipes
 */
export class TimeAgoPipe {
    constructor(i18nService) {
        this.i18nService = i18nService;
    }
    transform(value, nowVal) {
        const then = dayjs(value);
        const now = dayjs(nowVal || new Date());
        const secondsDiff = now.diff(then, 'second');
        const durations = [
            [60, _('datetime.ago-seconds')],
            [3600, _('datetime.ago-minutes')],
            [86400, _('datetime.ago-hours')],
            [31536000, _('datetime.ago-days')],
            [Number.MAX_SAFE_INTEGER, _('datetime.ago-years')],
        ];
        let lastUpperBound = 1;
        for (const [upperBound, translationToken] of durations) {
            if (secondsDiff < upperBound) {
                const count = Math.max(0, Math.floor(secondsDiff / lastUpperBound));
                return this.i18nService.translate(translationToken, { count });
            }
            lastUpperBound = upperBound;
        }
        return then.format();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.2.4", ngImport: i0, type: TimeAgoPipe, deps: [{ token: i1.I18nService }], target: i0.ɵɵFactoryTarget.Pipe }); }
    static { this.ɵpipe = i0.ɵɵngDeclarePipe({ minVersion: "14.0.0", version: "17.2.4", ngImport: i0, type: TimeAgoPipe, name: "timeAgo", pure: false }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.2.4", ngImport: i0, type: TimeAgoPipe, decorators: [{
            type: Pipe,
            args: [{
                    name: 'timeAgo',
                    pure: false,
                }]
        }], ctorParameters: () => [{ type: i1.I18nService }] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZS1hZ28ucGlwZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9saWIvY29yZS9zcmMvc2hhcmVkL3BpcGVzL3RpbWUtYWdvLnBpcGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLElBQUksRUFBaUIsTUFBTSxlQUFlLENBQUM7QUFDcEQsT0FBTyxFQUFFLE1BQU0sSUFBSSxDQUFDLEVBQUUsTUFBTSx5Q0FBeUMsQ0FBQztBQUN0RSxPQUFPLEtBQUssTUFBTSxPQUFPLENBQUM7OztBQUkxQjs7Ozs7Ozs7OztHQVVHO0FBS0gsTUFBTSxPQUFPLFdBQVc7SUFDcEIsWUFBb0IsV0FBd0I7UUFBeEIsZ0JBQVcsR0FBWCxXQUFXLENBQWE7SUFBRyxDQUFDO0lBRWhELFNBQVMsQ0FBQyxLQUFvQixFQUFFLE1BQXNCO1FBQ2xELE1BQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMxQixNQUFNLEdBQUcsR0FBRyxLQUFLLENBQUMsTUFBTSxJQUFJLElBQUksSUFBSSxFQUFFLENBQUMsQ0FBQztRQUN4QyxNQUFNLFdBQVcsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQztRQUM3QyxNQUFNLFNBQVMsR0FBNEI7WUFDdkMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLHNCQUFzQixDQUFDLENBQUM7WUFDL0IsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLHNCQUFzQixDQUFDLENBQUM7WUFDakMsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLENBQUM7WUFDaEMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLG1CQUFtQixDQUFDLENBQUM7WUFDbEMsQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLENBQUM7U0FDckQsQ0FBQztRQUVGLElBQUksY0FBYyxHQUFHLENBQUMsQ0FBQztRQUN2QixLQUFLLE1BQU0sQ0FBQyxVQUFVLEVBQUUsZ0JBQWdCLENBQUMsSUFBSSxTQUFTLEVBQUUsQ0FBQztZQUNyRCxJQUFJLFdBQVcsR0FBRyxVQUFVLEVBQUUsQ0FBQztnQkFDM0IsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLEdBQUcsY0FBYyxDQUFDLENBQUMsQ0FBQztnQkFDcEUsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxnQkFBZ0IsRUFBRSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7WUFDbkUsQ0FBQztZQUNELGNBQWMsR0FBRyxVQUFVLENBQUM7UUFDaEMsQ0FBQztRQUNELE9BQU8sSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ3pCLENBQUM7OEdBeEJRLFdBQVc7NEdBQVgsV0FBVzs7MkZBQVgsV0FBVztrQkFKdkIsSUFBSTttQkFBQztvQkFDRixJQUFJLEVBQUUsU0FBUztvQkFDZixJQUFJLEVBQUUsS0FBSztpQkFDZCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBpcGUsIFBpcGVUcmFuc2Zvcm0gfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgbWFya2VyIGFzIF8gfSBmcm9tICdAYmllc2JqZXJnL25neC10cmFuc2xhdGUtZXh0cmFjdC1tYXJrZXInO1xyXG5pbXBvcnQgZGF5anMgZnJvbSAnZGF5anMnO1xyXG5cclxuaW1wb3J0IHsgSTE4blNlcnZpY2UgfSBmcm9tICcuLi8uLi9wcm92aWRlcnMvaTE4bi9pMThuLnNlcnZpY2UnO1xyXG5cclxuLyoqXHJcbiAqIEBkZXNjcmlwdGlvblxyXG4gKiBDb252ZXJ0cyBhIGRhdGUgaW50byB0aGUgZm9ybWF0IFwiMyBtaW51dGVzIGFnb1wiLCBcIjUgaG91cnMgYWdvXCIgZXRjLlxyXG4gKlxyXG4gKiBAZXhhbXBsZVxyXG4gKiBgYGBIVE1MXHJcbiAqIHt7IG9yZGVyLm9yZGVyUGxhY2VkQXQgfCB0aW1lQWdvIH19XHJcbiAqIGBgYFxyXG4gKlxyXG4gKiBAZG9jc0NhdGVnb3J5IHBpcGVzXHJcbiAqL1xyXG5AUGlwZSh7XHJcbiAgICBuYW1lOiAndGltZUFnbycsXHJcbiAgICBwdXJlOiBmYWxzZSxcclxufSlcclxuZXhwb3J0IGNsYXNzIFRpbWVBZ29QaXBlIGltcGxlbWVudHMgUGlwZVRyYW5zZm9ybSB7XHJcbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIGkxOG5TZXJ2aWNlOiBJMThuU2VydmljZSkge31cclxuXHJcbiAgICB0cmFuc2Zvcm0odmFsdWU6IHN0cmluZyB8IERhdGUsIG5vd1ZhbD86IHN0cmluZyB8IERhdGUpOiBzdHJpbmcge1xyXG4gICAgICAgIGNvbnN0IHRoZW4gPSBkYXlqcyh2YWx1ZSk7XHJcbiAgICAgICAgY29uc3Qgbm93ID0gZGF5anMobm93VmFsIHx8IG5ldyBEYXRlKCkpO1xyXG4gICAgICAgIGNvbnN0IHNlY29uZHNEaWZmID0gbm93LmRpZmYodGhlbiwgJ3NlY29uZCcpO1xyXG4gICAgICAgIGNvbnN0IGR1cmF0aW9uczogQXJyYXk8W251bWJlciwgc3RyaW5nXT4gPSBbXHJcbiAgICAgICAgICAgIFs2MCwgXygnZGF0ZXRpbWUuYWdvLXNlY29uZHMnKV0sXHJcbiAgICAgICAgICAgIFszNjAwLCBfKCdkYXRldGltZS5hZ28tbWludXRlcycpXSxcclxuICAgICAgICAgICAgWzg2NDAwLCBfKCdkYXRldGltZS5hZ28taG91cnMnKV0sXHJcbiAgICAgICAgICAgIFszMTUzNjAwMCwgXygnZGF0ZXRpbWUuYWdvLWRheXMnKV0sXHJcbiAgICAgICAgICAgIFtOdW1iZXIuTUFYX1NBRkVfSU5URUdFUiwgXygnZGF0ZXRpbWUuYWdvLXllYXJzJyldLFxyXG4gICAgICAgIF07XHJcblxyXG4gICAgICAgIGxldCBsYXN0VXBwZXJCb3VuZCA9IDE7XHJcbiAgICAgICAgZm9yIChjb25zdCBbdXBwZXJCb3VuZCwgdHJhbnNsYXRpb25Ub2tlbl0gb2YgZHVyYXRpb25zKSB7XHJcbiAgICAgICAgICAgIGlmIChzZWNvbmRzRGlmZiA8IHVwcGVyQm91bmQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvdW50ID0gTWF0aC5tYXgoMCwgTWF0aC5mbG9vcihzZWNvbmRzRGlmZiAvIGxhc3RVcHBlckJvdW5kKSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pMThuU2VydmljZS50cmFuc2xhdGUodHJhbnNsYXRpb25Ub2tlbiwgeyBjb3VudCB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsYXN0VXBwZXJCb3VuZCA9IHVwcGVyQm91bmQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGVuLmZvcm1hdCgpO1xyXG4gICAgfVxyXG59XHJcbiJdfQ==