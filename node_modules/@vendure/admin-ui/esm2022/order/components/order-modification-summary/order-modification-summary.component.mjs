import { ChangeDetectionStrategy, Component, Input } from '@angular/core';
import { notNullOrUndefined } from '@vendure/common/lib/shared-utils';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
import * as i2 from "@vendure/admin-ui/core";
import * as i3 from "@ngx-translate/core";
export class OrderModificationSummaryComponent {
    get adjustedLines() {
        return (this.modifyOrderInput.adjustOrderLines || [])
            .map(l => {
            const line = this.orderSnapshot.lines.find(line => line.id === l.orderLineId);
            if (line) {
                const delta = l.quantity - line.quantity;
                const sign = delta === 0 ? '' : delta > 0 ? '+' : '-';
                return delta
                    ? `${sign}${Math.abs(delta)} ${line.productVariant.name}`
                    : line.productVariant.name;
            }
        })
            .filter(notNullOrUndefined);
    }
    getModifiedFields(formGroup) {
        if (!formGroup.dirty) {
            return '';
        }
        return Object.entries(formGroup.controls)
            .map(([key, control]) => {
            if (control.dirty) {
                return key;
            }
        })
            .filter(notNullOrUndefined)
            .join(', ');
    }
    getUpdatedShippingMethodLines() {
        return Object.entries(this.updatedShippingMethods || {})
            .map(([lineId, shippingMethod]) => {
            const previousMethod = this.orderSnapshot.shippingLines.find(l => l.id === lineId);
            if (!previousMethod) {
                return;
            }
            const previousName = previousMethod.shippingMethod.name || previousMethod.shippingMethod.code;
            const newName = shippingMethod.name || shippingMethod.code;
            return `${previousName} -> ${newName}`;
        })
            .filter(notNullOrUndefined);
    }
    get couponCodeChanges() {
        const originalCodes = this.orderSnapshot.couponCodes || [];
        const newCodes = this.couponCodesControl.value || [];
        const addedCodes = newCodes.filter(c => !originalCodes.includes(c)).map(c => `+ ${c}`);
        const removedCodes = originalCodes.filter(c => !newCodes.includes(c)).map(c => `- ${c}`);
        return [...addedCodes, ...removedCodes];
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.2.4", ngImport: i0, type: OrderModificationSummaryComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "17.2.4", type: OrderModificationSummaryComponent, selector: "vdr-order-modification-summary", inputs: { orderSnapshot: "orderSnapshot", modifyOrderInput: "modifyOrderInput", addedLines: "addedLines", shippingAddressForm: "shippingAddressForm", billingAddressForm: "billingAddressForm", updatedShippingMethods: "updatedShippingMethods", couponCodesControl: "couponCodesControl" }, ngImport: i0, template: "<vdr-labeled-data\r\n        *ngIf=\"modifyOrderInput.adjustOrderLines?.length\"\r\n        [label]=\"\r\n                    'order.modification-adjusting-lines'\r\n                        | translate : { count: modifyOrderInput.adjustOrderLines?.length }\r\n                \"\r\n>\r\n    <div *ngFor=\"let line of adjustedLines\" class=\"mb-1\">\r\n        {{ line }}\r\n    </div>\r\n</vdr-labeled-data>\r\n<vdr-labeled-data\r\n        *ngIf=\"modifyOrderInput.addItems?.length\"\r\n        [label]=\"\r\n                    'order.modification-adding-items'\r\n                        | translate : { count: modifyOrderInput.addItems?.length }\r\n                \"\r\n>\r\n    <div *ngFor=\"let item of addedLines\">\r\n        {{ item.productVariant.name }} x {{ item.quantity }}\r\n    </div>\r\n</vdr-labeled-data>\r\n<vdr-labeled-data\r\n        *ngIf=\"modifyOrderInput.surcharges?.length\"\r\n        [label]=\"\r\n                    'order.modification-adding-surcharges'\r\n                        | translate : { count: modifyOrderInput.surcharges?.length }\r\n                \"\r\n>\r\n    <div *ngFor=\"let surcharge of modifyOrderInput.surcharges\" class=\"mb-1\">\r\n        {{ surcharge.description }}: {{ surcharge.price | localeCurrency : orderSnapshot.currencyCode }}\r\n    </div>\r\n</vdr-labeled-data>\r\n<vdr-labeled-data\r\n        *ngIf=\"getModifiedFields(shippingAddressForm) as updatedShippingFields\"\r\n        [label]=\"'order.modification-updating-shipping-address' | translate\"\r\n>\r\n    {{ updatedShippingFields }}\r\n</vdr-labeled-data>\r\n<vdr-labeled-data\r\n        *ngIf=\"getModifiedFields(billingAddressForm) as updatedBillingFields\"\r\n        [label]=\"'order.modification-updating-billing-address' | translate\"\r\n>\r\n    {{ updatedBillingFields }}\r\n</vdr-labeled-data>\r\n<vdr-labeled-data *ngIf=\"couponCodeChanges.length\" [label]=\"'order.set-coupon-codes' | translate\">\r\n    <div *ngFor=\"let change of couponCodeChanges\" class=\"mb-1\">{{ change }}</div>\r\n</vdr-labeled-data>\r\n<ng-container *ngIf=\"getUpdatedShippingMethodLines() as updatedShippingMethods\">\r\n    <vdr-labeled-data *ngIf=\"updatedShippingMethods.length\" [label]=\"'order.shipping-method' | translate\">\r\n        <div *ngFor=\"let change of updatedShippingMethods\" class=\"mb-1\">{{ change }}</div>\r\n    </vdr-labeled-data>\r\n</ng-container>", styles: [""], dependencies: [{ kind: "directive", type: i1.NgForOf, selector: "[ngFor][ngForOf]", inputs: ["ngForOf", "ngForTrackBy", "ngForTemplate"] }, { kind: "directive", type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "component", type: i2.LabeledDataComponent, selector: "vdr-labeled-data", inputs: ["label"] }, { kind: "pipe", type: i3.TranslatePipe, name: "translate" }, { kind: "pipe", type: i2.LocaleCurrencyPipe, name: "localeCurrency" }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.2.4", ngImport: i0, type: OrderModificationSummaryComponent, decorators: [{
            type: Component,
            args: [{ selector: 'vdr-order-modification-summary', changeDetection: ChangeDetectionStrategy.OnPush, template: "<vdr-labeled-data\r\n        *ngIf=\"modifyOrderInput.adjustOrderLines?.length\"\r\n        [label]=\"\r\n                    'order.modification-adjusting-lines'\r\n                        | translate : { count: modifyOrderInput.adjustOrderLines?.length }\r\n                \"\r\n>\r\n    <div *ngFor=\"let line of adjustedLines\" class=\"mb-1\">\r\n        {{ line }}\r\n    </div>\r\n</vdr-labeled-data>\r\n<vdr-labeled-data\r\n        *ngIf=\"modifyOrderInput.addItems?.length\"\r\n        [label]=\"\r\n                    'order.modification-adding-items'\r\n                        | translate : { count: modifyOrderInput.addItems?.length }\r\n                \"\r\n>\r\n    <div *ngFor=\"let item of addedLines\">\r\n        {{ item.productVariant.name }} x {{ item.quantity }}\r\n    </div>\r\n</vdr-labeled-data>\r\n<vdr-labeled-data\r\n        *ngIf=\"modifyOrderInput.surcharges?.length\"\r\n        [label]=\"\r\n                    'order.modification-adding-surcharges'\r\n                        | translate : { count: modifyOrderInput.surcharges?.length }\r\n                \"\r\n>\r\n    <div *ngFor=\"let surcharge of modifyOrderInput.surcharges\" class=\"mb-1\">\r\n        {{ surcharge.description }}: {{ surcharge.price | localeCurrency : orderSnapshot.currencyCode }}\r\n    </div>\r\n</vdr-labeled-data>\r\n<vdr-labeled-data\r\n        *ngIf=\"getModifiedFields(shippingAddressForm) as updatedShippingFields\"\r\n        [label]=\"'order.modification-updating-shipping-address' | translate\"\r\n>\r\n    {{ updatedShippingFields }}\r\n</vdr-labeled-data>\r\n<vdr-labeled-data\r\n        *ngIf=\"getModifiedFields(billingAddressForm) as updatedBillingFields\"\r\n        [label]=\"'order.modification-updating-billing-address' | translate\"\r\n>\r\n    {{ updatedBillingFields }}\r\n</vdr-labeled-data>\r\n<vdr-labeled-data *ngIf=\"couponCodeChanges.length\" [label]=\"'order.set-coupon-codes' | translate\">\r\n    <div *ngFor=\"let change of couponCodeChanges\" class=\"mb-1\">{{ change }}</div>\r\n</vdr-labeled-data>\r\n<ng-container *ngIf=\"getUpdatedShippingMethodLines() as updatedShippingMethods\">\r\n    <vdr-labeled-data *ngIf=\"updatedShippingMethods.length\" [label]=\"'order.shipping-method' | translate\">\r\n        <div *ngFor=\"let change of updatedShippingMethods\" class=\"mb-1\">{{ change }}</div>\r\n    </vdr-labeled-data>\r\n</ng-container>" }]
        }], propDecorators: { orderSnapshot: [{
                type: Input
            }], modifyOrderInput: [{
                type: Input
            }], addedLines: [{
                type: Input
            }], shippingAddressForm: [{
                type: Input
            }], billingAddressForm: [{
                type: Input
            }], updatedShippingMethods: [{
                type: Input
            }], couponCodesControl: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3JkZXItbW9kaWZpY2F0aW9uLXN1bW1hcnkuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2xpYi9vcmRlci9zcmMvY29tcG9uZW50cy9vcmRlci1tb2RpZmljYXRpb24tc3VtbWFyeS9vcmRlci1tb2RpZmljYXRpb24tc3VtbWFyeS5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi8uLi9zcmMvbGliL29yZGVyL3NyYy9jb21wb25lbnRzL29yZGVyLW1vZGlmaWNhdGlvbi1zdW1tYXJ5L29yZGVyLW1vZGlmaWNhdGlvbi1zdW1tYXJ5LmNvbXBvbmVudC5odG1sIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSx1QkFBdUIsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBRTFFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLGtDQUFrQyxDQUFDOzs7OztBQVV0RSxNQUFNLE9BQU8saUNBQWlDO0lBUzFDLElBQUksYUFBYTtRQUNiLE9BQU8sQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsZ0JBQWdCLElBQUksRUFBRSxDQUFDO2FBQ2hELEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUNMLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQzlFLElBQUksSUFBSSxFQUFFLENBQUM7Z0JBQ1AsTUFBTSxLQUFLLEdBQUcsQ0FBQyxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDO2dCQUN6QyxNQUFNLElBQUksR0FBRyxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcs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QUFLO2dCQUNHLGdCQUFnQjtzQkFBeEIsS0FBSztnQkFDRyxVQUFVO3NCQUFsQixLQUFLO2dCQUNHLG1CQUFtQjtzQkFBM0IsS0FBSztnQkFDRyxrQkFBa0I7c0JBQTFCLEtBQUs7Z0JBQ0csc0JBQXNCO3NCQUE5QixLQUFLO2dCQUNHLGtCQUFrQjtzQkFBMUIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDb21wb25lbnQsIElucHV0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEZvcm1Db250cm9sLCBGb3JtR3JvdXAgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XHJcbmltcG9ydCB7IG5vdE51bGxPclVuZGVmaW5lZCB9IGZyb20gJ0B2ZW5kdXJlL2NvbW1vbi9saWIvc2hhcmVkLXV0aWxzJztcclxuaW1wb3J0IHR5cGUgeyBPcmRlckVkaXRvckNvbXBvbmVudCB9IGZyb20gJy4uL29yZGVyLWVkaXRvci9vcmRlci1lZGl0b3IuY29tcG9uZW50JztcclxuaW1wb3J0IHsgQWRkZWRMaW5lLCBNb2RpZnlPcmRlckRhdGEsIE9yZGVyU25hcHNob3QgfSBmcm9tICcuLi8uLi9jb21tb24vbW9kaWZ5LW9yZGVyLXR5cGVzJztcclxuXHJcbkBDb21wb25lbnQoe1xyXG4gICAgc2VsZWN0b3I6ICd2ZHItb3JkZXItbW9kaWZpY2F0aW9uLXN1bW1hcnknLFxyXG4gICAgdGVtcGxhdGVVcmw6ICcuL29yZGVyLW1vZGlmaWNhdGlvbi1zdW1tYXJ5LmNvbXBvbmVudC5odG1sJyxcclxuICAgIHN0eWxlVXJsczogWycuL29yZGVyLW1vZGlmaWNhdGlvbi1zdW1tYXJ5LmNvbXBvbmVudC5jc3MnXSxcclxuICAgIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgT3JkZXJNb2RpZmljYXRpb25TdW1tYXJ5Q29tcG9uZW50IHtcclxuICAgIEBJbnB1dCgpIG9yZGVyU25hcHNob3Q6IE9yZGVyU25hcHNob3Q7XHJcbiAgICBASW5wdXQoKSBtb2RpZnlPcmRlcklucHV0OiBNb2RpZnlPcmRlckRhdGE7XHJcbiAgICBASW5wdXQoKSBhZGRlZExpbmVzOiBBZGRlZExpbmVbXTtcclxuICAgIEBJbnB1dCgpIHNoaXBwaW5nQWRkcmVzc0Zvcm06IE9yZGVyRWRpdG9yQ29tcG9uZW50WydzaGlwcGluZ0FkZHJlc3NGb3JtJ107XHJcbiAgICBASW5wdXQoKSBiaWxsaW5nQWRkcmVzc0Zvcm06IE9yZGVyRWRpdG9yQ29tcG9uZW50WydiaWxsaW5nQWRkcmVzc0Zvcm0nXTtcclxuICAgIEBJbnB1dCgpIHVwZGF0ZWRTaGlwcGluZ01ldGhvZHM6IE9yZGVyRWRpdG9yQ29tcG9uZW50Wyd1cGRhdGVkU2hpcHBpbmdNZXRob2RzJ107XHJcbiAgICBASW5wdXQoKSBjb3Vwb25Db2Rlc0NvbnRyb2w6IEZvcm1Db250cm9sPHN0cmluZ1tdIHwgbnVsbD47XHJcblxyXG4gICAgZ2V0IGFkanVzdGVkTGluZXMoKTogc3RyaW5nW10ge1xyXG4gICAgICAgIHJldHVybiAodGhpcy5tb2RpZnlPcmRlcklucHV0LmFkanVzdE9yZGVyTGluZXMgfHwgW10pXHJcbiAgICAgICAgICAgIC5tYXAobCA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBsaW5lID0gdGhpcy5vcmRlclNuYXBzaG90LmxpbmVzLmZpbmQobGluZSA9PiBsaW5lLmlkID09PSBsLm9yZGVyTGluZUlkKTtcclxuICAgICAgICAgICAgICAgIGlmIChsaW5lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVsdGEgPSBsLnF1YW50aXR5IC0gbGluZS5xdWFudGl0eTtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBzaWduID0gZGVsdGEgPT09IDAgPyAnJyA6IGRlbHRhID4gMCA/ICcrJyA6ICctJztcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGVsdGFcclxuICAgICAgICAgICAgICAgICAgICAgICAgPyBgJHtzaWdufSR7TWF0aC5hYnMoZGVsdGEpfSAke2xpbmUucHJvZHVjdFZhcmlhbnQubmFtZX1gXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDogbGluZS5wcm9kdWN0VmFyaWFudC5uYW1lO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuZmlsdGVyKG5vdE51bGxPclVuZGVmaW5lZCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0TW9kaWZpZWRGaWVsZHMoZm9ybUdyb3VwOiBGb3JtR3JvdXApOiBzdHJpbmcge1xyXG4gICAgICAgIGlmICghZm9ybUdyb3VwLmRpcnR5KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIE9iamVjdC5lbnRyaWVzKGZvcm1Hcm91cC5jb250cm9scylcclxuICAgICAgICAgICAgLm1hcCgoW2tleSwgY29udHJvbF0pID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChjb250cm9sLmRpcnR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGtleTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmZpbHRlcihub3ROdWxsT3JVbmRlZmluZWQpXHJcbiAgICAgICAgICAgIC5qb2luKCcsICcpO1xyXG4gICAgfVxyXG5cclxuICAgIGdldFVwZGF0ZWRTaGlwcGluZ01ldGhvZExpbmVzKCkge1xyXG4gICAgICAgIHJldHVybiBPYmplY3QuZW50cmllcyh0aGlzLnVwZGF0ZWRTaGlwcGluZ01ldGhvZHMgfHwge30pXHJcbiAgICAgICAgICAgIC5tYXAoKFtsaW5lSWQsIHNoaXBwaW5nTWV0aG9kXSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgcHJldmlvdXNNZXRob2QgPSB0aGlzLm9yZGVyU25hcHNob3Quc2hpcHBpbmdMaW5lcy5maW5kKGwgPT4gbC5pZCA9PT0gbGluZUlkKTtcclxuICAgICAgICAgICAgICAgIGlmICghcHJldmlvdXNNZXRob2QpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25zdCBwcmV2aW91c05hbWUgPSBwcmV2aW91c01ldGhvZC5zaGlwcGluZ01ldGhvZC5uYW1lIHx8IHByZXZpb3VzTWV0aG9kLnNoaXBwaW5nTWV0aG9kLmNvZGU7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdOYW1lID0gc2hpcHBpbmdNZXRob2QubmFtZSB8fCBzaGlwcGluZ01ldGhvZC5jb2RlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGAke3ByZXZpb3VzTmFtZX0gLT4gJHtuZXdOYW1lfWA7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5maWx0ZXIobm90TnVsbE9yVW5kZWZpbmVkKTtcclxuICAgIH1cclxuXHJcbiAgICBnZXQgY291cG9uQ29kZUNoYW5nZXMoKTogc3RyaW5nW10ge1xyXG4gICAgICAgIGNvbnN0IG9yaWdpbmFsQ29kZXMgPSB0aGlzLm9yZGVyU25hcHNob3QuY291cG9uQ29kZXMgfHwgW107XHJcbiAgICAgICAgY29uc3QgbmV3Q29kZXMgPSB0aGlzLmNvdXBvbkNvZGVzQ29udHJvbC52YWx1ZSB8fCBbXTtcclxuICAgICAgICBjb25zdCBhZGRlZENvZGVzID0gbmV3Q29kZXMuZmlsdGVyKGMgPT4gIW9yaWdpbmFsQ29kZXMuaW5jbHVkZXMoYykpLm1hcChjID0+IGArICR7Y31gKTtcclxuICAgICAgICBjb25zdCByZW1vdmVkQ29kZXMgPSBvcmlnaW5hbENvZGVzLmZpbHRlcihjID0+ICFuZXdDb2Rlcy5pbmNsdWRlcyhjKSkubWFwKGMgPT4gYC0gJHtjfWApO1xyXG4gICAgICAgIHJldHVybiBbLi4uYWRkZWRDb2RlcywgLi4ucmVtb3ZlZENvZGVzXTtcclxuICAgIH1cclxufVxyXG4iLCI8dmRyLWxhYmVsZWQtZGF0YVxyXG4gICAgICAgICpuZ0lmPVwibW9kaWZ5T3JkZXJJbnB1dC5hZGp1c3RPcmRlckxpbmVzPy5sZW5ndGhcIlxyXG4gICAgICAgIFtsYWJlbF09XCJcclxuICAgICAgICAgICAgICAgICAgICAnb3JkZXIubW9kaWZpY2F0aW9uLWFkanVzdGluZy1saW5lcydcclxuICAgICAgICAgICAgICAgICAgICAgICAgfCB0cmFuc2xhdGUgOiB7IGNvdW50OiBtb2RpZnlPcmRlcklucHV0LmFkanVzdE9yZGVyTGluZXM/Lmxlbmd0aCB9XHJcbiAgICAgICAgICAgICAgICBcIlxyXG4+XHJcbiAgICA8ZGl2ICpuZ0Zvcj1cImxldCBsaW5lIG9mIGFkanVzdGVkTGluZXNcIiBjbGFzcz1cIm1iLTFcIj5cclxuICAgICAgICB7eyBsaW5lIH19XHJcbiAgICA8L2Rpdj5cclxuPC92ZHItbGFiZWxlZC1kYXRhPlxyXG48dmRyLWxhYmVsZWQtZGF0YVxyXG4gICAgICAgICpuZ0lmPVwibW9kaWZ5T3JkZXJJbnB1dC5hZGRJdGVtcz8ubGVuZ3RoXCJcclxuICAgICAgICBbbGFiZWxdPVwiXHJcbiAgICAgICAgICAgICAgICAgICAgJ29yZGVyLm1vZGlmaWNhdGlvbi1hZGRpbmctaXRlbXMnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHwgdHJhbnNsYXRlIDogeyBjb3VudDogbW9kaWZ5T3JkZXJJbnB1dC5hZGRJdGVtcz8ubGVuZ3RoIH1cclxuICAgICAgICAgICAgICAgIFwiXHJcbj5cclxuICAgIDxkaXYgKm5nRm9yPVwibGV0IGl0ZW0gb2YgYWRkZWRMaW5lc1wiPlxyXG4gICAgICAgIHt7IGl0ZW0ucHJvZHVjdFZhcmlhbnQubmFtZSB9fSB4IHt7IGl0ZW0ucXVhbnRpdHkgfX1cclxuICAgIDwvZGl2PlxyXG48L3Zkci1sYWJlbGVkLWRhdGE+XHJcbjx2ZHItbGFiZWxlZC1kYXRhXHJcbiAgICAgICAgKm5nSWY9XCJtb2RpZnlPcmRlcklucHV0LnN1cmNoYXJnZXM/Lmxlbmd0aFwiXHJcbiAgICAgICAgW2xhYmVsXT1cIlxyXG4gICAgICAgICAgICAgICAgICAgICdvcmRlci5tb2RpZmljYXRpb24tYWRkaW5nLXN1cmNoYXJnZXMnXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHwgdHJhbnNsYXRlIDogeyBjb3VudDogbW9kaWZ5T3JkZXJJbnB1dC5zdXJjaGFyZ2VzPy5sZW5ndGggfVxyXG4gICAgICAgICAgICAgICAgXCJcclxuPlxyXG4gICAgPGRpdiAqbmdGb3I9XCJsZXQgc3VyY2hhcmdlIG9mIG1vZGlmeU9yZGVySW5wdXQuc3VyY2hhcmdlc1wiIGNsYXNzPVwibWItMVwiPlxyXG4gICAgICAgIHt7IHN1cmNoYXJnZS5kZXNjcmlwdGlvbiB9fToge3sgc3VyY2hhcmdlLnByaWNlIHwgbG9jYWxlQ3VycmVuY3kgOiBvcmRlclNuYXBzaG90LmN1cnJlbmN5Q29kZSB9fVxyXG4gICAgPC9kaXY+XHJcbjwvdmRyLWxhYmVsZWQtZGF0YT5cclxuPHZkci1sYWJlbGVkLWRhdGFcclxuICAgICAgICAqbmdJZj1cImdldE1vZGlmaWVkRmllbGRzKHNoaXBwaW5nQWRkcmVzc0Zvcm0pIGFzIHVwZGF0ZWRTaGlwcGluZ0ZpZWxkc1wiXHJcbiAgICAgICAgW2xhYmVsXT1cIidvcmRlci5tb2RpZmljYXRpb24tdXBkYXRpbmctc2hpcHBpbmctYWRkcmVzcycgfCB0cmFuc2xhdGVcIlxyXG4+XHJcbiAgICB7eyB1cGRhdGVkU2hpcHBpbmdGaWVsZHMgfX1cclxuPC92ZHItbGFiZWxlZC1kYXRhPlxyXG48dmRyLWxhYmVsZWQtZGF0YVxyXG4gICAgICAgICpuZ0lmPVwiZ2V0TW9kaWZpZWRGaWVsZHMoYmlsbGluZ0FkZHJlc3NGb3JtKSBhcyB1cGRhdGVkQmlsbGluZ0ZpZWxkc1wiXHJcbiAgICAgICAgW2xhYmVsXT1cIidvcmRlci5tb2RpZmljYXRpb24tdXBkYXRpbmctYmlsbGluZy1hZGRyZXNzJyB8IHRyYW5zbGF0ZVwiXHJcbj5cclxuICAgIHt7IHVwZGF0ZWRCaWxsaW5nRmllbGRzIH19XHJcbjwvdmRyLWxhYmVsZWQtZGF0YT5cclxuPHZkci1sYWJlbGVkLWRhdGEgKm5nSWY9XCJjb3Vwb25Db2RlQ2hhbmdlcy5sZW5ndGhcIiBbbGFiZWxdPVwiJ29yZGVyLnNldC1jb3Vwb24tY29kZXMnIHwgdHJhbnNsYXRlXCI+XHJcbiAgICA8ZGl2ICpuZ0Zvcj1cImxldCBjaGFuZ2Ugb2YgY291cG9uQ29kZUNoYW5nZXNcIiBjbGFzcz1cIm1iLTFcIj57eyBjaGFuZ2UgfX08L2Rpdj5cclxuPC92ZHItbGFiZWxlZC1kYXRhPlxyXG48bmctY29udGFpbmVyICpuZ0lmPVwiZ2V0VXBkYXRlZFNoaXBwaW5nTWV0aG9kTGluZXMoKSBhcyB1cGRhdGVkU2hpcHBpbmdNZXRob2RzXCI+XHJcbiAgICA8dmRyLWxhYmVsZWQtZGF0YSAqbmdJZj1cInVwZGF0ZWRTaGlwcGluZ01ldGhvZHMubGVuZ3RoXCIgW2xhYmVsXT1cIidvcmRlci5zaGlwcGluZy1tZXRob2QnIHwgdHJhbnNsYXRlXCI+XHJcbiAgICAgICAgPGRpdiAqbmdGb3I9XCJsZXQgY2hhbmdlIG9mIHVwZGF0ZWRTaGlwcGluZ01ldGhvZHNcIiBjbGFzcz1cIm1iLTFcIj57eyBjaGFuZ2UgfX08L2Rpdj5cclxuICAgIDwvdmRyLWxhYmVsZWQtZGF0YT5cclxuPC9uZy1jb250YWluZXI+Il19