import { FormControl, Validators } from '@angular/forms';
import { summate } from '@vendure/common/lib/shared-utils';
export function getRefundablePayments(payments) {
    const settledPayments = (payments || []).filter(p => p.state === 'Settled');
    return settledPayments.map((payment, index) => {
        const refundableAmount = payment.amount -
            summate(payment.refunds.filter(r => r.state !== 'Failed'), 'total');
        return {
            ...payment,
            refundableAmount,
            amountToRefundControl: new FormControl(0, {
                nonNullable: true,
                validators: [Validators.min(0), Validators.max(refundableAmount)],
            }),
            selected: index === 0,
        };
    });
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0LXJlZnVuZGFibGUtcGF5bWVudHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbGliL29yZGVyL3NyYy9jb21tb24vZ2V0LXJlZnVuZGFibGUtcGF5bWVudHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFdBQVcsRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUV6RCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFTM0QsTUFBTSxVQUFVLHFCQUFxQixDQUFDLFFBQXlDO0lBQzNFLE1BQU0sZUFBZSxHQUFHLENBQUMsUUFBUSxJQUFJLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLEtBQUssU0FBUyxDQUFDLENBQUM7SUFDNUUsT0FBTyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyxFQUFFLEtBQUssRUFBRSxFQUFFO1FBQzFDLE1BQU0sZ0JBQWdCLEdBQ2xCLE9BQU8sQ0FBQyxNQUFNO1lBQ2QsT0FBTyxDQUNILE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyxRQUFRLENBQUMsRUFDakQsT0FBTyxDQUNWLENBQUM7UUFDTixPQUFPO1lBQ0gsR0FBRyxPQUFPO1lBQ1YsZ0JBQWdCO1lBQ2hCLHFCQUFxQixFQUFFLElBQUksV0FBVyxDQUFDLENBQUMsRUFBRTtnQkFDdEMsV0FBVyxFQUFFLElBQUk7Z0JBQ2pCLFVBQVUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsVUFBVSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO2FBQ3BFLENBQUM7WUFDRixRQUFRLEVBQUUsS0FBSyxLQUFLLENBQUM7U0FDeEIsQ0FBQztJQUNOLENBQUMsQ0FBQyxDQUFDO0FBQ1AsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZvcm1Db250cm9sLCBWYWxpZGF0b3JzIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBPcmRlckRldGFpbEZyYWdtZW50IH0gZnJvbSAnQHZlbmR1cmUvYWRtaW4tdWkvY29yZSc7XHJcbmltcG9ydCB7IHN1bW1hdGUgfSBmcm9tICdAdmVuZHVyZS9jb21tb24vbGliL3NoYXJlZC11dGlscyc7XHJcblxyXG5leHBvcnQgdHlwZSBQYXltZW50ID0gTm9uTnVsbGFibGU8T3JkZXJEZXRhaWxGcmFnbWVudFsncGF5bWVudHMnXT5bbnVtYmVyXTtcclxuZXhwb3J0IHR5cGUgUmVmdW5kYWJsZVBheW1lbnQgPSBQYXltZW50ICYge1xyXG4gICAgcmVmdW5kYWJsZUFtb3VudDogbnVtYmVyO1xyXG4gICAgYW1vdW50VG9SZWZ1bmRDb250cm9sOiBGb3JtQ29udHJvbDxudW1iZXI+O1xyXG4gICAgc2VsZWN0ZWQ6IGJvb2xlYW47XHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0UmVmdW5kYWJsZVBheW1lbnRzKHBheW1lbnRzOiBPcmRlckRldGFpbEZyYWdtZW50WydwYXltZW50cyddKTogUmVmdW5kYWJsZVBheW1lbnRbXSB7XHJcbiAgICBjb25zdCBzZXR0bGVkUGF5bWVudHMgPSAocGF5bWVudHMgfHwgW10pLmZpbHRlcihwID0+IHAuc3RhdGUgPT09ICdTZXR0bGVkJyk7XHJcbiAgICByZXR1cm4gc2V0dGxlZFBheW1lbnRzLm1hcCgocGF5bWVudCwgaW5kZXgpID0+IHtcclxuICAgICAgICBjb25zdCByZWZ1bmRhYmxlQW1vdW50ID1cclxuICAgICAgICAgICAgcGF5bWVudC5hbW91bnQgLVxyXG4gICAgICAgICAgICBzdW1tYXRlKFxyXG4gICAgICAgICAgICAgICAgcGF5bWVudC5yZWZ1bmRzLmZpbHRlcihyID0+IHIuc3RhdGUgIT09ICdGYWlsZWQnKSxcclxuICAgICAgICAgICAgICAgICd0b3RhbCcsXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgLi4ucGF5bWVudCxcclxuICAgICAgICAgICAgcmVmdW5kYWJsZUFtb3VudCxcclxuICAgICAgICAgICAgYW1vdW50VG9SZWZ1bmRDb250cm9sOiBuZXcgRm9ybUNvbnRyb2woMCwge1xyXG4gICAgICAgICAgICAgICAgbm9uTnVsbGFibGU6IHRydWUsXHJcbiAgICAgICAgICAgICAgICB2YWxpZGF0b3JzOiBbVmFsaWRhdG9ycy5taW4oMCksIFZhbGlkYXRvcnMubWF4KHJlZnVuZGFibGVBbW91bnQpXSxcclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgIHNlbGVjdGVkOiBpbmRleCA9PT0gMCxcclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcbn1cclxuIl19