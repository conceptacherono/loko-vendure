import{$a as qn,$b as Jn,$c as mt,$f as Or,A as Dn,Aa as Ct,Ab as vt,Ae as qe,Af as Fi,B as ni,Ba as Y,Bd as H,Bf as wt,Bg as $i,Ca as u,Cd as pe,Ce as Di,Cf as Pt,Da as v,Dd as oe,De as ur,Df as rt,E as wn,Ea as _,Ed as St,Ef as ye,Eg as Fr,F as Pn,Fa as ie,Fd as Ne,Fe as We,Ff as Ei,Ga as di,Gd as nr,Ge as U,H as ri,Ha as R,Hd as Ot,He as ve,I as L,Ia as N,Id as Ke,Ie as X,Ja as $,Jc as ko,Jf as He,Jg as kt,K as pn,L as ze,La as Gt,Ld as It,Le as he,Lg as Er,Ma as A,Mb as zn,Md as rr,Me as k,Mf as Bi,Na as Xe,Nd as or,Nf as Mt,O as oi,Oa as sn,Od as ar,Oe as Ao,Of as Ft,P as Mn,Pa as Rn,Pc as Zn,Pd as et,Pf as ot,Pg as Lt,Q as ke,Qa as d,Qd as $e,Qf as at,Qg as ji,Ra as s,Rd as gi,Rf as ki,S as Le,Sa as x,T as h,Tc as Kn,Td as un,Te as fr,U as y,Ua as ee,Ud as lr,Ue as wi,Ug as Br,V as ai,Va as Ve,Vd as Tt,W as J,Wa as Nn,Wd as Ci,Wf as Sr,X as Fn,Xa as $n,Xf as Li,Ya as M,Yb as Xn,Yf as Et,Z as xe,Za as w,Zb as Yn,Zf as Ue,_ as r,_a as jn,_b as mi,_f as Ai,a as G,aa as P,ab as Wn,ac as ui,ad as Lo,ae as B,ag as Ir,b as se,ba as En,bb as pi,bd as er,be as vi,bf as _r,bg as Tr,bh as kr,c as In,ca as O,cb as si,cd as ht,ce as Ce,cf as gr,cg as Dr,da as Bn,db as W,dd as Z,de as dr,df as Cr,e as Ee,ee as tt,eh as qi,ff as vr,fg as lt,g as Be,ga as Ie,gb as Hn,gd as tr,ge as pr,gf as hr,gg as wr,h as Ut,ha as f,hb as ci,hd as fi,he as sr,hf as Dt,hg as Ge,i as Fe,ia as Ae,ib as Un,id as Re,ie as hi,if as ue,ig as Pr,ja as o,jd as ir,je as yi,k as ce,ka as kn,ke as xi,kg as fe,la as Q,ld as I,le as bi,lg as Mr,ma as a,me as Si,mg as dt,n as _e,na as l,nb as be,nd as _i,ne as Oi,ng as pt,o as Tn,oa as g,oe as cr,pa as T,pe as mr,q as Kt,qa as D,qb as Gn,qd as yt,qe as Ii,qf as yr,r as ei,ra as Je,rb as Qn,re as Ti,sa as S,sb as cn,sf as xr,ta as b,tb as q,td as xt,te as it,tf as Pe,ua as m,ud as ne,ue as ae,uf as Pi,ug as Vi,v as ti,va as Ln,vd as re,ve as te,vg as Bt,wa as An,wb as mn,wd as z,we as je,wg as Ri,x as _t,xa as Vn,xd as Ze,xe as Te,xf as br,xg as Ni,y as Oe,ya as li,yb as ct,yd as bt,ye as De,yf as Mi,z as ii,za as gt,zd as me,ze as we,zf as nt}from"./chunk-KV5QNU55.js";var Lr=Ee(mt());function Wi(t){return(t||[]).filter(e=>e.state==="Settled").map((e,i)=>{let n=e.amount-(0,Lr.summate)(e.refunds.filter(c=>c.state!=="Failed"),"total");return se(G({},e),{refundableAmount:n,amountToRefundControl:new H(0,{nonNullable:!0,validators:[re.min(0),re.max(n)]}),selected:i===0})})}function Vo(t,p){t&1&&(u(0),d(1,"translate")),t&2&&v(s(1,1,"order.add-payment-to-order"))}function Ro(t,p){if(t&1){let e=S();a(0,"button",7),b("click",function(){h(e);let n=m();return y(n.cancel())}),u(1),d(2,"translate"),l(),a(3,"button",8),b("click",function(){h(e);let n=m();return y(n.submit())}),u(4),d(5,"translate"),d(6,"localeCurrency"),l()}if(t&2){let e=m();r(),v(s(2,4,"common.cancel")),r(2),o("disabled",e.form.invalid||e.form.pristine),r(),ie(" ",s(5,6,"order.add-payment")," (",x(6,8,e.outstandingAmount,e.currencyCode),") ")}}var Nm=be`
    query GetAddManualPaymentMethodList($options: PaymentMethodListOptions!) {
        paymentMethods(options: $options) {
            items {
                id
                createdAt
                updatedAt
                name
                code
                description
                enabled
            }
            totalItems
        }
    }
`,Ar=(()=>{class t{constructor(e){this.dataService=e,this.form=new me({method:new pe("",re.required),transactionId:new pe("",re.required)})}ngOnInit(){this.paymentMethods$=this.dataService.query(Xn,{options:{take:999}}).mapSingle(e=>e.paymentMethods.items)}submit(){let e=this.form.value;this.resolveWith({method:e.method,transactionId:e.transactionId})}cancel(){this.resolveWith()}static{this.\u0275fac=function(i){return new(i||t)(P(Z))}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-add-manual-payment-dialog"]],standalone:!1,decls:10,vars:11,consts:[["vdrDialogTitle",""],[3,"formGroup"],["for","method",3,"label"],["bindLabel","code","appendTo","body","autofocus","","bindValue","code","formControlName","method",3,"items","addTag"],["for","transactionId",3,"label"],["id","transactionId","type","text","formControlName","transactionId"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"click","disabled"]],template:function(i,n){i&1&&(f(0,Vo,2,3,"ng-template",0),a(1,"form",1)(2,"vdr-form-field",2),d(3,"translate"),g(4,"ng-select",3),d(5,"async"),l(),a(6,"vdr-form-field",4),d(7,"translate"),g(8,"input",5),l()(),f(9,Ro,7,11,"ng-template",6)),i&2&&(r(),o("formGroup",n.form),r(),o("label",s(3,5,"order.payment-method")),r(2),o("items",s(5,7,n.paymentMethods$))("addTag",!0),r(2),o("label",s(7,9,"order.transaction-id")))},dependencies:[St,ne,z,Ze,Ke,It,We,ve,U,ae,te,W,I,k],styles:[`.ng-select[_ngcontent-%COMP%]{min-width:100%}
/*# sourceMappingURL=add-manual-payment-dialog.component-NBTQMCVV.css.map */`],changeDetection:0})}}return t})();function No(t,p){t&1&&(u(0),d(1,"translate")),t&2&&v(s(1,1,"order.cancel-order"))}function $o(t,p){if(t&1){let e=S();a(0,"input",19),$("ngModelChange",function(n){h(e);let c=m().$implicit,C=m();return N(C.lineQuantities[c.id],n)||(C.lineQuantities[c.id]=n),y(n)}),b("input",function(){h(e);let n=m(2);return y(n.checkIfAllSelected())}),l()}if(t&2){let e=m().$implicit,i=m();R("ngModel",i.lineQuantities[e.id]),o("disabled",i.cancelAll)("max",e.quantity)}}function jo(t,p){if(t&1&&u(0),t&2){let e=m().$implicit;v(e.quantity)}}function qo(t,p){if(t&1&&(a(0,"tr",11)(1,"td",12),g(2,"img",13),d(3,"assetPreview"),l(),a(4,"td",14),u(5),l(),a(6,"td",15),u(7),l(),a(8,"td",16),u(9),l(),a(10,"td",16),u(11),d(12,"localeCurrency"),l(),a(13,"td",17),f(14,$o,1,3,"input",18)(15,jo,1,1,"ng-template",null,0,ee),l()()),t&2){let e=p.$implicit,i=Y(16),n=m();Q("is-disabled",n.cancelAll)("is-cancelled",e.quantity===0),r(2),o("src",x(3,11,e.featuredAsset,"tiny"),xe),r(3),v(e.productVariant.name),r(2),v(e.productVariant.sku),r(2),v(e.quantity),r(2),_(" ",x(12,14,e.unitPriceWithTax,n.order.currencyCode)," "),r(3),o("ngIf",e.quantity>0&&!n.order.active)("ngIfElse",i)}}function Wo(t,p){if(t&1){let e=S();T(0),a(1,"clr-radio-wrapper")(2,"input",20),$("ngModelChange",function(n){h(e);let c=m();return N(c.cancelAll,n)||(c.cancelAll=n),y(n)}),b("ngModelChange",function(){h(e);let n=m();return y(n.radioChanged())}),l(),a(3,"label"),u(4),d(5,"translate"),l()(),a(6,"clr-radio-wrapper")(7,"input",20),$("ngModelChange",function(n){h(e);let c=m();return N(c.cancelAll,n)||(c.cancelAll=n),y(n)}),b("ngModelChange",function(){h(e);let n=m();return y(n.radioChanged())}),l(),a(8,"label"),u(9),d(10,"translate"),l()(),D()}if(t&2){let e=m();r(2),o("value",!0),R("ngModel",e.cancelAll),r(2),v(s(5,6,"order.cancel-entire-order")),r(3),o("value",!1),R("ngModel",e.cancelAll),r(2),v(s(10,8,"order.cancel-specified-items"))}}function Ho(t,p){t&1&&(T(0),u(1),d(2,"translate"),D()),t&2&&(r(),_(" ",s(2,1,"order.cancel-selected-items")," "))}function Uo(t,p){t&1&&(T(0),u(1),d(2,"translate"),D()),t&2&&(r(),_(" ",s(2,1,"order.cancel-order")," "))}function Go(t,p){if(t&1){let e=S();a(0,"button",21),b("click",function(){h(e);let n=m();return y(n.cancel())}),u(1),d(2,"translate"),l(),a(3,"button",22),b("click",function(){h(e);let n=m();return y(n.select())}),f(4,Ho,3,3,"ng-container",7)(5,Uo,3,3,"ng-container",7),l()}if(t&2){let e=m();r(),v(s(2,4,"common.cancel")),r(2),o("disabled",!e.reason||!e.order.active&&e.selectionCount===0),r(),o("ngIf",!e.order.active),r(),o("ngIf",e.order.active)}}var Vr=(()=>{class t{get selectionCount(){return Object.values(this.lineQuantities).reduce((e,i)=>e+i,0)}constructor(e){this.i18nService=e,this.cancelAll=!0,this.lineQuantities={},this.reasons=_i().cancellationReasons??["order.cancel-reason-customer-request","order.cancel-reason-not-available"],this.reasons=this.reasons.map(i=>this.i18nService.translate(i))}ngOnInit(){this.lineQuantities=this.order.lines.reduce((e,i)=>se(G({},e),{[i.id]:i.quantity}),{})}radioChanged(){if(this.cancelAll)for(let e of this.order.lines)this.lineQuantities[e.id]=e.quantity;else for(let e of this.order.lines)this.lineQuantities[e.id]=0}checkIfAllSelected(){for(let[e,i]of Object.entries(this.lineQuantities)){let n=this.order.lines.find(c=>c.id===e)?.quantity;if(n&&i<n)return}this.cancelAll=!0}select(){this.resolveWith({orderId:this.order.id,lines:this.getLineInputs(),reason:this.reason,cancelShipping:this.cancelAll})}cancel(){this.resolveWith()}getLineInputs(){if(!this.order.active)return Object.entries(this.lineQuantities).map(([e,i])=>({orderLineId:e,quantity:i})).filter(e=>0<e.quantity)}static{this.\u0275fac=function(i){return new(i||t)(P(yt))}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-cancel-order-dialog"]],standalone:!1,decls:30,vars:23,consts:[["nonEditable",""],["vdrDialogTitle",""],[1,"fulfillment-wrapper"],[1,"order-lines"],[1,"table"],["class","order-line",3,"is-disabled","is-cancelled",4,"ngFor","ngForOf"],[1,"cancellation-details"],[4,"ngIf"],[1,"clr-control-label"],["bindLabel","name","autofocus","","bindValue","id",3,"ngModelChange","items","addTag","ngModel"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[1,"align-middle","fulfil"],["type","number","min","0",3,"ngModel","disabled","max","ngModelChange","input",4,"ngIf","ngIfElse"],["type","number","min","0",3,"ngModelChange","input","ngModel","disabled","max"],["type","radio","clrRadio","","name","options",3,"ngModelChange","value","ngModel"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"click","disabled"]],template:function(i,n){i&1&&(f(0,No,2,3,"ng-template",1),a(1,"div",2)(2,"div",3)(3,"table",4)(4,"thead")(5,"tr"),g(6,"th"),a(7,"th"),u(8),d(9,"translate"),l(),a(10,"th"),u(11),d(12,"translate"),l(),a(13,"th"),u(14),d(15,"translate"),l(),a(16,"th"),u(17),d(18,"translate"),l(),a(19,"th"),u(20),d(21,"translate"),l()()(),f(22,qo,17,17,"tr",5),l()(),a(23,"div",6),f(24,Wo,11,10,"ng-container",7),a(25,"label",8),u(26),d(27,"translate"),l(),a(28,"ng-select",9),$("ngModelChange",function(C){return N(n.reason,C)||(n.reason=C),C}),l()()(),f(29,Go,6,6,"ng-template",10)),i&2&&(r(8),v(s(9,11,"order.product-name")),r(3),v(s(12,13,"order.product-sku")),r(3),v(s(15,15,"order.quantity")),r(3),v(s(18,17,"order.unit-price")),r(3),v(s(21,19,"order.cancel")),r(2),o("ngForOf",n.order.lines),r(2),o("ngIf",n.order.active!==!0),r(2),v(s(27,21,"order.cancellation-reason")),r(2),o("items",n.reasons)("addTag",!0),R("ngModel",n.reason))},dependencies:[Ce,mr,cr,M,w,ne,Ne,nr,z,$e,et,oe,We,U,ae,te,I,Pe,k],styles:[`[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}.fulfillment-wrapper[_ngcontent-%COMP%]{flex:1}@media screen and (min-width: 768px){.fulfillment-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row}}@media screen and (min-width: 768px){.fulfillment-wrapper[_ngcontent-%COMP%]   .cancellation-details[_ngcontent-%COMP%]{margin-top:0;margin-inline-start:24px;width:250px}}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-lines[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-lines[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.fulfillment-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}.fulfillment-wrapper[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}.fulfillment-wrapper[_ngcontent-%COMP%]   .is-disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .fulfillment-wrapper[_ngcontent-%COMP%]   .is-disabled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background-color:var(--color-component-bg-200)}
/*# sourceMappingURL=cancel-order-dialog.component-Z7VZXCZZ.css.map */`],changeDetection:0})}}return t})();function Qo(t,p){if(t&1&&(a(0,"div",2)(1,"vdr-chip",3),u(2),l(),a(3,"span"),u(4),l()()),t&2){let e=p.item;r(2),v(e.code),r(2),v(e.promotionName)}}var e0=be`
    query GetCouponCodeSelectorPromotionList($options: PromotionListOptions) {
        promotions(options: $options) {
            items {
                id
                name
                couponCode
            }
            totalItems
        }
    }
`,Ui=(()=>{class t{constructor(e){this.dataService=e,this.addCouponCode=new J,this.removeCouponCode=new J,this.couponCodeInput$=new Be}ngOnInit(){this.availableCouponCodes$=Kt(this.couponCodeInput$.pipe(_t(200),ni(),L(e=>this.dataService.query(Yn,{options:{take:10,skip:0,filter:{couponCode:{contains:e}}}}).single$),_e(({promotions:e})=>e.items.map(i=>({code:i.couponCode,promotionName:i.name}))),ri([]))),this.control||(this.control=new pe(this.couponCodes??[]))}remove(e){this.removeCouponCode.emit(e)}static{this.\u0275fac=function(i){return new(i||t)(P(Z))}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-coupon-code-selector"]],inputs:{couponCodes:"couponCodes",control:"control"},outputs:{addCouponCode:"addCouponCode",removeCouponCode:"removeCouponCode"},standalone:!1,decls:3,vars:9,consts:[["appendTo","body","bindLabel","code","bindValue","code","typeToSearchText","",3,"add","remove","items","addTag","multiple","hideSelected","minTermLength","typeahead","formControl"],["ng-option-tmp",""],[1,"flex","items-center"],[1,"mr-1"]],template:function(i,n){i&1&&(a(0,"ng-select",0),d(1,"async"),b("add",function(C){return n.addCouponCode.emit(C.code)})("remove",function(C){return n.remove(C.code)}),f(2,Qo,5,2,"ng-template",1),l()),i&2&&o("items",s(1,7,n.availableCouponCodes$))("addTag",!1)("multiple",!0)("hideSelected",!0)("minTermLength",2)("typeahead",n.couponCodeInput$)("formControl",n.control)},dependencies:[z,Ot,We,Di,ue,W],encapsulation:2,changeDetection:0})}}return t})();var Nr=Ee(ko());function Jo(t,p){t&1&&(u(0),d(1,"translate")),t&2&&v(s(1,1,"order.select-address"))}function Zo(t,p){if(t&1&&(a(0,"vdr-radio-card",7),g(1,"vdr-formatted-address",8),l()),t&2){let e=p.$implicit;o("item",e),r(),o("address",e)}}function Ko(t,p){if(t&1){let e=S();a(0,"clr-tab-content")(1,"vdr-radio-card-fieldset",5),b("selectItem",function(n){h(e);let c=m(3);return y(c.selectedAddress=n)}),f(2,Zo,2,2,"vdr-radio-card",6),l()()}if(t&2){let e=m(2).ngIf,i=m();r(),o("idFn",i.addressIdFn)("selectedItemId",i.selectedAddress&&i.addressIdFn(i.selectedAddress)),r(),o("ngForOf",e)}}function ea(t,p){if(t&1){let e=S();a(0,"clr-tab")(1,"button",3),u(2),d(3,"translate"),l(),f(4,Ko,3,3,"ng-template",4),$("clrIfActiveChange",function(n){h(e);let c=m(2);return N(c.useExisting,n)||(c.useExisting=n),y(n)}),l()}if(t&2){let e=m(2);r(2),v(s(3,2,"order.existing-address")),r(2),R("clrIfActive",e.useExisting)}}function ta(t,p){if(t&1&&(a(0,"clr-tab-content"),g(1,"vdr-address-form",9),d(2,"async"),l()),t&2){let e=m(2);r(),o("formGroup",e.addressForm)("availableCountries",s(2,2,e.availableCountries$))}}function ia(t,p){if(t&1){let e=S();a(0,"clr-tabs"),f(1,ea,5,4,"clr-tab",1),a(2,"clr-tab")(3,"button",3),u(4),d(5,"translate"),l(),f(6,ta,3,4,"ng-template",4),$("clrIfActiveChange",function(n){h(e);let c=m();return N(c.createNew,n)||(c.createNew=n),y(n)}),l()()}if(t&2){let e=p.ngIf,i=m();r(),o("ngIf",i.customerId&&e.length),r(3),v(s(5,3,"customer.create-new-address")),r(2),R("clrIfActive",i.createNew)}}function na(t,p){if(t&1){let e=S();a(0,"button",10),b("click",function(){h(e);let n=m();return y(n.cancel())}),u(1),d(2,"translate"),l(),a(3,"button",11),b("click",function(){h(e);let n=m();return y(n.select())}),u(4),d(5,"translate"),l()}if(t&2){let e=m();r(),v(s(2,3,"common.cancel")),r(2),o("disabled",e.useExisting&&!e.selectedAddress||e.createNew&&e.addressForm.invalid),r(),_(" ",s(5,5,"common.okay")," ")}}var fn=(()=>{class t{constructor(e,i){this.dataService=e,this.formBuilder=i,this.useExisting=!0,this.createNew=!1}ngOnInit(){this.addressForm=this.formBuilder.group({fullName:[this.currentAddress?.fullName??""],company:[this.currentAddress?.company??""],streetLine1:[this.currentAddress?.streetLine1??"",re.required],streetLine2:[this.currentAddress?.streetLine2??""],city:[this.currentAddress?.city??"",re.required],province:[this.currentAddress?.province??""],postalCode:[this.currentAddress?.postalCode??"",re.required],countryCode:[this.currentAddress?.countryCode??"",re.required],phoneNumber:[this.currentAddress?.phoneNumber??""]}),this.useExisting=!!this.customerId,this.addresses$=this.customerId?this.dataService.query(ui,{customerId:this.customerId}).mapSingle(({customer:e})=>e?.addresses??[]).pipe(ze(e=>{this.currentAddress&&(this.selectedAddress=e.find(i=>i.streetLine1===this.currentAddress?.streetLine1&&i.postalCode===this.currentAddress?.postalCode)),e.length===0&&(this.createNew=!0,this.useExisting=!1)})):ce([]),this.availableCountries$=this.dataService.settings.getAvailableCountries().mapSingle(({countries:e})=>e.items)}trackByFn(e){return e.id}addressIdFn(e){return e.streetLine1+e.postalCode}cancel(){this.resolveWith()}select(){if(this.useExisting&&this.selectedAddress&&this.resolveWith(se(G({},(0,Nr.pick)(this.selectedAddress,["fullName","company","streetLine1","streetLine2","city","province","phoneNumber","postalCode"])),{countryCode:this.selectedAddress.country.code})),this.createNew&&this.addressForm.valid){let e=this.addressForm.value;this.resolveWith(e)}}static{this.\u0275fac=function(i){return new(i||t)(P(Z),P(Tt))}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-select-address-dialog"]],standalone:!1,decls:4,vars:3,consts:[["vdrDialogTitle",""],[4,"ngIf"],["vdrDialogButtons",""],["clrTabLink",""],[3,"clrIfActiveChange","clrIfActive"],[1,"block","mt-4",3,"selectItem","idFn","selectedItemId"],[3,"item",4,"ngFor","ngForOf"],[3,"item"],[3,"address"],[3,"formGroup","availableCountries"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"click","disabled"]],template:function(i,n){i&1&&(f(0,Jo,2,3,"ng-template",0)(1,ia,7,5,"clr-tabs",1),d(2,"async"),f(3,na,6,7,"ng-template",2)),i&2&&(r(),o("ngIf",s(2,1,n.addresses$)))},dependencies:[vi,xi,Si,Oi,bi,hi,yi,M,w,Ze,Ke,ae,te,Ge,ki,Ni,Ri,W,I],encapsulation:2,changeDetection:0})}}return t})();function ra(t,p){if(t&1&&(u(0),d(1,"translate")),t&2){let e=m();v(s(1,1,e.title))}}function oa(t,p){t&1&&Je(0)}function aa(t,p){if(t&1){let e=S();a(0,"vdr-form-field",7),d(1,"translate"),a(2,"textarea",8),$("ngModelChange",function(n){h(e);let c=m(2);return N(c.note,n)||(c.note=n),y(n)}),l()()}if(t&2){let e=m(2);o("label",s(1,2,"common.add-note")),r(2),R("ngModel",e.note)}}function la(t,p){if(t&1&&(T(0),f(1,oa,1,0,"ng-container",5)(2,aa,3,4,"vdr-form-field",6),D()),t&2){let e=m(),i=Y(4);r(),o("ngTemplateOutlet",i),r(),o("ngIf",e.includeNoteInput)}}function da(t,p){t&1&&Je(0)}function pa(t,p){if(t&1&&(a(0,"clr-tab-content")(1,"div",12),f(2,da,1,0,"ng-container",5),l()()),t&2){m(2);let e=Y(4);r(2),o("ngTemplateOutlet",e)}}function sa(t,p){if(t&1&&(a(0,"clr-tab-content")(1,"form",13)(2,"vdr-form-field",14),d(3,"translate"),g(4,"input",15),l(),a(5,"vdr-form-field",16),d(6,"translate"),g(7,"input",17),l(),a(8,"vdr-form-field",18),d(9,"translate"),g(10,"input",19),l(),a(11,"vdr-form-field",20),d(12,"translate"),g(13,"input",21),l(),a(14,"vdr-form-field",22),d(15,"translate"),g(16,"input",23),l()()()),t&2){let e=m(3);r(),o("formGroup",e.customerForm),r(),o("label",s(3,6,"customer.title")),r(3),o("label",s(6,8,"customer.first-name")),r(3),o("label",s(9,10,"customer.last-name")),r(3),o("label",s(12,12,"customer.email-address")),r(3),o("label",s(15,14,"customer.phone-number"))}}function ca(t,p){if(t&1){let e=S();a(0,"clr-tab")(1,"button",10),u(2),d(3,"translate"),l(),f(4,sa,17,16,"ng-template",11),$("clrIfActiveChange",function(n){h(e);let c=m(2);return N(c.createNew,n)||(c.createNew=n),y(n)}),l()}if(t&2){let e=m(2);r(2),v(s(3,2,"customer.create-new-customer")),r(2),R("clrIfActive",e.createNew)}}function ma(t,p){if(t&1){let e=S();a(0,"clr-tabs",9)(1,"clr-tab")(2,"button",10),u(3),d(4,"translate"),l(),f(5,pa,3,1,"ng-template",11),$("clrIfActiveChange",function(n){h(e);let c=m();return N(c.useExisting,n)||(c.useExisting=n),y(n)}),l(),f(6,ca,5,4,"clr-tab",2),l()}if(t&2){let e=m();r(3),v(s(4,3,"order.existing-customer")),r(2),R("clrIfActive",e.useExisting),r(),o("ngIf",e.canCreateNew)}}function ua(t,p){if(t&1&&(a(0,"span",27),g(1,"clr-icon",28),a(2,"span",29),u(3),l(),a(4,"vdr-chip"),u(5),l()()),t&2){let e=p.item;r(3),ie("",e.firstName," ",e.lastName,""),r(2),v(e.emailAddress)}}function fa(t,p){if(t&1&&(a(0,"span",27),g(1,"clr-icon",28),a(2,"span",29),u(3),l(),a(4,"vdr-chip"),u(5),l()()),t&2){let e=p.item;r(3),ie("",e.firstName," ",e.lastName,""),r(2),v(e.emailAddress)}}function _a(t,p){if(t&1){let e=S();a(0,"ng-select",24),d(1,"async"),$("ngModelChange",function(n){h(e);let c=m();return N(c.selectedCustomer,n)||(c.selectedCustomer=n),y(n)}),f(2,ua,6,3,"ng-template",25)(3,fa,6,3,"ng-template",26),l()}if(t&2){let e=m();o("items",s(1,9,e.customers$))("addTag",!1)("multiple",!0)("hideSelected",!0)("trackByFn",e.trackByFn)("minTermLength",2)("loading",e.isLoading)("typeahead",e.input$),R("ngModel",e.selectedCustomer)}}function ga(t,p){if(t&1){let e=S();a(0,"button",30),b("click",function(){h(e);let n=m();return y(n.cancel())}),u(1),d(2,"translate"),l(),a(3,"button",31),b("click",function(){h(e);let n=m();return y(n.select())}),u(4),d(5,"translate"),l()}if(t&2){let e=m();r(),v(s(2,3,"common.cancel")),r(2),o("disabled",e.useExisting&&e.selectedCustomer.length===0||e.createNew&&e.customerForm.invalid),r(),_(" ",s(5,5,"common.okay")," ")}}var Qi=(()=>{class t{constructor(e,i){this.dataService=e,this.formBuilder=i,this.canCreateNew=!0,this.includeNoteInput=!1,this.title="order.set-customer-for-order",this.isLoading=!1,this.input$=new Be,this.selectedCustomer=[],this.useExisting=!0,this.createNew=!1,this.note="",this.customerForm=this.formBuilder.group({title:"",firstName:["",re.required],lastName:["",re.required],phoneNumber:"",emailAddress:["",[re.required,re.email]]})}ngOnInit(){this.customers$=Kt(ce([]),this.input$.pipe(_t(200),ni(),ze(()=>this.isLoading=!0),L(e=>this.dataService.customer.getCustomerList(10,0,e).mapStream(({customers:i})=>i.items).pipe(ti(()=>ce([])),ze(()=>this.isLoading=!1)))))}trackByFn(e){return e.id}cancel(){this.resolveWith()}select(){if(this.useExisting&&this.selectedCustomer.length===1)this.resolveWith(se(G({},this.selectedCustomer[0]),{note:this.note}));else if(this.createNew&&this.customerForm.valid){let e=this.customerForm.value;this.resolveWith(se(G({},e),{note:this.note}))}}static{this.\u0275fac=function(i){return new(i||t)(P(Z),P(Tt))}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-select-customer-dialog"]],standalone:!1,decls:6,vars:2,consts:[["customerSelect",""],["vdrDialogTitle",""],[4,"ngIf"],["class","pt-1",4,"ngIf"],["vdrDialogButtons",""],[4,"ngTemplateOutlet"],["class","mt-4",3,"label",4,"ngIf"],[1,"mt-4",3,"label"],[3,"ngModelChange","ngModel"],[1,"pt-1"],["clrTabLink",""],[3,"clrIfActiveChange","clrIfActive"],[1,"mt-4"],[3,"formGroup"],["for","title",3,"label"],["id","title","type","text","formControlName","title"],["for","firstName",3,"label"],["id","firstName","type","text","formControlName","firstName"],["for","lastName",3,"label"],["id","lastName","type","text","formControlName","lastName"],["for","emailAddress",3,"label"],["id","emailAddress","type","text","formControlName","emailAddress"],["for","phoneNumber",3,"label"],["id","phoneNumber","type","text","formControlName","phoneNumber"],["appendTo","body","bindLabel","name",3,"ngModelChange","items","addTag","multiple","hideSelected","trackByFn","minTermLength","loading","typeahead","ngModel"],["ng-label-tmp",""],["ng-option-tmp",""],[1,"item-row"],["shape","user",1,"is-solid"],[1,"mx-1"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"click","disabled"]],template:function(i,n){i&1&&f(0,ra,2,3,"ng-template",1)(1,la,3,2,"ng-container",2)(2,ma,7,5,"clr-tabs",3)(3,_a,4,11,"ng-template",null,0,ee)(5,ga,6,7,"ng-template",4),i&2&&(r(),o("ngIf",!n.canCreateNew),r(),o("ngIf",n.canCreateNew))},dependencies:[B,vi,xi,Si,Oi,bi,hi,yi,w,si,St,ne,z,Ze,oe,Ke,It,We,Di,ur,ue,ve,U,ae,te,W,I],styles:[`.item-row[_ngcontent-%COMP%]{display:flex;align-items:center}clr-tabs[_ngcontent-%COMP%]{display:block}
/*# sourceMappingURL=select-customer-dialog.component-JYJTGP47.css.map */`],changeDetection:0})}}return t})();function Ca(t,p){t&1&&(u(0),d(1,"translate")),t&2&&v(s(1,1,"order.select-shipping-method"))}function va(t,p){if(t&1&&g(0,"vdr-object-tree",9),t&2){let e=m().$implicit;o("value",e.metadata)}}function ha(t,p){if(t&1&&(a(0,"vdr-radio-card",4)(1,"div",5)(2,"vdr-labeled-data",6),d(3,"translate"),u(4),l(),a(5,"div",7)(6,"vdr-labeled-data",6),d(7,"translate"),u(8),d(9,"localeCurrency"),l(),a(10,"vdr-labeled-data",6),d(11,"translate"),u(12),d(13,"localeCurrency"),l()(),f(14,va,1,1,"vdr-object-tree",8),l()()),t&2){let e=p.$implicit,i=m();o("item",e),r(2),o("label",s(3,8,"settings.shipping-method")),r(2),_(" ",e.name," "),r(2),o("label",s(7,10,"common.price")),r(2),_(" ",x(9,12,e.price,i.currencyCode)," "),r(2),o("label",s(11,15,"common.price-with-tax")),r(2),_(" ",x(13,17,e.priceWithTax,i.currencyCode)," "),r(2),o("ngIf",e.metadata)}}function ya(t,p){if(t&1){let e=S();a(0,"button",10),b("click",function(){h(e);let n=m();return y(n.cancel())}),u(1),d(2,"translate"),l(),a(3,"button",11),b("click",function(){h(e);let n=m();return y(n.select())}),u(4),d(5,"translate"),l()}if(t&2){let e=m();r(),v(s(2,3,"common.cancel")),r(2),o("disabled",!e.selectedMethod),r(),_(" ",s(5,5,"common.okay")," ")}}var Xi=(()=>{class t{ngOnInit(){this.currentSelectionId&&(this.selectedMethod=this.eligibleShippingMethods.find(e=>e.id===this.currentSelectionId))}methodIdFn(e){return e.id}cancel(){this.resolveWith()}select(){this.selectedMethod&&this.resolveWith(this.selectedMethod.id)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-select-shipping-method-dialog"]],standalone:!1,decls:4,vars:3,consts:[["vdrDialogTitle",""],[3,"selectItem","idFn","selectedItemId"],[3,"item",4,"ngFor","ngForOf"],["vdrDialogButtons",""],[3,"item"],[1,"result-details"],[3,"label"],[1,"price-row"],[3,"value",4,"ngIf"],[3,"value"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"click","disabled"]],template:function(i,n){i&1&&(f(0,Ca,2,3,"ng-template",0),a(1,"vdr-radio-card-fieldset",1),b("selectItem",function(C){return n.selectedMethod=C}),f(2,ha,15,20,"vdr-radio-card",2),l(),f(3,ya,6,7,"ng-template",3)),i&2&&(r(),o("idFn",n.methodIdFn)("selectedItemId",n.selectedMethod==null?null:n.selectedMethod.id),r(),o("ngForOf",n.eligibleShippingMethods))},dependencies:[M,w,ae,te,X,He,Ni,Ri,I,k],encapsulation:2,changeDetection:0})}}return t})();var xa=t=>({state:t});function ba(t,p){t&1&&(u(0),d(1,"translate")),t&2&&v(s(1,1,"order.select-state"))}function Sa(t,p){if(t&1&&(a(0,"option",4),u(1),d(2,"stateI18nToken"),d(3,"translate"),l()),t&2){let e=p.$implicit;o("value",e),r(),_(" ",s(3,4,s(2,2,e))," ")}}function Oa(t,p){if(t&1){let e=S();a(0,"button",7),b("click",function(){h(e);let n=m(2);return y(n.cancel())}),u(1),d(2,"translate"),l()}t&2&&(r(),_(" ",s(2,1,"common.cancel")," "))}function Ia(t,p){if(t&1){let e=S();f(0,Oa,3,3,"button",5),a(1,"button",6),b("click",function(){h(e);let n=m();return y(n.select())}),u(2),d(3,"stateI18nToken"),d(4,"translate"),d(5,"translate"),l()}if(t&2){let e=m();o("ngIf",e.cancellable),r(),o("disabled",!e.selectedState),r(),_(" ",x(5,7,"order.transition-to-state",A(10,xa,s(4,5,s(3,3,e.selectedState))))," ")}}var $r=(()=>{class t{constructor(){this.nextStates=[],this.message="",this.selectedState=""}select(){this.selectedState&&this.resolveWith(this.selectedState)}cancel(){this.resolveWith()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-order-state-select-dialog"]],standalone:!1,decls:8,vars:5,consts:[["vdrDialogTitle",""],["name","state",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["vdrDialogButtons",""],[3,"value"],["type","submit","class","btn btn-secondary",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-primary",3,"click","disabled"],["type","submit",1,"btn","btn-secondary",3,"click"]],template:function(i,n){i&1&&(f(0,ba,2,3,"ng-template",0),a(1,"p"),u(2),d(3,"translate"),l(),a(4,"vdr-form-field")(5,"select",1),$("ngModelChange",function(C){return N(n.selectedState,C)||(n.selectedState=C),C}),f(6,Sa,4,6,"option",2),l()(),f(7,Ia,6,12,"ng-template",3)),i&2&&(r(2),v(s(3,3,n.message)),r(3),R("ngModel",n.selectedState),r(),o("ngForOf",n.nextStates))},dependencies:[M,w,or,ar,rr,z,oe,ve,U,ae,te,I,fe],encapsulation:2,changeDetection:0})}}return t})();var Vt=(()=>{class t{constructor(e,i,n,c){this.dataService=e,this.modalService=i,this.notificationService=n,this.i18nService=c}transitionToPreModifyingState(e,i){return this.getPreModifyingState(e).pipe(L(n=>{let c={orderId:e,nextStates:i,message:this.i18nService.translate("order.unable-to-transition-to-state-try-another",{state:n}),cancellable:!1,retry:10};return n?this.transitionToStateOrThrow(e,n).pipe(ti(C=>this.manuallyTransitionToState(c))):this.manuallyTransitionToState(c)}))}manuallyTransitionToState(e){return this.modalService.fromComponent($r,{locals:{nextStates:e.nextStates,cancellable:e.cancellable,message:e.message},closable:!1,size:"md"}).pipe(L(i=>{if(i)return this.transitionToStateOrThrow(e.orderId,i);if(e.cancellable)return Fe;throw new Error("An order state must be selected")}),wn(i=>i.pipe(Dn(2e3),Oe(e.retry))))}getPreModifyingState(e){return this.dataService.order.getOrderHistory(e,{filter:{type:{eq:q.ORDER_STATE_TRANSITION}},sort:{createdAt:vt.DESC}}).mapSingle(i=>i.order).pipe(_e(i=>{let n=i?.history.items.find(c=>c.data.to==="Modifying");if(n)return n.data.from}))}transitionToStateOrThrow(e,i){return this.dataService.order.transitionToState(e,i).pipe(_e(({transitionOrderToState:n})=>{switch(n?.__typename){case"Order":return n?.state;case"OrderStateTransitionError":throw this.notificationService.error(n?.transitionError),new Error(n?.transitionError)}}))}static{this.\u0275fac=function(i){return new(i||t)(ke(Z),ke(je),ke(it),ke(yt))}}static{this.\u0275prov=oi({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function Ta(t,p){if(t&1){let e=S();a(0,"button",9),b("click",function(){h(e);let n=m(2);return y(n.editable=!0)}),g(1,"clr-icon",10),u(2),d(3,"translate"),l()}t&2&&(r(2),_(" ",s(3,1,"common.edit")," "))}function Da(t,p){if(t&1){let e=S();a(0,"button",11),b("click",function(){h(e);let n=m(2);return y(n.onUpdateClick())}),g(1,"clr-icon",12),u(2),d(3,"translate"),l()}if(t&2){let e=m(2);o("disabled",e.customFieldForm.pristine||e.customFieldForm.invalid),r(2),_(" ",s(3,2,"common.update")," ")}}function wa(t,p){if(t&1){let e=S();a(0,"button",9),b("click",function(){h(e);let n=m(2);return y(n.onCancelClick())}),g(1,"clr-icon",13),u(2),d(3,"translate"),l()}t&2&&(r(2),_(" ",s(3,1,"common.cancel")," "))}function Pa(t,p){if(t&1&&(a(0,"div",1)(1,"div",2),u(2),d(3,"translate"),l(),a(4,"div",3)(5,"div",4),g(6,"vdr-tabbed-custom-fields",5),l()(),a(7,"div",6),f(8,Ta,4,3,"button",7)(9,Da,4,4,"button",8)(10,wa,4,3,"button",7),l()()),t&2){let e=m();r(2),_(" ",s(3,10,"common.custom-fields")," "),r(3),Q("editable",e.editable),r(),o("customFields",e.customFieldsConfig)("customFieldsFormGroup",e.customFieldForm)("readonly",!e.editable)("compact",!0),r(2),o("ngIf",!e.editable),r(),o("ngIf",e.editable),r(),o("ngIf",e.editable)}}var jr=(()=>{class t{constructor(e,i){this.formBuilder=e,this.modalService=i,this.customFieldsConfig=[],this.customFieldValues={},this.updateClick=new J,this.editable=!1}ngOnInit(){this.customFieldForm=this.formBuilder.group({});for(let e of this.customFieldsConfig)this.customFieldForm.addControl(e.name,this.formBuilder.control(this.customFieldValues[e.name]))}onUpdateClick(){this.updateClick.emit(this.customFieldForm.value),this.customFieldForm.markAsPristine(),this.editable=!1}onCancelClick(){this.customFieldForm.dirty?this.modalService.dialog({title:"catalog.confirm-cancel",buttons:[{type:"secondary",label:"common.keep-editing"},{type:"danger",label:"common.discard-changes",returnValue:!0}]}).subscribe(e=>{e&&(this.customFieldForm.reset(),this.customFieldForm.markAsPristine(),this.editable=!1)}):this.editable=!1}static{this.\u0275fac=function(i){return new(i||t)(P(Tt),P(je))}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-order-custom-fields-card"]],inputs:{customFieldsConfig:"customFieldsConfig",customFieldValues:"customFieldValues"},outputs:{updateClick:"updateClick"},standalone:!1,decls:1,vars:1,consts:[["class","card",4,"ngIf"],[1,"card"],[1,"card-header"],[1,"card-block"],[1,"card-text","custom-field-form"],["entityName","Order",3,"customFields","customFieldsFormGroup","readonly","compact"],[1,"card-footer"],["class","btn btn-sm btn-secondary",3,"click",4,"ngIf"],["class","btn btn-sm btn-primary",3,"disabled","click",4,"ngIf"],[1,"btn","btn-sm","btn-secondary",3,"click"],["shape","pencil"],[1,"btn","btn-sm","btn-primary",3,"click","disabled"],["shape","check"],["shape","times"]],template:function(i,n){i&1&&f(0,Pa,11,12,"div",0),i&2&&o("ngIf",n.customFieldsConfig.length)},dependencies:[B,w,nt,I],styles:[`vdr-custom-field-control[_ngcontent-%COMP%]{margin-bottom:6px;display:block}.custom-field-form[_ngcontent-%COMP%]     .clr-control-label{color:var(--color-grey-400)}.custom-field-form.editable[_ngcontent-%COMP%]     .clr-control-label{color:inherit}
/*# sourceMappingURL=order-custom-fields-card.component-C6XUD4MN.css.map */`],changeDetection:0})}}return t})();var qr=Ee(mt());var Fa=(t,p)=>({total:t,count:p}),Ea=t=>({count:t});function Ba(t,p){t&1&&g(0,"clr-icon",9)}function ka(t,p){t&1&&g(0,"clr-icon",10)}function La(t,p){t&1&&g(0,"clr-icon",11)}function Aa(t,p){t&1&&(a(0,"label",12),u(1),d(2,"translate"),l()),t&2&&(r(),_(" ",s(2,1,"order.line-fulfillment-all")," "))}function Va(t,p){if(t&1&&(a(0,"label",12),u(1),d(2,"translate"),l()),t&2){let e=m(2);r(),_(" ",x(2,1,"order.line-fulfillment-partial",Xe(4,Fa,e.line.quantity,e.fulfilledCount))," ")}}function Ra(t,p){t&1&&(a(0,"label",12),u(1),d(2,"translate"),l()),t&2&&(r(),_(" ",s(2,1,"order.line-fulfillment-none")," "))}function Na(t,p){if(t&1&&(a(0,"vdr-labeled-data",15),d(1,"translate"),u(2),l()),t&2){let e=m().$implicit;o("label",s(1,2,"order.tracking-code")),r(2),_(" ",e.fulfillment.trackingCode," ")}}function $a(t,p){if(t&1&&(a(0,"div",13)(1,"div",14),u(2),d(3,"translate"),d(4,"translate"),l(),a(5,"vdr-labeled-data",15),d(6,"translate"),u(7),d(8,"localeDate"),l(),a(9,"vdr-labeled-data",15),d(10,"translate"),u(11),l(),f(12,Na,3,4,"vdr-labeled-data",16),l()),t&2){let e=p.$implicit;r(2),di(" ",s(3,8,"order.fulfillment")," #",e.fulfillment.id," (",x(4,10,"order.item-count",A(20,Ea,e.count)),") "),r(3),o("label",s(6,13,"common.created-at")),r(2),_(" ",x(8,15,e.fulfillment.createdAt,"medium")," "),r(2),o("label",s(10,18,"order.fulfillment-method")),r(2),_(" ",e.fulfillment.method," "),r(),o("ngIf",e.fulfillment.trackingCode)}}function ja(t,p){if(t&1&&(a(0,"vdr-dropdown",1)(1,"button",2),f(2,Ba,1,0,"clr-icon",3)(3,ka,1,0,"clr-icon",4)(4,La,1,0,"clr-icon",5),l(),a(5,"vdr-dropdown-menu",6),f(6,Aa,3,3,"label",7)(7,Va,3,7,"label",7)(8,Ra,3,3,"label",7)(9,$a,13,22,"div",8),l()()),t&2){let e=m();r(2),o("ngIf",e.fulfillmentStatus==="full"),r(),o("ngIf",e.fulfillmentStatus==="partial"),r(),o("ngIf",e.fulfillmentStatus==="none"),r(2),o("ngIf",e.fulfillmentStatus==="full"),r(),o("ngIf",e.fulfillmentStatus==="partial"),r(),o("ngIf",e.fulfillmentStatus==="none"),r(),o("ngForOf",e.fulfillments)}}var Yi=(()=>{class t{constructor(){this.fulfilledCount=0,this.fulfillments=[]}ngOnChanges(e){this.line&&(this.fulfilledCount=this.getDeliveredCount(this.line),this.fulfillmentStatus=this.getFulfillmentStatus(this.fulfilledCount,this.line.quantity),this.fulfillments=this.getFulfillments(this.line))}getDeliveredCount(e){return e.fulfillmentLines?.reduce((i,n)=>i+n.quantity,0)??0}getFulfillmentStatus(e,i){return e===i?"full":0<e&&e<i?"partial":"none"}getFulfillments(e){return e.fulfillmentLines?.map(i=>{let n=this.allOrderFulfillments?.find(c=>c.id===i.fulfillmentId);if(n)return{count:i.quantity,fulfillment:n}}).filter(qr.notNullOrUndefined)??[]}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-line-fulfillment"]],inputs:{line:"line",allOrderFulfillments:"allOrderFulfillments",orderState:"orderState"},standalone:!1,features:[Le],decls:1,vars:1,consts:[["class","search-settings-menu",4,"ngIf"],[1,"search-settings-menu"],["type","button","vdrDropdownTrigger","",1,"icon-button"],["class","item-fulfilled","shape","check-circle",4,"ngIf"],["class","item-partially-fulfilled","shape","check-circle",4,"ngIf"],["class","item-not-fulfilled","shape","exclamation-circle",4,"ngIf"],["vdrPosition","bottom-right"],["class","dropdown-header",4,"ngIf"],["class","fulfillment-detail",4,"ngFor","ngForOf"],["shape","check-circle",1,"item-fulfilled"],["shape","check-circle",1,"item-partially-fulfilled"],["shape","exclamation-circle",1,"item-not-fulfilled"],[1,"dropdown-header"],[1,"fulfillment-detail"],[1,"fulfillment-title"],[3,"label"],[3,"label",4,"ngIf"]],template:function(i,n){i&1&&f(0,ja,10,7,"vdr-dropdown",0),i&2&&o("ngIf",n.fulfilledCount||n.orderState==="PartiallyDelivered")},dependencies:[B,Ce,M,w,Te,De,we,X,I,he],styles:[`.item-fulfilled[_ngcontent-%COMP%]{color:var(--color-success-700)}.item-partially-fulfilled[_ngcontent-%COMP%]{color:var(--color-warning-700)}.item-not-fulfilled[_ngcontent-%COMP%]{color:var(--color-error-700)}.fulfillment-detail[_ngcontent-%COMP%]{margin:6px 12px}.fulfillment-detail[_ngcontent-%COMP%]:not(:last-of-type){border-bottom:1px dashed var(--color-component-border-200)}
/*# sourceMappingURL=line-fulfillment.component-NRVZKNUT.css.map */`],changeDetection:0})}}return t})();var Wa=t=>({count:t});function Ha(t,p){if(t&1&&(a(0,"span",1),d(1,"translate"),g(2,"clr-icon",2),l()),t&2){let e=m();o("title",x(1,1,"order.refunded-count",A(4,Wa,e.getRefundedCount())))}}var Nt=(()=>{class t{getRefundedCount(){return(this.payments?.reduce((i,n)=>[...i,...n.refunds],[]).filter(i=>i.state!=="Failed").reduce((i,n)=>[...i,...n.lines],[])??[]).filter(i=>i.orderLineId===this.line.id).reduce((i,n)=>i+n.quantity,0)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-line-refunds"]],inputs:{line:"line",payments:"payments"},standalone:!1,decls:1,vars:1,consts:[[3,"title",4,"ngIf"],[3,"title"],["shape","redo","dir","down",1,"is-solid"]],template:function(i,n){i&1&&f(0,Ha,3,6,"span",0),i&2&&o("ngIf",n.getRefundedCount())},dependencies:[B,w,Ci,I],styles:[`[_nghost-%COMP%]{color:var(--color-error-500)}
/*# sourceMappingURL=line-refunds.component-NWRDHF3D.css.map */`],changeDetection:0})}}return t})();var Ji=(()=>{class t extends Ue{constructor(){super(...arguments),this.orderable=!1}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=ai(t)))(n||t)}})()}static{this.\u0275cmp=O({type:t,selectors:[["vdr-order-total-column"]],exportAs:["row"],standalone:!1,features:[Ie],decls:0,vars:0,template:function(i,n){},encapsulation:2})}}return t})();var Ga=[[["vdr-bulk-action-menu"]]],Qa=["vdr-bulk-action-menu"],za=(t,p,e,i)=>({id:t,itemsPerPage:p,currentPage:e,totalItems:i}),Xa=t=>({rowItem:t}),Ya=(t,p)=>({item:t,index:p});function Ja(t,p){if(t&1){let e=S();a(0,"th",19)(1,"input",20),b("change",function(){h(e);let n=m();return y(n.onToggleAllClick())}),l()()}if(t&2){let e=m();r(),o("checked",e.selectionManager==null?null:e.selectionManager.areAllCurrentItemsSelected())}}function Za(t,p){t&1&&g(0,"clr-icon",30)}function Ka(t,p){t&1&&g(0,"clr-icon",31)}function el(t,p){t&1&&g(0,"clr-icon",32)}function tl(t,p){if(t&1&&(a(0,"div",33),u(1),l()),t&2){let e=m().ngIf;r(),v(e.sortOrder)}}function il(t,p){if(t&1){let e=S();a(0,"div",24)(1,"button",25),b("click",function(){let n=h(e).ngIf;return y(n.toggleSortOrder())}),f(2,Za,1,0,"clr-icon",26)(3,Ka,1,0,"clr-icon",27)(4,el,1,0,"clr-icon",28),l(),f(5,tl,2,1,"div",29),l()}if(t&2){let e=p.ngIf;r(),Q("active",e.sortOrder),r(),o("ngIf",!e.sortOrder),r(),o("ngIf",e.sortOrder==="ASC"),r(),o("ngIf",e.sortOrder==="DESC"),r(),o("ngIf",e.sortOrder)}}function nl(t,p){if(t&1&&(a(0,"th")(1,"div",21)(2,"vdr-ui-extension-point",22)(3,"span"),u(4),l()(),f(5,il,6,6,"div",23),l()()),t&2){let e=p.$implicit,i=m();Q("expand",e.expand),r(),o("ngClass",e.align),r(),o("locationId",i.id)("metadata",e.id)("topPx",-6)("leftPx",-24),r(2),v(e.heading),r(),o("ngIf",e.sort)}}function rl(t,p){t&1&&Je(0)}function ol(t,p){t&1&&Je(0)}function al(t,p){if(t&1&&g(0,"vdr-data-table-filters",42),t&2){let e=p.$implicit,i=m(3);o("filterWithValue",e)("filters",i.filters)}}function ll(t,p){if(t&1&&g(0,"vdr-data-table-filters",43),t&2){let e=m(3);o("filters",e.filters)}}function dl(t,p){if(t&1&&(T(0),a(1,"div",39),f(2,al,1,2,"vdr-data-table-filters",40)(3,ll,1,1,"vdr-data-table-filters",41),l(),D()),t&2){let e=m(2);r(2),o("ngForOf",e.filters.activeFilters),r(),o("ngIf",e.filters.length)}}function pl(t,p){if(t&1){let e=S();a(0,"tr")(1,"th",34)(2,"button",35),d(3,"translate"),b("click",function(){h(e);let n=m();return y(n.toggleSearchFilterRow())}),g(4,"clr-icon",36),l(),a(5,"div",37),f(6,rl,1,0,"ng-container",38)(7,ol,1,0,"ng-container",38)(8,dl,4,2,"ng-container",9),l()()()}if(t&2){let e=m();r(),Q("active",e.showSearchFilterRow),Ae("colspan",e.visibleSortedColumns.length+(e.selectionManager?2:1)),r(),Q("active",e.showSearchFilterRow),o("title",s(3,11,"common.search-and-filter-list")),r(3),Q("hidden",!e.showSearchFilterRow),r(),o("ngTemplateOutlet",e.searchComponent==null?null:e.searchComponent.template),r(),o("ngTemplateOutlet",e.customSearchTemplate),r(),o("ngIf",e.filters)}}function sl(t,p){if(t&1){let e=S();a(0,"td",19)(1,"input",46),b("click",function(n){h(e);let c=m().$implicit,C=m();return y(C.onRowClick(c,n))}),l()()}if(t&2){let e=m(),i=e.$implicit,n=e.index,c=m();Q("active",c.activeIndex===n),r(),o("checked",c.selectionManager==null?null:c.selectionManager.isSelected(i))}}function cl(t,p){t&1&&Je(0)}function ml(t,p){if(t&1&&(T(0),f(1,cl,1,0,"ng-container",48),D()),t&2){let e=p.ngIf,i=m(2).$implicit;r(),o("ngComponentOutlet",e.config.component)("ngComponentOutletInputs",A(3,Xa,i))("ngComponentOutletInjector",e.injector)}}function ul(t,p){t&1&&Je(0)}function fl(t,p){if(t&1&&f(0,ul,1,0,"ng-container",49),t&2){let e=m().$implicit,i=m(),n=i.$implicit,c=i.index;o("ngTemplateOutlet",e.template)("ngTemplateOutletContext",Xe(2,Ya,n,c))}}function _l(t,p){if(t&1&&(a(0,"td")(1,"div",21),f(2,ml,2,5,"ng-container",47)(3,fl,1,5,"ng-template",null,0,ee),l()()),t&2){let e=p.$implicit,i=Y(4),n=m().index,c=m();Q("active",c.activeIndex===n),r(),o("ngClass",e.align),r(),o("ngIf",c.customComponents.get(e.id))("ngIfElse",i)}}function gl(t,p){if(t&1&&(a(0,"tr"),f(1,sl,2,3,"td",44)(2,_l,5,5,"td",45),g(3,"td"),l()),t&2){let e=p.index,i=m();r(),o("ngIf",i.selectionManager),r(),o("ngForOf",i.visibleSortedColumns),r(),Q("active",i.activeIndex===e)}}function Cl(t,p){if(t&1&&(a(0,"tr")(1,"td"),g(2,"vdr-empty-placeholder",50),d(3,"translate"),l()()),t&2){let e=m();r(),Ae("colspan",e.visibleSortedColumns.length+(e.selectionManager?2:1)),r(),o("emptyStateLabel",s(3,2,"order.order-is-empty"))}}function vl(t,p){if(t&1&&(a(0,"tr",51)(1,"td",52),u(2),l(),a(3,"td",53),u(4),l(),g(5,"td",54),a(6,"td",55),u(7),d(8,"localeCurrency"),a(9,"div",15),d(10,"translate"),u(11),d(12,"localeCurrency"),l()(),g(13,"td"),l()),t&2){let e=p.$implicit,i=m();r(2),v(e.description),r(2),v(e.sku),r(),Ae("colspan",i.visibleSortedColumns.length-4),r(2),_(" ",x(8,6,e.priceWithTax,i.order.currencyCode)," "),r(2),o("title",s(10,9,"order.net-price")),r(2),_(" ",x(12,11,e.price,i.order.currencyCode)," ")}}function hl(t,p){if(t&1&&(a(0,"vdr-chip"),u(1),l()),t&2){let e=p.ngIf;r(),v(e)}}function yl(t,p){if(t&1&&(a(0,"tr",57)(1,"td",3)(2,"a",58),u(3),l(),f(4,hl,2,1,"vdr-chip",9),l(),a(5,"td",3),u(6),d(7,"localeCurrency"),a(8,"div",15),d(9,"translate"),u(10),d(11,"localeCurrency"),l()(),g(12,"td"),l()),t&2){let e=m().$implicit,i=m();r(),Ae("colspan",i.visibleSortedColumns.length-1),r(),o("routerLink",i.getPromotionLink(e)),r(),v(e.description),r(),o("ngIf",i.getCouponCodeForAdjustment(i.order,e)),r(2),_(" ",x(7,7,e.amountWithTax,i.order.currencyCode)," "),r(2),o("title",s(9,10,"order.net-price")),r(2),_(" ",x(11,12,e.amount,i.order.currencyCode)," ")}}function xl(t,p){if(t&1&&(T(0),f(1,yl,13,15,"tr",56),D()),t&2){let e=p.$implicit;r(),o("ngIf",e.type!=="OTHER")}}function bl(t,p){if(t&1&&(a(0,"vdr-chip",59),u(1),l()),t&2){let e=p.$implicit;r(),_(" ",e.shippingMethod.name," ")}}var Hr=(()=>{class t extends lt{get allColumns(){return[...this.columns??[],...this.customFieldColumns??[],...this.totalColumns??[]]}getPromotionLink(e){return["/marketing","promotions",e.adjustmentSource.split(":")[1]]}getCouponCodeForAdjustment(e,i){let n=i.adjustmentSource.split(":")[1],c=e.promotions.find(C=>C.id===n);if(c)return c.couponCode||void 0}getShippingNames(e){return e.shippingLines.length?e.shippingLines.map(i=>i.shippingMethod.name).join(", "):""}static{this.\u0275fac=(()=>{let e;return function(n){return(e||(e=ai(t)))(n||t)}})()}static{this.\u0275cmp=O({type:t,selectors:[["vdr-order-data-table"]],contentQueries:function(i,n,c){if(i&1&&Vn(c,Ji,4),i&2){let C;gt(C=Ct())&&(n.totalColumns=C)}},inputs:{order:"order"},standalone:!1,features:[Ie],ngContentSelectors:Qa,decls:60,vars:70,consts:[["defaultComponent",""],[1,"bulk-actions"],[1,"table-wrapper"],[1,""],[1,"heading-row"],["class","selection-col",4,"ngIf"],[3,"expand",4,"ngFor","ngForOf"],[1,"column-picker"],[3,"reorder","resetColumns","uiLanguage","columns"],[4,"ngIf"],[4,"ngFor","ngForOf","ngForTrackBy"],["class","surcharge",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"sub-total"],[1,"clr-align-middle"],[1,"net-price",3,"title"],[1,"shipping"],["class","shipping-method-name",4,"ngFor","ngForOf"],[1,"total"],[1,"selection-col"],["type","checkbox","clrCheckbox","",3,"change","checked"],[1,"cell-content",3,"ngClass"],["api","dataTable","display","block",3,"locationId","metadata","topPx","leftPx"],["class","sort-toggle",4,"ngIf"],[1,"sort-toggle"],[3,"click"],["shape","two-way-arrows left",4,"ngIf"],["shape","arrow up",4,"ngIf"],["shape","arrow down",4,"ngIf"],["class","sort-label",4,"ngIf"],["shape","two-way-arrows left"],["shape","arrow up"],["shape","arrow down"],[1,"sort-label"],[1,"filter-row"],[1,"button-ghost","toggle-search-filter-row",3,"click","title"],["shape","search"],[1,"filter-row-wrapper"],[4,"ngTemplateOutlet"],[1,"filters"],["class","mt-1",3,"filterWithValue","filters",4,"ngFor","ngForOf"],["class","mt-1",3,"filters",4,"ngIf"],[1,"mt-1",3,"filterWithValue","filters"],[1,"mt-1",3,"filters"],["class","selection-col",3,"active",4,"ngIf"],[3,"active",4,"ngFor","ngForOf"],["type","checkbox","clrCheckbox","",3,"click","checked"],[4,"ngIf","ngIfElse"],[4,"ngComponentOutlet","ngComponentOutletInputs","ngComponentOutletInjector"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[3,"emptyStateLabel"],[1,"surcharge"],["colspan","2",1,"align-middle","name","left"],[1,"align-middle","sku"],[1,"align-middle"],[1,"align-middle","total"],["class","order-adjustment",4,"ngIf"],[1,"order-adjustment"],[3,"routerLink"],[1,"shipping-method-name"]],template:function(i,n){i&1&&(Ln(Ga),a(0,"div",1),An(1),l(),a(2,"div",2)(3,"table",3)(4,"thead")(5,"tr",4),f(6,Ja,2,1,"th",5)(7,nl,6,9,"th",6),a(8,"th")(9,"div",7)(10,"vdr-data-table-colum-picker",8),d(11,"async"),b("reorder",function(C){return n.onColumnReorder(C)})("resetColumns",function(){return n.onColumnsReset()}),l()()()(),f(12,pl,9,13,"tr",9),l(),a(13,"tbody"),f(14,gl,4,4,"tr",10),d(15,"paginate"),T(16),f(17,Cl,4,4,"tr",9),D(),f(18,vl,14,14,"tr",11)(19,xl,2,1,"ng-container",12),a(20,"tr",13)(21,"td",3),u(22),d(23,"translate"),l(),g(24,"td"),a(25,"td",14),u(26),d(27,"localeCurrency"),a(28,"div",15),d(29,"translate"),u(30),d(31,"localeCurrency"),l()(),g(32,"td"),l(),a(33,"tr",16)(34,"td",3),u(35),d(36,"translate"),l(),a(37,"td"),f(38,bl,2,1,"vdr-chip",17),l(),a(39,"td",14),u(40),d(41,"localeCurrency"),a(42,"div",15),d(43,"translate"),u(44),d(45,"localeCurrency"),l()(),g(46,"td"),l(),a(47,"tr",18)(48,"td",3),u(49),d(50,"translate"),l(),g(51,"td"),a(52,"td",14),u(53),d(54,"localeCurrency"),a(55,"div",15),d(56,"translate"),u(57),d(58,"localeCurrency"),l()(),g(59,"td"),l()()()()),i&2&&(r(3),Q("no-select",n.disableSelect),r(),Q("items-selected",n.selectionManager==null?null:n.selectionManager.selection.length),r(2),o("ngIf",n.selectionManager),r(),o("ngForOf",n.visibleSortedColumns),r(3),o("uiLanguage",s(11,30,n.uiLanguage$))("columns",n.sortedColumns),r(2),o("ngIf",n.searchComponent||n.customSearchTemplate||(n.filters==null?null:n.filters.length)),r(2),o("ngForOf",x(15,32,n.items,Rn(65,za,n.id,n.itemsPerPage,n.currentPage,n.totalItems)))("ngForTrackBy",n.trackByFn.bind(n)),r(3),o("ngIf",!(n.items!=null&&n.items.length)),r(),o("ngForOf",n.order.surcharges),r(),o("ngForOf",n.order.discounts),r(3),v(s(23,35,"order.sub-total")),r(2),Ae("colspan",n.visibleSortedColumns.length-2),r(2),_(" ",x(27,37,n.order.subTotalWithTax,n.order.currencyCode)," "),r(2),o("title",s(29,40,"order.net-price")),r(2),_(" ",x(31,42,n.order.subTotal,n.order.currencyCode)," "),r(5),v(s(36,45,"order.shipping")),r(2),Ae("colspan",n.visibleSortedColumns.length-2),r(),o("ngForOf",n.order.shippingLines),r(2),_(" ",x(41,47,n.order.shippingWithTax,n.order.currencyCode)," "),r(2),o("title",s(43,50,"order.net-price")),r(2),_(" ",x(45,52,n.order.shipping,n.order.currencyCode)," "),r(5),v(s(50,55,"order.total")),r(2),Ae("colspan",n.visibleSortedColumns.length-2),r(2),_(" ",x(54,57,n.order.totalWithTax,n.order.currencyCode)," "),r(2),o("title",s(56,60,"order.net-price")),r(2),_(" ",x(58,62,n.order.total,n.order.currencyCode)," "))},dependencies:[B,tt,Nn,$n,M,w,si,Re,ue,U,Ir,fr,Tr,Dr,W,yr,I,k],styles:[`[_nghost-%COMP%]{display:block;max-width:100%;position:relative;margin-bottom:calc(var(--space-unit) * 4);container-type:inline-size}th[_ngcontent-%COMP%]{border-bottom:1px solid var(--color-table-header-border);color:var(--color-weight-700);font-size:var(--font-size-xs);font-weight:600;text-transform:uppercase;position:relative;white-space:nowrap;background-color:transparent}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:calc(var(--space-unit) * 1.5) calc(var(--space-unit) * 1);color:var(--color-text-100)}tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-of-type, tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-of-type{text-align:center}@media screen and (min-width: 992px){tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:first-of-type, tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:first-of-type{padding-inline-start:var(--surface-margin-left);text-align:start}}th[_ngcontent-%COMP%]:last-of-type, td[_ngcontent-%COMP%]:last-of-type{border-inline-end:1px solid var(--color-table-header-border)}tr[_ngcontent-%COMP%]:first-of-type   th[_ngcontent-%COMP%]:last-of-type{border-image:linear-gradient(0deg,var(--color-table-header-border),transparent) 1}tr[_ngcontent-%COMP%]:last-of-type   td[_ngcontent-%COMP%]:last-of-type{border-image:linear-gradient(180deg,var(--color-table-header-border),transparent) 1}tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-bottom:1px solid var(--color-table-row-separator)}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:var(--color-table-row-hover-bg)}.bulk-actions[_ngcontent-%COMP%]{margin-inline-start:calc(var(--space-unit) * 5);background-color:var(--color-surface-bg);z-index:10;display:flex;position:absolute;top:5px;height:40px}@media screen and (min-width: 992px){.bulk-actions[_ngcontent-%COMP%]{margin-inline-start:calc(var(--space-unit) * 8.5)}}@media screen and (min-width: 1280px){.bulk-actions[_ngcontent-%COMP%]{margin-inline-start:calc(var(--space-unit) * 10.5)}}.table-wrapper[_ngcontent-%COMP%]{display:block;overflow-y:hidden;overflow-x:auto;position:relative;width:100%;max-width:var(--surface-width)}table[_ngcontent-%COMP%]{width:100%}table.no-select[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none}.column-picker[_ngcontent-%COMP%]{width:24px}.sort-toggle[_ngcontent-%COMP%]{display:flex;align-items:center;margin-inline-start:calc(var(--space-unit) * .5)}.sort-toggle[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:0;border-radius:var(--border-radius-lg);color:var(--color-weight-500);padding:0 2px;cursor:pointer;background-color:transparent}.sort-toggle[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{color:var(--color-primary-700)}.sort-toggle[_ngcontent-%COMP%]   .sort-label[_ngcontent-%COMP%]{margin-inline-start:calc(var(--space-unit) * .5);font-size:10px;color:var(--color-primary-600);font-weight:400}.toggle-search-filter-row[_ngcontent-%COMP%]{position:absolute;top:-12px;left:4px}@media screen and (min-width: 1280px){.toggle-search-filter-row[_ngcontent-%COMP%]{left:8px}}.toggle-search-filter-row.active[_ngcontent-%COMP%]{background-color:var(--color-primary-700);color:var(--color-primary-100);border-color:var(--color-primary-700)}th.filter-row[_ngcontent-%COMP%]{position:relative;font-size:var(--font-size-base);font-weight:400;background-color:var(--color-weight-100);box-shadow:var(--data-table-filter-box-shadow);border-left-width:0;border-right-width:0;text-align:initial;padding:0}th.filter-row[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%}th.filter-row.active[_ngcontent-%COMP%]{border-bottom:1px solid var(--color-table-header-border)}th.filter-row[_ngcontent-%COMP%]   .filters[_ngcontent-%COMP%]{margin-top:calc(var(--space-unit) * 1);display:flex;flex-wrap:wrap;gap:calc(var(--space-unit) * .5)}.filter-row-wrapper[_ngcontent-%COMP%]{padding:calc(var(--space-unit) * 4);padding-inline-start:0;max-height:150px;transition:max-height .2s,padding .2s,opacity .2s}.filter-row-wrapper.hidden[_ngcontent-%COMP%]{max-height:0px;padding-top:0;padding-bottom:0;overflow:hidden;opacity:0}.cell-link[_ngcontent-%COMP%]{display:block;width:100%;height:100%}td.active[_ngcontent-%COMP%]{background-color:var(--color-table-row-active-bg)}.cell-content[_ngcontent-%COMP%]{display:flex;align-items:center;line-height:var(--font-size-sm);color:var(--color-weight-700)}.cell-content.left[_ngcontent-%COMP%]{justify-content:flex-start}.cell-content.center[_ngcontent-%COMP%]{justify-content:center}.cell-content.right[_ngcontent-%COMP%]{justify-content:flex-end}.selection-col[_ngcontent-%COMP%]{width:calc(var(--space-unit) * 8)}vdr-empty-placeholder[_ngcontent-%COMP%]{width:100%}.table-footer[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:space-between;margin-top:var(--space-unit);margin-inline-start:var(--surface-margin-left);margin-inline-end:var(--space-unit)}.total-items-count[_ngcontent-%COMP%]{font-size:var(--font-size-xs)}@container (max-width: 500px){.total-items-count[_ngcontent-%COMP%]{display:none}}
/*# sourceMappingURL=data-table2.component-4QQLIO3B.css.map */`,`[_nghost-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}[_nghost-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}[_nghost-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700;border-top:1px dashed var(--color-component-border-200)}[_nghost-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}[_nghost-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}[_nghost-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-inline-end:18px}[_nghost-%COMP%]   .draft-qty[_ngcontent-%COMP%]{max-width:48px}[_nghost-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}[_nghost-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}[_nghost-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px;color:var(--color-text-300);line-height:14px}[_nghost-%COMP%]   .promotions-label[_ngcontent-%COMP%]{text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}[_nghost-%COMP%]   .thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px}[_nghost-%COMP%]   .shipping-method-name[_ngcontent-%COMP%]{font-size:var(--font-size-xs);margin-inline-end:2px}[_nghost-%COMP%]   .order-placed-quantity[_ngcontent-%COMP%]{text-decoration:line-through;color:var(--color-text-300);margin-inline-end:2px}
/*# sourceMappingURL=order-data-table.component-SSVS5K32.css.map */`],changeDetection:0})}}return t})();function Il(t,p){if(t&1&&u(0),t&2){let e=p.item;_(" ",e.id," ")}}function Tl(t,p){if(t&1&&(u(0),d(1,"localeDate")),t&2){let e=p.item;_(" ",x(1,1,e.createdAt,"short")," ")}}function Dl(t,p){if(t&1&&(u(0),d(1,"localeDate")),t&2){let e=p.item;_(" ",x(1,1,e.updatedAt,"short")," ")}}function wl(t,p){if(t&1&&(g(0,"img",16),d(1,"assetPreview")),t&2){let e=p.ngIf;o("src",x(1,1,e,"tiny"),xe)}}function Pl(t,p){t&1&&(a(0,"div",17),g(1,"clr-icon",18),l())}function Ml(t,p){if(t&1&&(a(0,"div",14),f(1,wl,2,4,"img",15)(2,Pl,2,0,"ng-template",null,0,ee),l()),t&2){let e=p.item,i=Y(3);r(),o("ngIf",e.featuredAsset)("ngIfElse",i)}}function Fl(t,p){if(t&1&&u(0),t&2){let e=p.item;_(" ",e.productVariant.name," ")}}function El(t,p){if(t&1&&u(0),t&2){let e=p.item;_(" ",e.productVariant.sku," ")}}function Bl(t,p){if(t&1&&(a(0,"div",19),u(1),d(2,"localeCurrency"),a(3,"div",20),d(4,"translate"),u(5),d(6,"localeCurrency"),l()()),t&2){let e=p.item,i=m();r(),_(" ",x(2,3,e.unitPriceWithTax,i.order.currencyCode)," "),r(2),o("title",s(4,6,"order.net-price")),r(2),_(" ",x(6,8,e.unitPrice,i.order.currencyCode)," ")}}function kl(t,p){if(t&1&&(a(0,"div",26),d(1,"translate"),u(2),l()),t&2){let e=m(2).item;o("title",s(1,2,"order.original-quantity-at-checkout")),r(2),_(" ",e.orderPlacedQuantity," ")}}function Ll(t,p){if(t&1&&(T(0),a(1,"div",24),f(2,kl,3,4,"div",25),a(3,"div"),u(4),l()(),D()),t&2){let e=m().item;r(2),o("ngIf",e.orderPlacedQuantity&&e.quantity!==e.orderPlacedQuantity),r(2),v(e.quantity)}}function Al(t,p){if(t&1){let e=S();a(0,"div",24)(1,"input",27,2),b("blur",function(){h(e);let n=Y(2),c=m().item,C=m();return y(C.draftInputBlur(c,n.valueAsNumber))}),l(),a(3,"button",28),b("click",function(){h(e);let n=m().item,c=m();return y(c.remove.emit({lineId:n.id}))}),g(4,"clr-icon",29),l()()}if(t&2){let e=m().item;r(),o("value",e.quantity)}}function Vl(t,p){if(t&1&&(f(0,Ll,5,2,"ng-container",21)(1,Al,5,1,"ng-template",null,1,ee),g(3,"vdr-line-refunds",22)(4,"vdr-line-fulfillment",23)),t&2){let e=p.item,i=Y(2),n=m();o("ngIf",!n.isDraft)("ngIfElse",i),r(3),o("line",e)("payments",n.order.payments),r(),o("line",e)("orderState",n.order.state)("allOrderFulfillments",n.order.fulfillments)}}function Rl(t,p){if(t&1&&g(0,"vdr-dt2-custom-field-column",30),t&2){let e=p.$implicit;o("customField",e)}}function Nl(t,p){if(t&1&&(a(0,"div",34)(1,"a",35),u(2),l(),a(3,"div",36),u(4),d(5,"localeCurrency"),a(6,"div",20),d(7,"translate"),u(8),d(9,"localeCurrency"),l()()()),t&2){let e=p.$implicit,i=m(4);r(),o("routerLink",i.getPromotionLink(e)),r(),v(e.description),r(2),_(" ",x(5,5,e.amountWithTax,i.order.currencyCode)," "),r(2),o("title",s(7,8,"order.net-price")),r(2),_(" ",x(9,10,e.amount,i.order.currencyCode)," ")}}function $l(t,p){if(t&1&&(a(0,"vdr-dropdown")(1,"div",32),u(2),d(3,"translate"),l(),a(4,"vdr-dropdown-menu"),f(5,Nl,10,13,"div",33),l()()),t&2){let e=m().ngIf;r(2),_(" ",s(3,2,"order.promotions-applied")," "),r(3),o("ngForOf",e)}}function jl(t,p){if(t&1&&(T(0),f(1,$l,6,4,"vdr-dropdown",31),D()),t&2){let e=p.ngIf;r(),o("ngIf",e.length)}}function ql(t,p){if(t&1&&(a(0,"div",19),u(1),d(2,"localeCurrency"),a(3,"div",20),d(4,"translate"),u(5),d(6,"localeCurrency"),l()(),f(7,jl,2,1,"ng-container",31)),t&2){let e=p.item,i=m();r(),_(" ",x(2,4,e.linePriceWithTax,i.order.currencyCode)," "),r(2),o("title",s(4,7,"order.net-price")),r(2),_(" ",x(6,9,e.linePrice,i.order.currencyCode)," "),r(2),o("ngIf",i.getLineDiscounts(e))}}var $t=(()=>{class t{constructor(){this.isDraft=!1,this.adjust=new J,this.remove=new J,this.orderLineCustomFieldsVisible=!1,this.customFieldsForLine={}}get visibleOrderLineCustomFields(){return this.orderLineCustomFieldsVisible?this.orderLineCustomFields:[]}get showElided(){return!this.orderLineCustomFieldsVisible&&0<this.orderLineCustomFields.length}ngOnInit(){this.orderLineCustomFieldsVisible=this.orderLineCustomFields.length<2,this.getLineCustomFields()}draftInputBlur(e,i){e.quantity!==i&&this.adjust.emit({lineId:e.id,quantity:i})}toggleOrderLineCustomFields(){this.orderLineCustomFieldsVisible=!this.orderLineCustomFieldsVisible}getLineDiscounts(e){return e.discounts.filter(i=>i.type===Gn.PROMOTION)}getLineCustomFields(){for(let e of this.order.lines){let i=new me({}),n=this.orderLineCustomFields.map(c=>{let C=e.customFields[c.name];return i.addControl(c.name,new pe(C)),{config:c,formGroup:i,value:C}}).filter(c=>this.orderLineCustomFieldsVisible?!0:c.value!=null);this.customFieldsForLine[e.id]=n}}getPromotionLink(e){return["/marketing","promotions",e.adjustmentSource.split(":")[1]]}getCouponCodeForAdjustment(e,i){let n=i.adjustmentSource.split(":")[1],c=e.promotions.find(C=>C.id===n);if(c)return c.couponCode||void 0}getShippingNames(e){return e.shippingLines.length?e.shippingLines.map(i=>i.shippingMethod.name).join(", "):""}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-order-table"]],inputs:{order:"order",orderLineCustomFields:"orderLineCustomFields",isDraft:"isDraft"},outputs:{adjust:"adjust",remove:"remove"},standalone:!1,decls:29,vars:36,consts:[["imagePlaceholder",""],["draft",""],["qtyInput",""],["id","order-detail-list",3,"items","order"],["id","id",3,"heading","hiddenByDefault"],["id","created-at",3,"heading","hiddenByDefault"],["id","updated-at",3,"heading","hiddenByDefault"],["id","image",3,"heading"],["id","product-name",3,"heading"],["id","product-sku",3,"heading","optional"],["id","unit-price",3,"heading"],["id","quantity",3,"heading","optional"],[3,"customField",4,"ngFor","ngForOf"],["id","total",3,"heading","optional"],[1,"image-placeholder"],[3,"src",4,"ngIf","ngIfElse"],[3,"src"],[1,"placeholder"],["shape","image","size","48"],[1,"unit-price"],[1,"net-price",3,"title"],[4,"ngIf","ngIfElse"],[3,"line","payments"],[3,"line","orderState","allOrderFulfillments"],[1,"flex"],["class","order-placed-quantity",3,"title",4,"ngIf"],[1,"order-placed-quantity",3,"title"],["type","number","min","0",1,"draft-qty",3,"blur","value"],[1,"icon-button",3,"click"],["shape","trash"],[3,"customField"],[4,"ngIf"],["vdrDropdownTrigger","",1,"promotions-label"],["class","line-promotion",4,"ngFor","ngForOf"],[1,"line-promotion"],[1,"promotion-name",3,"routerLink"],[1,"promotion-amount"]],template:function(i,n){i&1&&(a(0,"vdr-order-data-table",3)(1,"vdr-dt2-column",4),d(2,"translate"),f(3,Il,1,1,"ng-template"),l(),a(4,"vdr-dt2-column",5),d(5,"translate"),f(6,Tl,2,4,"ng-template"),l(),a(7,"vdr-dt2-column",6),d(8,"translate"),f(9,Dl,2,4,"ng-template"),l(),a(10,"vdr-dt2-column",7),d(11,"translate"),f(12,Ml,4,2,"ng-template"),l(),a(13,"vdr-dt2-column",8),d(14,"translate"),f(15,Fl,1,1,"ng-template"),l(),a(16,"vdr-dt2-column",9),d(17,"translate"),f(18,El,1,1,"ng-template"),l(),a(19,"vdr-dt2-column",10),d(20,"translate"),f(21,Bl,7,11,"ng-template"),l(),a(22,"vdr-dt2-column",11),d(23,"translate"),f(24,Vl,5,7,"ng-template"),l(),f(25,Rl,1,1,"vdr-dt2-custom-field-column",12),a(26,"vdr-order-total-column",13),d(27,"translate"),f(28,ql,8,12,"ng-template"),l()()),i&2&&(o("items",n.order.lines)("order",n.order),r(),o("heading",s(2,18,"common.id"))("hiddenByDefault",!0),r(3),o("heading",s(5,20,"common.created-at"))("hiddenByDefault",!0),r(3),o("heading",s(8,22,"common.updated-at"))("hiddenByDefault",!0),r(3),o("heading",s(11,24,"common.image")),r(3),o("heading",s(14,26,"order.product-name")),r(3),o("heading",s(17,28,"order.product-sku"))("optional",!1),r(3),o("heading",s(20,30,"order.unit-price")),r(3),o("heading",s(23,32,"order.quantity"))("optional",!1),r(3),o("ngForOf",n.orderLineCustomFields),r(),o("heading",s(27,34,"order.total"))("optional",!1))},dependencies:[B,M,w,Re,U,Te,De,we,Ue,Ai,Yi,Nt,Hr,Ji,I,Pe,he,k],styles:[`[_nghost-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}[_nghost-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}[_nghost-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700;border-top:1px dashed var(--color-component-border-200)}[_nghost-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}[_nghost-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}[_nghost-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-inline-end:18px}[_nghost-%COMP%]   .draft-qty[_ngcontent-%COMP%]{max-width:48px}[_nghost-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}[_nghost-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}[_nghost-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px;color:var(--color-text-300);line-height:14px}[_nghost-%COMP%]   .promotions-label[_ngcontent-%COMP%]{text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}[_nghost-%COMP%]   .thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px}[_nghost-%COMP%]   .shipping-method-name[_ngcontent-%COMP%]{font-size:var(--font-size-xs);margin-inline-end:2px}[_nghost-%COMP%]   .order-placed-quantity[_ngcontent-%COMP%]{text-decoration:line-through;color:var(--color-text-300);margin-inline-end:2px}  .line-promotion{display:flex;justify-content:space-between;padding:6px 12px}  .line-promotion .promotion-amount{margin-inline-start:12px}  .line-promotion .net-price{font-size:11px;color:var(--color-text-300)}
/*# sourceMappingURL=order-table.component-XGPLFH2E.css.map */`],changeDetection:0})}}return t})();function Hl(t,p){if(t&1&&(T(0),g(1,"vdr-tabbed-custom-fields",15),D()),t&2){let e=m(2);r(),o("customFields",e.orderLineCustomFields)("customFieldsFormGroup",e.customFieldsFormGroup)}}function Ul(t,p){if(t&1){let e=S();a(0,"div",1)(1,"div",5),g(2,"img",6),d(3,"assetPreview"),a(4,"div",7)(5,"div"),u(6),l(),a(7,"div",8),u(8),l()(),a(9,"div",9)(10,"div",8),u(11),d(12,"translate"),l(),a(13,"div",8),u(14),d(15,"translate"),l()(),g(16,"div",10),a(17,"div",7)(18,"div"),u(19),d(20,"localeCurrency"),l(),a(21,"div",11),d(22,"translate"),u(23),d(24,"localeCurrency"),l()(),a(25,"div")(26,"input",12),$("ngModelChange",function(n){h(e);let c=m();return N(c.quantity,n)||(c.quantity=n),y(n)}),l()(),a(27,"button",13),b("click",function(){let n=h(e).ngIf,c=m();return y(c.addItemClick(n))}),u(28),d(29,"translate"),l()(),f(30,Hl,2,2,"ng-container",14),l()}if(t&2){let e=p.ngIf,i=m();r(2),o("src",x(3,15,e.featuredAsset||e.product.featuredAsset,32),xe),r(4),v(e==null?null:e.name),r(2),v(e==null?null:e.sku),r(3),ie(" ",s(12,18,"catalog.stock-on-hand"),": ",e.stockOnHand," "),r(3),ie(" ",s(15,20,"catalog.stock-allocated"),": ",e.stockAllocated," "),r(5),v(x(20,22,e==null?null:e.priceWithTax,i.currencyCode)),r(2),o("title",s(22,25,"order.net-price")),r(2),_(" ",x(24,27,e==null?null:e.price,i.currencyCode)," "),r(3),o("disabled",!e),R("ngModel",i.quantity),r(),o("disabled",!e),r(),_(" ",s(29,30,"order.add-item-to-order")," "),r(2),o("ngIf",i.orderLineCustomFields.length)}}var Ur=(()=>{class t{constructor(e){this.dataService=e,this.addItem=new J,this.customFieldsFormGroup=new me({}),this.selectedVariantId$=new Be,this.quantity=1}ngOnInit(){this.selectedVariant$=this.selectedVariantId$.pipe(L(e=>e?this.dataService.product.getProductVariant(e).mapSingle(({productVariant:i})=>i):[void 0]));for(let e of this.orderLineCustomFields)this.customFieldsFormGroup.addControl(e.name,new pe(""))}addItemClick(e){e&&(this.addItem.emit({productVariantId:e.id,quantity:this.quantity,customFields:this.orderLineCustomFields.length?this.customFieldsFormGroup.value:void 0}),this.selectedVariantId$.next(void 0),this.customFieldsFormGroup.reset())}static{this.\u0275fac=function(i){return new(i||t)(P(Z))}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-draft-order-variant-selector"]],inputs:{currencyCode:"currencyCode",orderLineCustomFields:"orderLineCustomFields"},outputs:{addItem:"addItem"},standalone:!1,decls:8,vars:6,consts:[[1,"card"],[1,"card-block"],[1,"card-title"],[3,"productSelected"],["class","card-block",4,"ngIf"],[1,"variant-details"],[1,"mr-2",3,"src"],[1,"details"],[1,"small"],[1,"details","ml-4"],[1,"flex-spacer"],[1,"small",3,"title"],["type","number","min","0",3,"ngModelChange","disabled","ngModel"],[1,"btn","btn-small","btn-primary",3,"click","disabled"],[4,"ngIf"],["entityName","Order",3,"customFields","customFieldsFormGroup"]],template:function(i,n){i&1&&(a(0,"div",0)(1,"div",1)(2,"h4",2),u(3),d(4,"translate"),l(),a(5,"vdr-product-variant-selector",3),b("productSelected",function(C){return n.selectedVariantId$.next(C.productVariantId)}),l()(),f(6,Ul,31,32,"div",4),d(7,"async"),l()),i&2&&(r(3),v(s(4,2,"order.add-item-to-order")),r(3),o("ngIf",s(7,4,n.selectedVariant$)))},dependencies:[w,ne,Ne,z,$e,oe,U,Pi,nt,W,I,Pe,k],styles:[`.variant-details[_ngcontent-%COMP%]{display:flex;align-items:center}.variant-details[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img);width:32px;height:32px}.variant-details[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{font-size:.65rem;line-height:.7rem}.variant-details[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:48px;margin:0 6px}.variant-details[_ngcontent-%COMP%]   .small[_ngcontent-%COMP%]{font-size:11px;color:var(--color-text-300)}
/*# sourceMappingURL=draft-order-variant-selector.component-2SVETGFV.css.map */`],changeDetection:0})}}return t})();function Xl(t,p){if(t&1){let e=S();a(0,"vdr-action-bar")(1,"vdr-ab-left")(2,"div",1),g(3,"vdr-order-state-label",2),l()(),a(4,"vdr-ab-right"),g(5,"vdr-action-bar-items",3),a(6,"button",4),b("click",function(){h(e);let n=m();return y(n.completeOrder())}),g(7,"clr-icon",5),u(8),d(9,"translate"),l(),a(10,"vdr-action-bar-dropdown-menu",6)(11,"button",7),b("click",function(){h(e);let n=m();return y(n.deleteOrder())}),g(12,"clr-icon",8),u(13),d(14,"translate"),l()()()()}if(t&2){let e=p.ngIf;r(3),o("state",e.state),r(3),o("disabled",!e.customer||!e.lines.length||!e.shippingLines.length),r(2),_(" ",s(9,5,"order.complete-draft-order")," "),r(2),o("alwaysShow",!0),r(3),_(" ",s(14,7,"order.delete-draft-order")," ")}}function Yl(t,p){t&1&&g(0,"clr-icon",24)}function Jl(t,p){t&1&&g(0,"clr-icon",25)}function Zl(t,p){if(t&1&&f(0,Yl,1,0,"clr-icon",22)(1,Jl,1,0,"clr-icon",23),t&2){let e=m().ngIf;o("ngIf",!e.customer),r(),o("ngIf",e.customer)}}function Kl(t,p){if(t&1&&g(0,"vdr-customer-label",26),t&2){let e=m().ngIf;o("customer",e.customer)}}function ed(t,p){t&1&&g(0,"clr-icon",24)}function td(t,p){t&1&&g(0,"clr-icon",25)}function id(t,p){if(t&1&&f(0,ed,1,0,"clr-icon",22)(1,td,1,0,"clr-icon",23),t&2){let e=m().ngIf;o("ngIf",!e.billingAddress.streetLine1),r(),o("ngIf",e.billingAddress.streetLine1)}}function nd(t,p){if(t&1&&g(0,"vdr-formatted-address",27),t&2){let e=m().ngIf;o("address",e.billingAddress)}}function rd(t,p){t&1&&g(0,"clr-icon",24)}function od(t,p){t&1&&g(0,"clr-icon",25)}function ad(t,p){if(t&1&&f(0,rd,1,0,"clr-icon",22)(1,od,1,0,"clr-icon",23),t&2){let e=m().ngIf;o("ngIf",!e.shippingAddress.streetLine1||!e.shippingLines.length),r(),o("ngIf",e.shippingAddress.streetLine1&&e.shippingLines.length)}}function ld(t,p){if(t&1&&g(0,"vdr-formatted-address",27),t&2){let e=m().ngIf;o("address",e.shippingAddress)}}function dd(t,p){if(t&1&&(a(0,"div"),u(1),l()),t&2){let e=p.$implicit;r(),_(" ",e.shippingMethod.name," ")}}function pd(t,p){if(t&1){let e=S();a(0,"button",12),b("click",function(){h(e);let n=m(2);return y(n.displayCouponCodeInput=!n.displayCouponCodeInput)}),u(1),d(2,"translate"),l()}t&2&&(r(),_(" ",s(2,1,"order.set-coupon-codes")," "))}function sd(t,p){if(t&1){let e=S();a(0,"div")(1,"label"),u(2),d(3,"translate"),l(),a(4,"vdr-coupon-code-selector",28),b("addCouponCode",function(n){h(e);let c=m(2);return y(c.applyCouponCode(n))})("removeCouponCode",function(n){h(e);let c=m(2);return y(c.removeCouponCode(n))}),l()()}if(t&2){let e=m().ngIf;r(2),v(s(3,2,"order.set-coupon-codes")),r(2),o("couponCodes",e.couponCodes)}}function cd(t,p){if(t&1&&g(0,"vdr-page-entity-info",29),t&2){let e=p.ngIf;o("entity",e)}}function md(t,p){if(t&1&&(a(0,"tr")(1,"td"),u(2),l(),a(3,"td"),u(4),d(5,"percent"),l(),a(6,"td"),u(7),d(8,"localeCurrency"),l(),a(9,"td"),u(10),d(11,"localeCurrency"),l()()),t&2){let e=p.$implicit,i=m(2).ngIf;r(2),v(e.description),r(2),v(s(5,4,e.taxRate/100)),r(3),v(x(8,6,e.taxBase,i.currencyCode)),r(3),v(x(11,9,e.taxTotal,i.currencyCode))}}function ud(t,p){if(t&1&&(T(0),a(1,"table",30)(2,"thead")(3,"tr")(4,"th"),u(5),d(6,"translate"),l(),a(7,"th"),u(8),d(9,"translate"),l(),a(10,"th"),u(11),d(12,"translate"),l(),a(13,"th"),u(14),d(15,"translate"),l()()(),a(16,"tbody"),f(17,md,12,12,"tr",15),l()(),D()),t&2){let e=m().ngIf;r(5),v(s(6,5,"common.description")),r(3),v(s(9,7,"order.tax-rate")),r(3),v(s(12,9,"order.tax-base")),r(3),v(s(15,11,"order.tax-total")),r(3),o("ngForOf",e.taxSummary)}}function fd(t,p){if(t&1){let e=S();a(0,"vdr-page-detail-layout")(1,"vdr-page-detail-sidebar")(2,"vdr-card",9),d(3,"translate"),f(4,Zl,2,2,"ng-template",10)(5,Kl,1,1,"vdr-customer-label",11),a(6,"button",12),b("click",function(){h(e);let n=m();return y(n.setCustomer())}),u(7),d(8,"translate"),l()(),a(9,"vdr-card",9),d(10,"translate"),f(11,id,2,2,"ng-template",10)(12,nd,1,1,"vdr-formatted-address",13),a(13,"button",12),b("click",function(){h(e);let n=m();return y(n.setBillingAddress())}),u(14),d(15,"translate"),l()(),a(16,"vdr-card",9),d(17,"translate"),f(18,ad,2,2,"ng-template",10)(19,ld,1,1,"vdr-formatted-address",13),a(20,"button",14),b("click",function(){h(e);let n=m();return y(n.setShippingAddress())}),u(21),d(22,"translate"),l(),f(23,dd,2,1,"div",15),a(24,"button",12),b("click",function(){h(e);let n=m();return y(n.setShippingMethod())}),u(25),d(26,"translate"),l()(),a(27,"vdr-card"),f(28,pd,3,3,"button",16)(29,sd,5,4,"div",0),l(),a(30,"vdr-card"),f(31,cd,1,1,"vdr-page-entity-info",17),d(32,"async"),l()(),a(33,"vdr-page-block")(34,"vdr-card")(35,"vdr-draft-order-variant-selector",18),b("addItem",function(n){h(e);let c=m();return y(c.addItemToOrder(n))}),l(),a(36,"vdr-order-table",19),b("adjust",function(n){h(e);let c=m();return y(c.adjustOrderLine(n))})("remove",function(n){h(e);let c=m();return y(c.removeOrderLine(n))}),l()(),a(37,"vdr-card",9),d(38,"translate"),f(39,ud,18,13,"ng-container",0),l(),g(40,"vdr-custom-detail-component-host",20),a(41,"vdr-order-custom-fields-card",21),b("updateClick",function(n){h(e);let c=m();return y(c.updateCustomFields(n))}),l()()()}if(t&2){let e=p.ngIf,i=m();r(2),o("title",s(3,25,"order.customer")),r(3),o("ngIf",e.customer),r(2),_(" ",s(8,27,"order.set-customer-for-order")," "),r(2),o("title",s(10,29,"order.billing-address")),r(3),o("ngIf",e.billingAddress),r(2),_(" ",s(15,31,"order.set-billing-address")," "),r(2),o("title",s(17,33,"order.shipping")),r(3),o("ngIf",e.shippingAddress),r(2),_(" ",s(22,35,"order.set-shipping-address")," "),r(2),o("ngForOf",e.shippingLines),r(2),_(" ",s(26,37,"order.set-shipping-method")," "),r(3),o("ngIf",e.couponCodes.length===0&&!i.displayCouponCodeInput),r(),o("ngIf",e.couponCodes.length||i.displayCouponCodeInput),r(2),o("ngIf",s(32,39,i.entity$)),r(4),o("orderLineCustomFields",i.orderLineCustomFields)("currencyCode",e.currencyCode),r(),o("order",e)("orderLineCustomFields",i.orderLineCustomFields)("isDraft",!0),r(),o("title",s(38,41,"order.tax-summary")),r(2),o("ngIf",e.taxSummary.length),r(),o("entity$",i.entity$)("detailForm",i.detailForm),r(),o("customFieldsConfig",i.customFields)("customFieldValues",e.customFields)}}var Jr=(()=>{class t extends Lt{constructor(e,i,n,c,C){super(),this.changeDetector=e,this.dataService=i,this.notificationService=n,this.modalService=c,this.orderTransitionService=C,this.customFields=this.getCustomFieldConfig("Order"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.detailForm=new me({}),this.fetchHistory=new Be,this.displayCouponCodeInput=!1}ngOnInit(){this.init(),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.eligibleShippingMethods$=this.entity$.pipe(L(e=>this.dataService.order.getDraftOrderEligibleShippingMethods(e.id).mapSingle(({eligibleShippingMethodsForDraftOrder:i})=>i)))}ngOnDestroy(){this.destroy()}addItemToOrder(e){this.dataService.order.addItemToDraftOrder(this.id,e).subscribe(i=>{i.addItemToDraftOrder.__typename!=="Order"&&this.notificationService.error(i.addItemToDraftOrder.message)})}adjustOrderLine(e){this.dataService.order.adjustDraftOrderLine(this.id,{orderLineId:e.lineId,quantity:e.quantity}).subscribe(i=>{i.adjustDraftOrderLine.__typename!=="Order"&&this.notificationService.error(i.adjustDraftOrderLine.message)})}removeOrderLine(e){this.dataService.order.removeDraftOrderLine(this.id,e.lineId).subscribe(i=>{i.removeDraftOrderLine.__typename!=="Order"&&this.notificationService.error(i.removeDraftOrderLine.message)})}getOrderAddressLines(e){return e?Object.values(e).filter(i=>i!=="OrderAddress").filter(i=>!!i):[]}setCustomer(){this.modalService.fromComponent(Qi).subscribe(e=>{if(this.hasId(e))this.dataService.order.setCustomerForDraftOrder(this.id,{customerId:e.id}).pipe(L(()=>this.dataService.query(ui,{customerId:e.id}).single$),L(({customer:n})=>{let c=n?.addresses?.find(F=>F.defaultShippingAddress),C=n?.addresses?.find(F=>F.defaultBillingAddress);return ei([c?this.dataService.order.setDraftOrderShippingAddress(this.id,this.mapToAddressInput(c)):this.dataService.order.unsetDraftOrderShippingAddress(this.id),C?this.dataService.order.setDraftOrderBillingAddress(this.id,this.mapToAddressInput(C)):this.dataService.order.unsetDraftOrderBillingAddress(this.id)])})).subscribe();else if(e){let i=e,{note:n}=i,c=In(i,["note"]);this.dataService.order.setCustomerForDraftOrder(this.id,{input:c}).subscribe()}})}mapToAddressInput(e){return{fullName:e.fullName,company:e.company,streetLine1:e.streetLine1,streetLine2:e.streetLine2,city:e.city,province:e.province,postalCode:e.postalCode,countryCode:e.country.code,phoneNumber:e.phoneNumber,defaultShippingAddress:e.defaultShippingAddress,defaultBillingAddress:e.defaultBillingAddress}}setShippingAddress(){this.entity$.pipe(Oe(1),L(e=>this.modalService.fromComponent(fn,{locals:{customerId:e.customer?.id,currentAddress:e.shippingAddress??void 0}}))).subscribe(e=>{e&&this.dataService.order.setDraftOrderShippingAddress(this.id,e).subscribe()})}setBillingAddress(){this.entity$.pipe(Oe(1),L(e=>this.modalService.fromComponent(fn,{locals:{customerId:e.customer?.id,currentAddress:e.billingAddress??void 0}}))).subscribe(e=>{e&&this.dataService.order.setDraftOrderBillingAddress(this.id,e).subscribe()})}applyCouponCode(e){this.dataService.order.applyCouponCodeToDraftOrder(this.id,e).subscribe()}removeCouponCode(e){this.dataService.order.removeCouponCodeFromDraftOrder(this.id,e).subscribe()}setShippingMethod(){Tn(this.entity$,this.eligibleShippingMethods$).pipe(Oe(1),L(([e,i])=>this.modalService.fromComponent(Xi,{locals:{eligibleShippingMethods:i,currencyCode:e.currencyCode,currentSelectionId:e.shippingLines?.[0]?.shippingMethod.id}}))).subscribe(e=>{e&&this.dataService.order.setDraftOrderShippingMethod(this.id,e).subscribe()})}updateCustomFields(e){this.dataService.order.updateOrderCustomFields({id:this.id,customFields:e}).subscribe()}deleteOrder(){this.dataService.order.deleteDraftOrder(this.id).subscribe(({deleteDraftOrder:e})=>{e.result===Qn.DELETED?(this.notificationService.success("common.notify-delete-success",{entity:"Order"}),this.router.navigate(["/orders"])):e.message&&this.notificationService.error(e.message)})}completeOrder(){this.dataService.order.transitionToState(this.id,"ArrangingPayment").subscribe(({transitionOrderToState:e})=>{e?.__typename==="Order"?this.router.navigate(["/orders",this.id]):e?.__typename==="OrderStateTransitionError"&&this.notificationService.error(e.transitionError)})}hasId(e){return typeof e=="object"&&!!e.id}setFormValues(e){}static{this.\u0275fac=function(i){return new(i||t)(P(Ve),P(Z),P(it),P(je),P(Vt))}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-draft-order-detail"]],standalone:!1,features:[Ie],decls:5,vars:6,consts:[[4,"ngIf"],[1,"flex","clr-align-items-center"],[3,"state"],["locationId","draft-order-detail"],[1,"btn","btn-primary",3,"click","disabled"],["shape","check"],["locationId","draft-order-detail",3,"alwaysShow"],["type","button","vdrDropdownItem","",3,"click"],["shape","trash",1,"is-danger"],[3,"title"],["vdrCardControls",""],["class","block mb-2",3,"customer",4,"ngIf"],[1,"button-small",3,"click"],["class","block mb-2",3,"address",4,"ngIf"],[1,"button-small","mr-2",3,"click"],[4,"ngFor","ngForOf"],["class","button-small",3,"click",4,"ngIf"],[3,"entity",4,"ngIf"],[3,"addItem","orderLineCustomFields","currencyCode"],[3,"adjust","remove","order","orderLineCustomFields","isDraft"],["locationId","draft-order-detail",3,"entity$","detailForm"],[3,"updateClick","customFieldsConfig","customFieldValues"],["shape","unknown-status","class","is-warning",4,"ngIf"],["shape","check","class","is-success",4,"ngIf"],["shape","unknown-status",1,"is-warning"],["shape","check",1,"is-success"],[1,"block","mb-2",3,"customer"],[1,"block","mb-2",3,"address"],[3,"addCouponCode","removeCouponCode","couponCodes"],[3,"entity"],[1,"table"]],template:function(i,n){i&1&&(a(0,"vdr-page-block"),f(1,Xl,15,9,"vdr-action-bar",0),d(2,"async"),l(),f(3,fd,42,43,"vdr-page-detail-layout",0),d(4,"async")),i&2&&(r(),o("ngIf",s(2,2,n.entity$)),r(2),o("ngIf",s(4,4,n.entity$)))},dependencies:[B,Ce,M,w,at,Ft,ot,kt,Et,qe,dt,Ge,Mt,Li,pt,Fi,wt,Pt,ye,rt,jr,$t,Ur,Ui,W,ci,I,k],encapsulation:2,changeDetection:0})}}return t})();function _d(t,p){t&1&&(u(0),d(1,"translate")),t&2&&v(s(1,1,"order.fulfill-order"))}function gd(t,p){if(t&1&&(g(0,"img",17),d(1,"assetPreview")),t&2){let e=m().$implicit;o("src",x(1,1,e.featuredAsset,"tiny"),xe)}}function Cd(t,p){if(t&1){let e=S();a(0,"input",18),$("ngModelChange",function(n){h(e);let c=m().$implicit,C=m();return N(C.fulfillmentQuantities[c.id].fulfillCount,n)||(C.fulfillmentQuantities[c.id].fulfillCount=n),y(n)}),l()}if(t&2){let e=m().$implicit,i=m();o("disabled",i.getUnfulfilledCount(e)===0),R("ngModel",i.fulfillmentQuantities[e.id].fulfillCount),o("max",i.fulfillmentQuantities[e.id].max)}}function vd(t,p){if(t&1&&(a(0,"tr",9)(1,"td",10),f(2,gd,2,4,"img",11),l(),a(3,"td",12),u(4),l(),a(5,"td",13),u(6),l(),a(7,"td",14),u(8),l(),a(9,"td",14),u(10),l(),a(11,"td",15),f(12,Cd,1,3,"input",16),l()()),t&2){let e=p.$implicit,i=m();Q("ignore",i.getUnfulfilledCount(e)===0),r(2),o("ngIf",e.featuredAsset),r(2),v(e.productVariant.name),r(2),v(e.productVariant.sku),r(2),v(i.getUnfulfilledCount(e)),r(2),v(e.productVariant.stockOnHand),r(2),o("ngIf",i.fulfillmentQuantities[e.id])}}function hd(t,p){if(t&1){let e=S();a(0,"button",19),b("click",function(){h(e);let n=m();return y(n.cancel())}),u(1),d(2,"translate"),l(),a(3,"button",20),b("click",function(){h(e);let n=m();return y(n.select())}),u(4),d(5,"translate"),l()}if(t&2){let e=m();r(),v(s(2,3,"common.cancel")),r(2),o("disabled",!e.canSubmit()),r(),_(" ",s(5,5,"order.create-fulfillment")," ")}}var Zr=(()=>{class t{constructor(e,i){this.dataService=e,this.changeDetector=i,this.fulfillmentHandlerControl=new pe,this.fulfillmentQuantities={}}ngOnInit(){this.dataService.settings.getGlobalSettings().single$.subscribe(({globalSettings:e})=>{this.fulfillmentQuantities=this.order.lines.reduce((i,n)=>{let c=this.getFulfillableCount(n,e.trackInventory);return se(G({},i),{[n.id]:{fulfillCount:c,max:c}})},{}),this.changeDetector.markForCheck()}),this.dataService.shippingMethod.getShippingMethodOperations().mapSingle(e=>e.fulfillmentHandlers).subscribe(e=>{this.fulfillmentHandlerDef=e.find(i=>i.code===this.order.shippingLines[0]?.shippingMethod?.fulfillmentHandlerCode)||e[0],this.fulfillmentHandler=_r(this.fulfillmentHandlerDef),this.fulfillmentHandlerControl.patchValue(this.fulfillmentHandler),this.changeDetector.markForCheck()})}getFulfillableCount(e,i){let{trackInventory:n,stockOnHand:c}=e.productVariant,C=n===cn.INHERIT?i:n===cn.TRUE,F=this.getUnfulfilledCount(e);return C?Math.min(F,c):F}getUnfulfilledCount(e){let i=this.order.fulfillments?.filter(n=>n.state!=="Cancelled").map(n=>n.lines).flat().filter(n=>n.orderLineId===e.id).reduce((n,c)=>n+c.quantity,0)??0;return e.quantity-i}canSubmit(){let e=Object.values(this.fulfillmentQuantities).reduce((c,{fulfillCount:C})=>c+C,0),i=Object.values(this.fulfillmentQuantities).every(({fulfillCount:c,max:C})=>c<=C);return Cr(this.fulfillmentHandlerDef,this.fulfillmentHandlerControl.value)&&this.fulfillmentHandlerControl.valid&&0<e&&i}select(){let e=Object.entries(this.fulfillmentQuantities).map(([i,{fulfillCount:n}])=>({orderLineId:i,quantity:n}));this.resolveWith({lines:e,handler:gr(this.fulfillmentHandler,this.fulfillmentHandlerControl.value)})}cancel(){this.resolveWith()}static{this.\u0275fac=function(i){return new(i||t)(P(Z),P(Ve))}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-fulfill-order-dialog"]],standalone:!1,decls:34,vars:29,consts:[["vdrDialogTitle",""],[1,"fulfillment-wrapper"],[1,"order-table"],[1,"table"],["class","order-line",3,"ignore",4,"ngFor","ngForOf"],[1,"shipping-details"],[3,"address"],[3,"operationDefinition","operation","formControl","removable"],["vdrDialogButtons",""],[1,"order-line"],[1,"align-middle","thumb"],[3,"src",4,"ngIf"],[1,"align-middle","name"],[1,"align-middle","sku"],[1,"align-middle","quantity"],[1,"align-middle","fulfil"],["type","number","min","0",3,"disabled","ngModel","max","ngModelChange",4,"ngIf"],[3,"src"],["type","number","min","0",3,"ngModelChange","disabled","ngModel","max"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"click","disabled"]],template:function(i,n){i&1&&(f(0,_d,2,3,"ng-template",0),a(1,"div",1)(2,"div",2)(3,"table",3)(4,"thead")(5,"tr"),g(6,"th"),a(7,"th"),u(8),d(9,"translate"),l(),a(10,"th"),u(11),d(12,"translate"),l(),a(13,"th"),u(14),d(15,"translate"),l(),a(16,"th"),u(17),d(18,"translate"),l(),a(19,"th"),u(20),d(21,"translate"),l()()(),f(22,vd,13,8,"tr",4),l()(),a(23,"div",5),g(24,"vdr-formatted-address",6),a(25,"h6"),u(26),d(27,"translate"),l(),u(28),a(29,"strong"),u(30),d(31,"localeCurrency"),l(),g(32,"vdr-configurable-input",7),l()(),f(33,hd,6,7,"ng-template",8)),i&2&&(r(8),v(s(9,14,"order.product-name")),r(3),v(s(12,16,"order.product-sku")),r(3),v(s(15,18,"order.unfulfilled")),r(3),v(s(18,20,"catalog.stock-on-hand")),r(3),v(s(21,22,"order.fulfill")),r(2),o("ngForOf",n.order.lines),r(2),o("address",n.order.shippingAddress),r(2),v(s(27,24,"order.shipping-method")),r(2),_(" ",n.order.shippingLines[0]==null||n.order.shippingLines[0].shippingMethod==null?null:n.order.shippingLines[0].shippingMethod.name," "),r(2),v(x(31,26,n.order.shipping,n.order.currencyCode)),r(2),o("operationDefinition",n.fulfillmentHandlerDef)("operation",n.fulfillmentHandler)("formControl",n.fulfillmentHandlerControl)("removable",!1))},dependencies:[M,w,ne,Ne,z,$e,et,oe,Ot,vr,U,ae,te,Ge,I,Pe,k],styles:[`[_nghost-%COMP%]{height:100%;display:flex;min-height:64vh}[_nghost-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}[_nghost-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}[_nghost-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700;border-top:1px dashed var(--color-component-border-200)}[_nghost-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}[_nghost-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}[_nghost-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}[_nghost-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-inline-end:18px}[_nghost-%COMP%]   .draft-qty[_ngcontent-%COMP%]{max-width:48px}[_nghost-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}[_nghost-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}[_nghost-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px;color:var(--color-text-300);line-height:14px}[_nghost-%COMP%]   .promotions-label[_ngcontent-%COMP%]{text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}[_nghost-%COMP%]   .thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px}[_nghost-%COMP%]   .shipping-method-name[_ngcontent-%COMP%]{font-size:var(--font-size-xs);margin-inline-end:2px}[_nghost-%COMP%]   .order-placed-quantity[_ngcontent-%COMP%]{text-decoration:line-through;color:var(--color-text-300);margin-inline-end:2px}.fulfillment-wrapper[_ngcontent-%COMP%]{flex:1}@media screen and (min-width: 768px){.fulfillment-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row}}.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]{margin-top:24px}@media screen and (min-width: 768px){.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]{margin-top:0;margin-inline-start:24px;width:250px}}.fulfillment-wrapper[_ngcontent-%COMP%]   .shipping-details[_ngcontent-%COMP%]   clr-input-container[_ngcontent-%COMP%]{margin-top:24px}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.fulfillment-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.fulfillment-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}
/*# sourceMappingURL=fulfill-order-dialog.component-O7FV255A.css.map */`],changeDetection:0})}}return t})();var Kr=Ee(mt());function yd(t,p){if(t&1&&(a(0,"div",5),u(1),l()),t&2){let e=m().$implicit;r(),v(e.quantity)}}function xd(t,p){t&1&&g(0,"clr-icon",6)}function bd(t,p){if(t&1&&(a(0,"li",2),f(1,yd,2,1,"div",3)(2,xd,1,0,"clr-icon",4),u(3),l()),t&2){let e=p.$implicit;o("title",e.name),r(),o("ngIf",e.quantity!=null),r(),o("ngIf",e.quantity!=null),r(),_(" ",e.name," ")}}var qt=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-simple-item-list"]],inputs:{items:"items"},standalone:!1,decls:3,vars:1,consts:[[1,"items-list"],[3,"title",4,"ngFor","ngForOf"],[3,"title"],["class","quantity",4,"ngIf"],["shape","times","size","12",4,"ngIf"],[1,"quantity"],["shape","times","size","12"]],template:function(i,n){i&1&&(a(0,"div",0)(1,"ul"),f(2,bd,4,4,"li",1),l()()),i&2&&(r(2),o("ngForOf",n.items))},dependencies:[B,M,w],styles:[`.items-list[_ngcontent-%COMP%]{font-size:12px}.items-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin-top:6px;list-style-type:none;margin-inline-start:2px}.items-list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{line-height:14px;text-overflow:ellipsis;overflow:hidden}.items-list[_ngcontent-%COMP%]   .quantity[_ngcontent-%COMP%]{min-width:16px;display:inline-block}
/*# sourceMappingURL=simple-item-list.component-EZ6FOI47.css.map */`],changeDetection:0})}}return t})();function Od(t,p){if(t&1&&(a(0,"vdr-labeled-data",0),d(1,"translate"),u(2),l()),t&2){let e=m();o("label",s(1,2,"order.tracking-code")),r(2),_(" ",e.fulfillment==null?null:e.fulfillment.trackingCode,`
`)}}function Id(t,p){if(t&1&&g(0,"vdr-custom-field-control",5),t&2){let e=m().$implicit,i=m();o("readonly",!0)("compact",!0)("customField",e)("customFieldsFormGroup",i.customFieldFormGroup)}}function Td(t,p){if(t&1&&(T(0),f(1,Id,1,4,"vdr-custom-field-control",4),D()),t&2){let e=p.$implicit,i=m();r(),o("ngIf",i.customFieldFormGroup.get(e.name))}}var Ki=(()=>{class t{constructor(e){this.serverConfigService=e,this.customFieldConfig=[],this.customFieldFormGroup=new me({})}ngOnInit(){this.customFieldConfig=this.serverConfigService.getCustomFieldsFor("Fulfillment")}ngOnChanges(e){this.buildCustomFieldsFormGroup()}get fulfillment(){return this.order.fulfillments&&this.order.fulfillments.find(e=>e.id===this.fulfillmentId)}get items(){return this.fulfillment?.lines.map(e=>({name:this.order.lines.find(i=>i.id===e.orderLineId)?.productVariant.name??"",quantity:e.quantity}))??[]}buildCustomFieldsFormGroup(){let e=this.fulfillment.customFields;for(let i of this.serverConfigService.getCustomFieldsFor("Fulfillment"))this.customFieldFormGroup.addControl(i.name,new pe(e[i.name]))}customFieldIsObject(e){return Array.isArray(e)||(0,Kr.isObject)(e)}static{this.\u0275fac=function(i){return new(i||t)(P(ht))}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-fulfillment-detail"]],inputs:{fulfillmentId:"fulfillmentId",order:"order"},standalone:!1,features:[Le],decls:12,vars:17,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"items"],[4,"ngFor","ngForOf"],[3,"readonly","compact","customField","customFieldsFormGroup",4,"ngIf"],[3,"readonly","compact","customField","customFieldsFormGroup"]],template:function(i,n){i&1&&(a(0,"vdr-labeled-data",0),d(1,"translate"),u(2),d(3,"localeDate"),l(),a(4,"vdr-labeled-data",0),d(5,"translate"),u(6),l(),f(7,Od,3,4,"vdr-labeled-data",1),a(8,"vdr-labeled-data",0),d(9,"translate"),g(10,"vdr-simple-item-list",2),l(),f(11,Td,2,1,"ng-container",3)),i&2&&(o("label",s(1,8,"common.created-at")),r(2),_(" ",x(3,10,n.fulfillment==null?null:n.fulfillment.createdAt,"medium"),`
`),r(2),o("label",s(5,13,"order.fulfillment-method")),r(2),_(" ",n.fulfillment==null?null:n.fulfillment.method,`
`),r(),o("ngIf",n.fulfillment==null?null:n.fulfillment.trackingCode),r(),o("label",s(9,15,"order.contents")),r(2),o("items",n.items),r(),o("ngForOf",n.customFieldConfig))},dependencies:[M,w,Mi,X,qt,I,he],styles:["/*# sourceMappingURL=fulfillment-detail.component-BDOPO4YT.css.map */"],changeDetection:0})}}return t})();function Dd(t,p){t&1&&g(0,"clr-icon",2)}var to=(()=>{class t{get chipColorType(){switch(this.state){case"Pending":case"Shipped":return"warning";case"Delivered":return"success";case"Cancelled":return"error"}}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-fulfillment-state-label"]],inputs:{state:"state"},standalone:!1,decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(i,n){i&1&&(a(0,"vdr-chip",0),d(1,"translate"),f(2,Dd,1,0,"clr-icon",1),u(3),d(4,"stateI18nToken"),d(5,"translate"),l()),i&2&&(o("title",s(1,4,"order.payment-state"))("colorType",n.chipColorType),r(2),o("ngIf",n.state==="Delivered"),r(),_(" ",s(5,8,s(4,6,n.state)),`
`))},dependencies:[B,w,ue,I,fe],styles:[`[_nghost-%COMP%]{font-size:14px}
/*# sourceMappingURL=fulfillment-state-label.component-COVMOLI4.css.map */`],changeDetection:0})}}return t})();var io=t=>({state:t});function Pd(t,p){if(t&1&&g(0,"vdr-fulfillment-detail",8),t&2){let e=m();o("fulfillmentId",e.fulfillment==null?null:e.fulfillment.id)("order",e.order)}}function Md(t,p){if(t&1){let e=S();T(0),a(1,"button",15),b("click",function(){let n=h(e).ngIf,c=m(2);return y(c.transitionState.emit(n))}),u(2),d(3,"stateI18nToken"),d(4,"translate"),d(5,"translate"),l(),D()}if(t&2){let e=p.ngIf;r(2),_(" ",x(5,5,"order.set-fulfillment-state",A(8,io,s(4,3,s(3,1,e))))," ")}}function Fd(t,p){if(t&1&&(T(0),g(1,"clr-icon",18),u(2),d(3,"stateI18nToken"),d(4,"translate"),d(5,"translate"),D()),t&2){let e=m().$implicit;r(2),_(" ",x(5,5,"order.transition-to-state",A(8,io,s(4,3,s(3,1,e))))," ")}}function Ed(t,p){t&1&&(g(0,"clr-icon",19),u(1),d(2,"translate")),t&2&&(r(),_(" ",s(2,1,"order.cancel-fulfillment")," "))}function Bd(t,p){if(t&1){let e=S();T(0),a(1,"button",16),b("click",function(){let n=h(e).$implicit,c=m(2);return y(c.transitionState.emit(n))}),f(2,Fd,6,10,"ng-container",17)(3,Ed,3,3,"ng-template",null,0,ee),l(),D()}if(t&2){let e=p.$implicit,i=Y(4);r(2),o("ngIf",e!=="Cancelled")("ngIfElse",i)}}function kd(t,p){if(t&1&&(a(0,"div",9),f(1,Md,6,10,"ng-container",10),a(2,"vdr-dropdown")(3,"button",11),g(4,"clr-icon",12),l(),a(5,"vdr-dropdown-menu",13),f(6,Bd,5,2,"ng-container",14),l()()()),t&2){let e=m();r(),o("ngIf",e.nextSuggestedState()),r(5),o("ngForOf",e.nextOtherStates())}}var no=(()=>{class t{constructor(){this.transitionState=new J}nextSuggestedState(){if(!this.fulfillment)return;let{nextStates:e}=this.fulfillment,i=n=>e.includes(n)?n:e[0];switch(this.fulfillment?.state){case"Pending":return i("Shipped");case"Shipped":return i("Delivered");default:return e.find(n=>n!=="Cancelled")}}nextOtherStates(){if(!this.fulfillment)return[];let e=this.nextSuggestedState();return this.fulfillment.nextStates.filter(i=>i!==e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-fulfillment-card"]],inputs:{fulfillment:"fulfillment",order:"order"},outputs:{transitionState:"transitionState"},standalone:!1,decls:10,vars:6,consts:[["cancel",""],[1,"card"],[1,"card-header","fulfillment-header"],[1,"fulfillment-state"],[3,"state"],[1,"card-block"],[3,"fulfillmentId","order",4,"ngIf"],["class","card-footer",4,"ngIf"],[3,"fulfillmentId","order"],[1,"card-footer"],[4,"ngIf"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],[4,"ngFor","ngForOf"],[1,"btn","btn-sm","btn-primary",3,"click"],["type","button","vdrDropdownItem","",3,"click"],[4,"ngIf","ngIfElse"],["shape","step-forward-2"],["shape","error-standard",1,"is-error"]],template:function(i,n){i&1&&(a(0,"div",1)(1,"div",2)(2,"div"),u(3),d(4,"translate"),l(),a(5,"div",3),g(6,"vdr-fulfillment-state-label",4),l()(),a(7,"div",5),f(8,Pd,1,2,"vdr-fulfillment-detail",6),l(),f(9,kd,7,2,"div",7),l()),i&2&&(r(3),v(s(4,4,"order.fulfillment")),r(3),o("state",n.fulfillment==null?null:n.fulfillment.state),r(2),o("ngIf",!!n.fulfillment),r(),o("ngIf",n.fulfillment==null?null:n.fulfillment.nextStates.length))},dependencies:[B,M,w,Te,De,we,qe,Ki,to,I,fe],styles:[`.fulfillment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}
/*# sourceMappingURL=fulfillment-card.component-H372XETN.css.map */`],changeDetection:0})}}return t})();function Ad(t,p){if(t&1&&(a(0,"vdr-labeled-data",0),d(1,"translate"),u(2),l()),t&2){let e=m();o("label",s(1,2,"order.note")),r(2),v(e.modification.note)}}function Vd(t,p){if(t&1&&(a(0,"vdr-labeled-data",0),d(1,"translate"),u(2),d(3,"localeCurrency"),l()),t&2){let e,i=p.$implicit,n=m();o("label",s(1,3,"order.surcharges")),r(2),ie(" ",(e=n.getSurcharge(i.id))==null?null:e.description," ",x(3,5,(e=n.getSurcharge(i.id))==null?null:e.priceWithTax,n.order.currencyCode),"")}}function Rd(t,p){if(t&1&&(a(0,"vdr-labeled-data",0),d(1,"translate"),g(2,"vdr-simple-item-list",3),l()),t&2){let e=m();o("label",s(1,2,"order.added-items")),r(2),o("items",e.getAddedItems())}}function Nd(t,p){if(t&1&&(a(0,"vdr-labeled-data",0),d(1,"translate"),g(2,"vdr-simple-item-list",3),l()),t&2){let e=m();o("label",s(1,2,"order.removed-items")),r(2),o("items",e.getRemovedItems())}}function $d(t,p){if(t&1&&(a(0,"vdr-labeled-data",0),d(1,"translate"),g(2,"vdr-simple-item-list",3),l()),t&2){let e=m();o("label",s(1,2,"order.modified-items")),r(2),o("items",e.getModifiedItems())}}var ro=(()=>{class t{constructor(){this.addedItems=new Map,this.removedItems=new Map,this.modifiedItems=new Set}ngOnChanges(){let{added:e,removed:i,modified:n}=this.getModifiedLines();this.addedItems=e,this.removedItems=i,this.modifiedItems=n}getSurcharge(e){return this.order.surcharges.find(i=>i.id===e)}getAddedItems(){return[...this.addedItems.entries()].map(([e,i])=>({name:e.productVariant.name,quantity:i}))}getRemovedItems(){return[...this.removedItems.entries()].map(([e,i])=>({name:e.productVariant.name,quantity:i}))}getModifiedItems(){return[...this.modifiedItems].map(e=>({name:e.productVariant.name}))}getModifiedLines(){let e=new Map,i=new Map,n=new Set;for(let c of this.modification.lines||[]){let C=this.order.lines.find(F=>F.id===c.orderLineId);C&&(c.quantity===0?n.add(C):c.quantity<0?i.set(C,-c.quantity):e.set(C,c.quantity))}return{added:e,removed:i,modified:n}}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-modification-detail"]],inputs:{order:"order",modification:"modification"},standalone:!1,features:[Le],decls:8,vars:9,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"label",4,"ngFor","ngForOf"],[3,"items"]],template:function(i,n){i&1&&(a(0,"vdr-labeled-data",0),d(1,"translate"),u(2),l(),f(3,Ad,3,4,"vdr-labeled-data",1)(4,Vd,4,8,"vdr-labeled-data",2)(5,Rd,3,4,"vdr-labeled-data",1)(6,Nd,3,4,"vdr-labeled-data",1)(7,$d,3,4,"vdr-labeled-data",1)),i&2&&(o("label",s(1,7,"common.ID")),r(2),v(n.modification.id),r(),o("ngIf",n.modification.note),r(),o("ngForOf",n.modification.surcharges),r(),o("ngIf",n.getAddedItems().length),r(),o("ngIf",n.getRemovedItems().length),r(),o("ngIf",n.getModifiedItems().length))},dependencies:[M,w,X,qt,I,k],encapsulation:2,changeDetection:0})}}return t})();var Wt=Ee(mt());var en=72;function qd(t,p){if(t&1&&(a(0,"div",3),g(1,"div",4)(2,"clr-icon",5),a(3,"div",6),u(4),d(5,"stateI18nToken"),d(6,"translate"),l()()),t&2){let e=m();r(4),_(" ",s(6,3,s(5,1,e.cancelledState))," ")}}var tn=(()=>{class t{constructor(e){this.elementRef=e,this.active$=new Ut(!1),this.activeTarget$=new Ut(!1),this.isCancellable=!1,this.cancelledState="Cancelled"}ngOnChanges(e){this.isCancellable=!!this.node.to.find(i=>i.name==="Cancelled"),e.active&&this.active$.next(this.active)}getPos(e="top"){let i=this.elementRef.nativeElement.getBoundingClientRect(),n=this.elementRef.nativeElement.querySelector(".node")?.getBoundingClientRect().height??0;return{x:10,y:this.index*72+(e==="bottom"?n:0)}}getStyle(){let e=this.getPos();return{"top.px":e.y,"left.px":e.x}}static{this.\u0275fac=function(i){return new(i||t)(P(Fn))}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-order-process-node"]],inputs:{node:"node",index:"index",active:"active"},standalone:!1,features:[Le],decls:8,vars:15,consts:[[1,"node-wrapper",3,"ngStyle"],[1,"node"],["class","cancelled-wrapper",4,"ngIf"],[1,"cancelled-wrapper"],[1,"cancelled-edge"],["shape","dot-circle"],[1,"cancelled-node"]],template:function(i,n){i&1&&(a(0,"div",0),d(1,"async"),a(2,"div",1),d(3,"async"),u(4),d(5,"stateI18nToken"),d(6,"translate"),l(),f(7,qd,7,5,"div",2),l()),i&2&&(Q("active",s(1,7,n.active$)),o("ngStyle",n.getStyle()),r(2),Q("active-target",s(3,9,n.activeTarget$)),r(2),_(" ",s(6,13,s(5,11,n.node.name))," "),r(3),o("ngIf",n.isCancellable))},dependencies:[B,w,pi,W,I,fe],styles:[`[_nghost-%COMP%]{display:block}.node-wrapper[_ngcontent-%COMP%]{position:absolute;z-index:1;display:flex;align-items:center}.node[_ngcontent-%COMP%]{display:inline-block;border:2px solid var(--color-component-border-200);border-radius:3px;padding:3px 6px;z-index:1;background-color:var(--color-component-bg-100);opacity:.7;transition:opacity .2s,background-color .2s,color .2s;cursor:default}.node.active-target[_ngcontent-%COMP%]{border-color:var(--color-primary-500);opacity:.9}.cancelled-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;color:var(--color-grey-300);transition:color .2s,opacity .2s;opacity:.7}.cancelled-edge[_ngcontent-%COMP%]{width:48px;height:2px;background-color:var(--color-component-bg-300);transition:background-color .2s}clr-icon[_ngcontent-%COMP%]{margin-inline-start:-1px}.cancelled-node[_ngcontent-%COMP%]{margin-inline-start:6px}.active[_ngcontent-%COMP%]   .cancelled-wrapper[_ngcontent-%COMP%]{opacity:1}.active[_ngcontent-%COMP%]   .node[_ngcontent-%COMP%]{opacity:1;background-color:var(--color-primary-600);border-color:var(--color-primary-600);color:var(--color-primary-100)}.active[_ngcontent-%COMP%]   .cancelled-wrapper[_ngcontent-%COMP%]{color:var(--color-error-500)}.active[_ngcontent-%COMP%]   .cancelled-edge[_ngcontent-%COMP%]{background-color:var(--color-error-500)}
/*# sourceMappingURL=order-process-node.component-XWS2OH66.css.map */`],changeDetection:0})}}return t})();var oo=(()=>{class t{ngOnInit(){this.active$=this.from.active$.asObservable().pipe(ze(e=>this.to.activeTarget$.next(e)))}getStyle(){let e=this.from.index<this.to.index?"down":"up",i=this.from.getPos(e==="down"?"bottom":"top"),n=this.to.getPos(e==="down"?"top":"bottom"),c=Math.abs(i.x-n.x),C=Math.abs(i.y-n.y),F=Math.sqrt(c**2+C**2);return G({"top.px":i.y,"left.px":i.x+(e==="down"?10:40)+this.index*12,"height.px":F,"width.px":1},e==="up"?{transform:"rotateZ(180deg)","transform-origin":"top"}:{})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-order-process-edge"]],inputs:{from:"from",to:"to",index:"index"},standalone:!1,decls:3,vars:7,consts:[[1,"edge",3,"ngStyle"],["shape","arrow","flip","vertical",1,"arrow"]],template:function(i,n){i&1&&(a(0,"div",0),d(1,"async"),g(2,"clr-icon",1),l()),i&2&&(Q("active",s(1,5,n.active$)),o("ngStyle",n.getStyle()),Ae("data-from",n.from.node.name)("data-to",n.to.node.name))},dependencies:[B,pi,W],styles:[`.edge[_ngcontent-%COMP%]{position:absolute;border:1px solid var(--color-component-border-200);background-color:var(--color-component-bg-300);opacity:.3;transition:border .2s,opacity .2s,background-color .2s}.edge.active[_ngcontent-%COMP%]{border-color:var(--color-primary-500);background-color:var(--color-primary-500);opacity:1}.edge.active[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{color:var(--color-primary-500)}.edge[_ngcontent-%COMP%]   .arrow[_ngcontent-%COMP%]{position:absolute;bottom:-4px;left:-8px;color:var(--color-grey-300)}
/*# sourceMappingURL=order-process-edge.component-XKABB5IE.css.map */`],changeDetection:0})}}return t})();function Ud(t,p){if(t&1){let e=S();T(0),a(1,"vdr-order-process-node",1),d(2,"async"),b("mouseenter",function(){let n=h(e).$implicit,c=m();return y(c.onMouseOver(n.name))})("mouseleave",function(){h(e);let n=m();return y(n.onMouseOut())}),l(),D()}if(t&2){let e=p.$implicit,i=p.index,n=m();r(),o("node",e)("index",i)("active",s(2,3,n.activeState$)===e.name)}}function Gd(t,p){if(t&1&&(T(0),g(1,"vdr-order-process-edge",2),D()),t&2){let e=p.$implicit;r(),o("from",e.from)("to",e.to)("index",e.index)}}var ao=(()=>{class t{constructor(e){this.changeDetector=e,this.setActiveState$=new Ut(void 0),this.nodes=[],this.edges=[]}get outerHeight(){return this.nodes.length*72}ngOnInit(){this.setActiveState$.next(this.initialState),this.activeState$=this.setActiveState$.pipe(_t(150))}ngOnChanges(e){this.populateNodes()}ngAfterViewInit(){setTimeout(()=>this.populateEdges())}onMouseOver(e){this.setActiveState$.next(e)}onMouseOut(){this.setActiveState$.next(this.initialState)}getNodeFor(e){if(this.nodeComponents)return this.nodeComponents.find(i=>i.node.name===e)}populateNodes(){let e=new Map;for(let i of this.states)e.set(i.name,{name:i.name,to:[]});for(let[i,n]of e.entries()){let c=this.states.find(C=>C.name===i)?.to??[];for(let C of c){let F=e.get(C);F&&n.to.push(F)}}this.nodes=[...e.values()].filter(i=>i.name!=="Cancelled")}populateEdges(){for(let e of this.nodes){let i=this.getNodeFor(e.name),n=0;for(let c of e.to){let C=this.getNodeFor(c.name);i&&C&&i!==C&&(this.edges.push({to:C,from:i,index:n}),n++)}}this.edges=[...this.edges],this.changeDetector.markForCheck()}static{this.\u0275fac=function(i){return new(i||t)(P(Ve))}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-order-process-graph"]],viewQuery:function(i,n){if(i&1&&li(tn,5),i&2){let c;gt(c=Ct())&&(n.nodeComponents=c)}},hostVars:2,hostBindings:function(i,n){i&2&&kn("height",n.outerHeight,"px")},inputs:{states:"states",initialState:"initialState"},standalone:!1,features:[Le],decls:2,vars:2,consts:[[4,"ngFor","ngForOf"],[3,"mouseenter","mouseleave","node","index","active"],[3,"from","to","index"]],template:function(i,n){i&1&&f(0,Ud,3,5,"ng-container",0)(1,Gd,2,3,"ng-container",0),i&2&&(o("ngForOf",n.nodes),r(),o("ngForOf",n.edges))},dependencies:[M,tn,oo,W],styles:[`[_nghost-%COMP%]{display:block;border:1px hotpink;margin:20px;padding:12px;position:relative}.state-row[_ngcontent-%COMP%]{display:flex}
/*# sourceMappingURL=order-process-graph.component-AJ7N5RYH.css.map */`],changeDetection:0})}}return t})();function zd(t,p){t&1&&(u(0),d(1,"translate")),t&2&&v(s(1,1,"order.order-state-diagram"))}var lo=(()=>{class t{constructor(e){this.serverConfigService=e,this.states=[]}ngOnInit(){this.states=this.serverConfigService.getOrderProcessStates()}static{this.\u0275fac=function(i){return new(i||t)(P(ht))}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-order-process-graph-dialog"]],standalone:!1,decls:2,vars:2,consts:[["vdrDialogTitle",""],[3,"states","initialState"]],template:function(i,n){i&1&&(f(0,zd,2,3,"ng-template",0),g(1,"vdr-order-process-graph",1)),i&2&&(r(),o("states",n.states)("initialState",n.activeState))},dependencies:[te,ao,I],encapsulation:2,changeDetection:0})}}return t})();var mo=Ee(mt());function Xd(t,p){if(t&1){let e=S();a(0,"vdr-select-toggle",6),d(1,"translate"),d(2,"translate"),$("selectedChange",function(n){h(e);let c=m().$implicit;return N(c.selected,n)||(c.selected=n),y(n)}),b("selectedChange",function(n){h(e);let c=m().$implicit,C=m();return y(C.paymentSelected.emit({payment:c,selected:n}))}),l()}if(t&2){let e=m().$implicit,i=m();o("title",s(1,4,"order.refund-this-payment"))("label",s(2,6,"order.refund-this-payment"))("disabled",i.refundablePayments.length===1),R("selected",e.selected)}}function Yd(t,p){if(t&1&&(a(0,"vdr-card",1),d(1,"translate"),f(2,Xd,3,8,"ng-template",2),a(3,"div",3)(4,"vdr-labeled-data",4),d(5,"translate"),u(6),l(),a(7,"vdr-labeled-data",4),d(8,"translate"),u(9),l(),a(10,"vdr-labeled-data",4),d(11,"translate"),u(12),d(13,"localeCurrency"),l(),a(14,"vdr-labeled-data",4),d(15,"translate"),u(16),d(17,"localeCurrency"),l()(),a(18,"vdr-form-field",4),d(19,"translate"),g(20,"vdr-currency-input",5),l()()),t&2){let e=p.$implicit,i=m();Q("selected",e.selected)("unselected",!e.selected),o("title",s(1,17,"order.payment")),r(4),o("label",s(5,19,"order.payment-method")),r(2),_(" ",e.method," "),r(),o("label",s(8,21,"order.transaction-id")),r(2),_(" ",e.transactionId," "),r(),o("label",s(11,23,"order.payment-amount")),r(2),_(" ",x(13,25,e.amount,i.order.currencyCode)," "),r(2),o("label",s(15,28,"order.refundable-amount")),r(2),_(" ",x(17,30,e.refundableAmount,i.order.currencyCode)," "),r(2),o("label",s(19,33,"order.refund-amount")),r(2),o("readonly",!e.selected)("currencyCode",i.order.currencyCode)("formControl",e.amountToRefundControl)}}var nn=(()=>{class t{constructor(){this.paymentSelected=new J}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-payment-for-refund-selector"]],inputs:{refundablePayments:"refundablePayments",order:"order"},outputs:{paymentSelected:"paymentSelected"},standalone:!1,decls:1,vars:1,consts:[[3,"title","selected","unselected",4,"ngFor","ngForOf"],[3,"title"],["vdrCardControls",""],[1,"form-grid"],[3,"label"],[3,"readonly","currencyCode","formControl"],["size","small",3,"selectedChange","title","label","disabled","selected"]],template:function(i,n){i&1&&f(0,Yd,21,35,"vdr-card",0),i&2&&o("ngForOf",n.refundablePayments)},dependencies:[M,z,Ot,Dt,ve,U,xr,X,ye,rt,I,k],styles:[`[_nghost-%COMP%]{display:block}
/*# sourceMappingURL=payment-for-refund-selector.component-RBADEPTH.css.map */`]})}}return t})();var Jd=t=>({amount:t}),Zd=(t,p)=>({min:t,max:p});function Kd(t,p){t&1&&(u(0),d(1,"translate")),t&2&&v(s(1,1,"order.refund-and-cancel-order"))}function ep(t,p){if(t&1&&u(0),t&2){let e=p.item;_(" ",e.id," ")}}function tp(t,p){if(t&1&&(u(0),d(1,"localeDate")),t&2){let e=p.item;_(" ",x(1,1,e.createdAt,"short")," ")}}function ip(t,p){if(t&1&&(u(0),d(1,"localeDate")),t&2){let e=p.item;_(" ",x(1,1,e.updatedAt,"short")," ")}}function np(t,p){if(t&1&&(g(0,"img",26),d(1,"assetPreview")),t&2){let e=p.ngIf;o("src",x(1,1,e,"tiny"),xe)}}function rp(t,p){t&1&&(a(0,"div",27),g(1,"clr-icon",28),l())}function op(t,p){if(t&1&&(a(0,"div",24),f(1,np,2,4,"img",25)(2,rp,2,0,"ng-template",null,0,ee),l()),t&2){let e=p.item,i=Y(3);r(),o("ngIf",e.featuredAsset)("ngIfElse",i)}}function ap(t,p){if(t&1&&u(0),t&2){let e=p.item;_(" ",e.productVariant.name," ")}}function lp(t,p){if(t&1&&u(0),t&2){let e=p.item;_(" ",e.productVariant.sku," ")}}function dp(t,p){if(t&1&&(u(0),d(1,"localeCurrency")),t&2){let e=p.item,i=m();_(" ",x(1,1,e.unitPriceWithTax,i.order.currencyCode)," ")}}function pp(t,p){if(t&1&&(a(0,"div",34),u(1),a(2,"div",35),u(3),d(4,"number"),d(5,"currency"),l()()),t&2){let e=p.$implicit,i=m(3).item,n=m();r(),_(" ",e.description," "),r(2),_(" ",x(5,5,x(4,2,e.amount/100/i.quantity,"1.0-2"),n.order.currencyCode)," ")}}function sp(t,p){if(t&1&&(a(0,"vdr-dropdown")(1,"div",30)(2,"button",31),g(3,"clr-icon",32),l()(),a(4,"vdr-dropdown-menu"),f(5,pp,6,8,"div",33),l()()),t&2){let e=m().ngIf;r(5),o("ngForOf",e)}}function cp(t,p){if(t&1&&(T(0),f(1,sp,6,1,"vdr-dropdown",29),D()),t&2){let e=p.ngIf;r(),o("ngIf",e.length)}}function mp(t,p){if(t&1&&(u(0),d(1,"localeCurrency"),f(2,cp,2,1,"ng-container",29)),t&2){let e=p.item,i=m();_(" ",x(1,2,e.proratedUnitPriceWithTax,i.order.currencyCode)," "),r(2),o("ngIf",e.discounts)}}function up(t,p){if(t&1&&(u(0),g(1,"vdr-line-refunds",36)),t&2){let e=p.item,i=m();_(" ",e.quantity," "),r(),o("line",e)("payments",i.order.payments)}}function fp(t,p){if(t&1){let e=S();a(0,"input",38),b("ngModelChange",function(n){h(e);let c=m().item,C=m();return y(C.onRefundQuantityChange(c.id,n))}),l()}if(t&2){let e=m().item,i=m();o("ngModel",i.lineQuantities[e.id].quantity)("max",e.quantity)}}function _p(t,p){if(t&1&&f(0,fp,1,2,"input",37),t&2){let e=p.item,i=m();o("ngIf",i.lineCanBeRefundedOrCancelled(e))}}function gp(t,p){if(t&1){let e=S();a(0,"input",43),$("ngModelChange",function(n){h(e);let c=m().item,C=m();return N(C.lineQuantities[c.id].cancel,n)||(C.lineQuantities[c.id].cancel=n),y(n)}),l()}if(t&2){let e=m().item,i=m();o("disabled",i.lineQuantities[e.id].quantity===0),R("ngModel",i.lineQuantities[e.id].cancel)}}function Cp(t,p){if(t&1&&(a(0,"div",39)(1,"label",40),f(2,gp,1,2,"input",41),a(3,"span",42),u(4),d(5,"translate"),l()()()),t&2){let e=p.item,i=m();r(2),o("ngIf",i.lineCanBeRefundedOrCancelled(e)),r(2),v(s(5,2,"order.return-to-stock"))}}function vp(t,p){if(t&1){let e=S();a(0,"label",44)(1,"input",45),b("change",function(){let n=h(e).$implicit,c=m();return y(c.toggleShippingRefund(n.id))}),l(),a(2,"div",42),u(3),d(4,"translate"),a(5,"span"),u(6),l(),a(7,"span",42),u(8),d(9,"localeCurrency"),l()()()}if(t&2){let e=p.$implicit,i=m();r(3),_(" ",s(4,3,"order.refund-shipping")," "),r(3),_("",e.shippingMethod.name,":"),r(2),_("",x(9,5,e.discountedPriceWithTax,i.order.currencyCode)," ")}}function hp(t,p){if(t&1&&(a(0,"clr-alert",51)(1,"clr-alert-item"),u(2),d(3,"currency"),d(4,"localeCurrency"),d(5,"translate"),l()()),t&2){let e=m(2);o("clrAlertType","danger")("clrAlertClosable",!1),r(2),_(" ",x(5,9,"order.refund-total-error",Xe(12,Zd,x(3,3,0,e.order.currencyCode),x(4,6,e.totalRefundableAmount,e.order.currencyCode)))," ")}}function yp(t,p){t&1&&(a(0,"clr-alert",51)(1,"clr-alert-item"),u(2),d(3,"translate"),l()()),t&2&&(o("clrAlertType","danger")("clrAlertClosable",!1),r(2),_(" ",s(3,3,"order.refund-total-warning")," "))}function xp(t,p){t&1&&(a(0,"clr-alert",51)(1,"clr-alert-item"),u(2),d(3,"translate"),l()()),t&2&&(o("clrAlertType","danger")("clrAlertClosable",!1),r(2),_(" ",s(3,3,"order.refund-cancellation-reason-required")," "))}function bp(t,p){if(t&1){let e=S();a(0,"div")(1,"div",46),f(2,hp,6,15,"clr-alert",47)(3,yp,4,5,"clr-alert",47)(4,xp,4,5,"clr-alert",47),l(),a(5,"div",48)(6,"button",49),b("click",function(){h(e);let n=m();return y(n.cancel())}),u(7),d(8,"translate"),l(),a(9,"button",50),b("click",function(){h(e);let n=m();return y(n.select())}),u(10),d(11,"localeCurrency"),d(12,"translate"),l()()()}if(t&2){let e=m();r(2),o("ngIf",e.refundTotal<0||e.totalRefundableAmount<e.refundTotal),r(),o("ngIf",e.amountToRefundTotal<e.refundTotal||e.refundTotal<e.amountToRefundTotal),r(),o("ngIf",e.amountToRefundTotal&&!e.reason),r(3),v(s(8,6,"common.cancel")),r(2),o("disabled",!e.canSubmit()),r(),_(" ",x(12,11,"order.refund-with-amount",A(14,Jd,x(11,8,e.amountToRefundTotal,e.order.currencyCode)))," ")}}var uo=(()=>{class t{constructor(e){this.i18nService=e,this.lineQuantities={},this.refundablePayments=[],this.refundShippingLineIds=[],this.reasons=_i().cancellationReasons??["order.refund-reason-customer-request","order.refund-reason-not-available"],this.manuallySetRefundTotal=!1,this.refundTotal=0,this.reasons=this.reasons.map(i=>this.i18nService.translate(i))}get totalRefundableAmount(){return(0,mo.summate)(this.refundablePayments,"refundableAmount")}get amountToRefundTotal(){return this.refundablePayments.reduce((e,i)=>e+i.amountToRefundControl.value,0)}lineCanBeRefundedOrCancelled(e){return(this.order.payments?.reduce((n,c)=>[...n,...c.refunds],[]).filter(n=>n.state!=="Failed").reduce((n,c)=>[...n,...c.lines],[]).filter(n=>n.orderLineId===e.id).reduce((n,c)=>n+c.quantity,0)??0)<e.orderPlacedQuantity}ngOnInit(){this.lineQuantities=this.order.lines.reduce((e,i)=>se(G({},e),{[i.id]:{quantity:0,refund:!0,cancel:!1}}),{}),this.refundablePayments=Wi(this.order.payments)}updateRefundTotal(){if(!this.manuallySetRefundTotal){let n=this.order.lines.reduce((C,F)=>{let dn=this.lineQuantities[F.id].quantity||0;return C+F.proratedUnitPriceWithTax*dn},0),c=this.order.shippingLines.reduce((C,F)=>this.refundShippingLineIds.includes(F.id)?C+F.discountedPriceWithTax:C,0);this.refundTotal=n+c}let e=this.refundablePayments.filter(n=>n.selected),i=0;for(let n of e){let c=Math.min(n.refundableAmount,this.refundTotal-i);n.amountToRefundControl.setValue(c),i+=c}}toggleShippingRefund(e){let i=this.refundShippingLineIds.indexOf(e);i===-1?this.refundShippingLineIds.push(e):this.refundShippingLineIds.splice(i,1),this.updateRefundTotal()}onRefundQuantityChange(e,i){this.manuallySetRefundTotal=!1;let n=this.lineQuantities[e];if(n){let c=n.quantity;i===0?n.cancel=!1:c===0&&i>0&&(n.cancel=!0),n.quantity=i,this.updateRefundTotal()}}onPaymentSelected(e,i){if(i){let n=this.refundTotal-this.refundablePayments.filter(c=>c.id!==e.id).reduce((c,C)=>c+C.amountToRefundControl.value,0);0<n&&e.amountToRefundControl.setValue(Math.min(n,e.refundableAmount))}else e.amountToRefundControl.setValue(0)}isRefunding(){return Object.values(this.lineQuantities).reduce((i,n)=>i||0<n.quantity,!1)}isCancelling(){return Object.values(this.lineQuantities).reduce((i,n)=>i||0<n.quantity&&n.cancel,!1)}canSubmit(){return 0<this.refundTotal&&this.amountToRefundTotal===this.refundTotal&&!!this.reason}select(){let e=this.getOrderLineInput(()=>!0),i=this.getOrderLineInput(n=>n.cancel);this.resolveWith({refunds:this.refundablePayments.filter(n=>n.selected&&0<n.amountToRefundControl.value).map(n=>({lines:e,reason:this.reason,paymentId:n.id,amount:n.amountToRefundControl.value,shipping:0,adjustment:0})),cancel:{lines:i,orderId:this.order.id,reason:this.reason,cancelShipping:this.refundShippingLineIds.length>0}})}cancel(){this.resolveWith()}getOrderLineInput(e){return Object.entries(this.lineQuantities).filter(([i,n])=>0<n.quantity&&e(n)).map(([i,n])=>({orderLineId:i,quantity:n.quantity}))}static{this.\u0275fac=function(i){return new(i||t)(P(yt))}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-refund-order-dialog"]],standalone:!1,decls:50,vars:60,consts:[["imagePlaceholder",""],["vdrDialogTitle",""],[1,"refund-wrapper"],["id","refund-order",3,"items"],["id","id",3,"heading","hiddenByDefault"],["id","created-at",3,"heading","hiddenByDefault"],["id","updated-at",3,"heading","hiddenByDefault"],["id","image",3,"heading"],["id","product-name",3,"heading","optional"],["id","product-sku",3,"heading"],["id","unit-price",3,"heading","hiddenByDefault"],["id","prorated-unit-price",3,"heading"],["id","quantity",3,"heading"],["id","refund-quantity",3,"heading","optional"],["id","cancel",3,"heading","optional"],[1,"refund-details","mt-4"],["class","flex mb-2",4,"ngFor","ngForOf"],[1,"mb-2",3,"label"],["bindLabel","name","autofocus","","bindValue","id",3,"ngModelChange","items","placeholder","addTag","ngModel"],[3,"readOnlyToggleChange","label","readOnlyToggle"],[3,"ngModelChange","readonly","currencyCode","ngModel"],[1,""],[3,"paymentSelected","refundablePayments","order"],["vdrDialogButtons",""],[1,"image-placeholder"],[3,"src",4,"ngIf","ngIfElse"],[3,"src"],[1,"placeholder"],["shape","image","size","48"],[4,"ngIf"],["vdrDropdownTrigger","",1,"promotions-label"],[1,"icon-button"],["shape","info"],["class","line-promotion",4,"ngFor","ngForOf"],[1,"line-promotion"],[1,"promotion-amount"],[3,"line","payments"],["type","number","min","0",3,"ngModel","max","ngModelChange",4,"ngIf"],["type","number","min","0",3,"ngModelChange","ngModel","max"],[1,"cancel-checkbox-wrapper"],[1,"flex","center"],["type","checkbox","clrCheckbox","",3,"disabled","ngModel","ngModelChange",4,"ngIf"],[1,"ml-1"],["type","checkbox","clrCheckbox","",3,"ngModelChange","disabled","ngModel"],[1,"flex","mb-2"],["type","checkbox","clrCheckbox","",3,"change"],[1,"errors"],[3,"clrAlertType","clrAlertClosable",4,"ngIf"],[1,"modal-buttons"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"click","disabled"],[3,"clrAlertType","clrAlertClosable"]],template:function(i,n){i&1&&(f(0,Kd,2,3,"ng-template",1),a(1,"div",2)(2,"vdr-data-table-2",3)(3,"vdr-dt2-column",4),d(4,"translate"),f(5,ep,1,1,"ng-template"),l(),a(6,"vdr-dt2-column",5),d(7,"translate"),f(8,tp,2,4,"ng-template"),l(),a(9,"vdr-dt2-column",6),d(10,"translate"),f(11,ip,2,4,"ng-template"),l(),a(12,"vdr-dt2-column",7),d(13,"translate"),f(14,op,4,2,"ng-template"),l(),a(15,"vdr-dt2-column",8),d(16,"translate"),f(17,ap,1,1,"ng-template"),l(),a(18,"vdr-dt2-column",9),d(19,"translate"),f(20,lp,1,1,"ng-template"),l(),a(21,"vdr-dt2-column",10),d(22,"translate"),f(23,dp,2,4,"ng-template"),l(),a(24,"vdr-dt2-column",11),d(25,"translate"),f(26,mp,3,5,"ng-template"),l(),a(27,"vdr-dt2-column",12),d(28,"translate"),f(29,up,2,3,"ng-template"),l(),a(30,"vdr-dt2-column",13),d(31,"translate"),f(32,_p,1,1,"ng-template"),l(),a(33,"vdr-dt2-column",14),d(34,"translate"),f(35,Cp,6,4,"ng-template"),l()(),a(36,"div",15)(37,"div")(38,"vdr-card"),f(39,vp,10,8,"label",16),a(40,"vdr-form-field",17),d(41,"translate"),a(42,"ng-select",18),d(43,"translate"),$("ngModelChange",function(C){return N(n.reason,C)||(n.reason=C),C}),l()(),a(44,"vdr-form-field",19),d(45,"translate"),b("readOnlyToggleChange",function(C){return n.manuallySetRefundTotal=!C}),a(46,"vdr-currency-input",20),$("ngModelChange",function(C){return N(n.refundTotal,C)||(n.refundTotal=C),C}),b("ngModelChange",function(){return n.updateRefundTotal()}),l()()()(),a(47,"div",21)(48,"vdr-payment-for-refund-selector",22),b("paymentSelected",function(C){return n.onPaymentSelected(C.payment,C.selected)}),l()()()(),f(49,bp,13,16,"ng-template",23)),i&2&&(r(2),o("items",n.order.lines),r(),o("heading",s(4,32,"common.id"))("hiddenByDefault",!0),r(3),o("heading",s(7,34,"common.created-at"))("hiddenByDefault",!0),r(3),o("heading",s(10,36,"common.updated-at"))("hiddenByDefault",!0),r(3),o("heading",s(13,38,"common.image")),r(3),o("heading",s(16,40,"order.product-name"))("optional",!1),r(3),o("heading",s(19,42,"order.product-sku")),r(3),o("heading",s(22,44,"order.unit-price"))("hiddenByDefault",!0),r(3),o("heading",s(25,46,"order.prorated-unit-price")),r(3),o("heading",s(28,48,"order.quantity")),r(3),o("heading",s(31,50,"order.refund"))("optional",!1),r(3),o("heading",s(34,52,"order.return-to-stock"))("optional",!1),r(6),o("ngForOf",n.order.shippingLines),r(),o("label",s(41,54,"order.refund-cancellation-reason")),r(2),o("items",n.reasons)("placeholder",s(43,56,"order.refund-cancellation-reason-required"))("addTag",!0),R("ngModel",n.reason),r(2),o("label",s(45,58,"order.refund-total"))("readOnlyToggle",!0),r(2),o("readonly",!n.manuallySetRefundTotal)("currencyCode",n.order.currencyCode),R("ngModel",n.refundTotal),r(2),o("refundablePayments",n.refundablePayments)("order",n.order))},dependencies:[Ii,Ti,B,Ce,tt,M,w,ne,Ne,xt,z,$e,et,oe,We,Dt,ve,U,ae,te,Te,De,we,lt,Ue,ye,Nt,nn,Hn,Un,I,Pe,he,k],styles:[`[_nghost-%COMP%]{height:100%;display:flex;flex-direction:column;min-height:64vh}.refund-wrapper[_ngcontent-%COMP%]{flex:1;flex-direction:column}.refund-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.refund-wrapper[_ngcontent-%COMP%]   .order-table[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{margin-top:0}.refund-wrapper[_ngcontent-%COMP%]   tr.ignore[_ngcontent-%COMP%]{color:var(--color-grey-300)}  .refund-wrapper .table-wrapper{max-width:initial!important}.quantity-col[_ngcontent-%COMP%]{background-color:var(--color-warning-100)}.cancel-checkbox-wrapper[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}clr-checkbox-wrapper[_ngcontent-%COMP%]{margin-top:12px;margin-bottom:12px;display:block}.refund-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:var(--space-unit);gap:calc(var(--space-unit) * 2);justify-content:space-between}@media screen and (min-width: 992px){.refund-details[_ngcontent-%COMP%]{flex-direction:row}}.refund-details[_ngcontent-%COMP%]   vdr-card.unselected[_ngcontent-%COMP%]{opacity:.8}.refund-details[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{flex:1}.errors[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:calc(var(--space-unit) * 2);margin:calc(var(--space-unit) * 2) 0}.prorated-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center}.line-promotion[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:12px;padding:3px 6px}.line-promotion[_ngcontent-%COMP%]   .promotion-amount[_ngcontent-%COMP%]{margin-inline-start:12px}vdr-card.faded[_ngcontent-%COMP%]{opacity:.8}.modal-buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.6rem;gap:var(--clr-modal-footer-gap, .6rem)}
/*# sourceMappingURL=refund-order-dialog.component-GIS7AIXD.css.map */`],changeDetection:0})}}return t})();var Sp=t=>({method:t});function Op(t,p){t&1&&(u(0),d(1,"translate")),t&2&&v(s(1,1,"order.settle-refund"))}function Ip(t,p){if(t&1){let e=S();a(0,"button",4),b("click",function(){h(e);let n=m();return y(n.cancel())}),u(1),d(2,"translate"),l(),a(3,"button",5),b("click",function(){h(e);let n=m();return y(n.submit())}),u(4),d(5,"translate"),l()}if(t&2){let e=m();r(),v(s(2,3,"common.cancel")),r(2),o("disabled",!e.transactionId),r(),_(" ",s(5,5,"order.settle-refund")," ")}}var fo=(()=>{class t{constructor(){this.transactionId=""}submit(){this.resolveWith(this.transactionId)}cancel(){this.resolveWith()}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-settle-refund-dialog"]],standalone:!1,decls:10,vars:10,consts:[["vdrDialogTitle",""],[1,"instruction"],["clrInput","","name","transactionId",3,"ngModelChange","ngModel"],["vdrDialogButtons",""],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"click","disabled"]],template:function(i,n){i&1&&(f(0,Op,2,3,"ng-template",0),a(1,"p",1),u(2),d(3,"translate"),l(),a(4,"clr-input-container")(5,"label"),u(6),d(7,"translate"),l(),a(8,"input",2),$("ngModelChange",function(C){return N(n.transactionId,C)||(n.transactionId=C),C}),l()(),f(9,Ip,6,7,"ng-template",3)),i&2&&(r(2),_(" ",x(3,3,"order.settle-refund-manual-instructions",A(8,Sp,n.refund.method)),`
`),r(4),v(s(7,6,"order.transaction-id")),r(2),R("ngModel",n.transactionId))},dependencies:[Ce,sr,pr,ne,z,oe,U,ae,te,I],styles:[`[_nghost-%COMP%]{padding-bottom:32px}.instruction[_ngcontent-%COMP%]{margin-top:0;margin-bottom:24px}
/*# sourceMappingURL=settle-refund-dialog.component-B7TP67HT.css.map */`],changeDetection:0})}}return t})();function Tp(t,p){t&1&&g(0,"clr-icon",2)}var _o=(()=>{class t{get chipColorType(){switch(this.state){case"Authorized":return"warning";case"Settled":return"success";case"Declined":case"Cancelled":return"error"}}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-payment-state-label"]],inputs:{state:"state"},standalone:!1,decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(i,n){i&1&&(a(0,"vdr-chip",0),d(1,"translate"),f(2,Tp,1,0,"clr-icon",1),u(3),d(4,"stateI18nToken"),d(5,"translate"),l()),i&2&&(o("title",s(1,4,"order.payment-state"))("colorType",n.chipColorType),r(2),o("ngIf",n.state==="Settled"),r(),_(" ",s(5,8,s(4,6,n.state)),`
`))},dependencies:[B,w,ue,I,fe],styles:[`[_nghost-%COMP%]{display:flex;font-size:14px}
/*# sourceMappingURL=payment-state-label.component-6FU7MNV7.css.map */`],changeDetection:0})}}return t})();function wp(t,p){t&1&&g(0,"clr-icon",2)}var go=(()=>{class t{get chipColorType(){switch(this.state){case"Pending":return"warning";case"Settled":return"success";case"Failed":return"error"}}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-refund-state-label"]],inputs:{state:"state"},standalone:!1,decls:6,vars:10,consts:[[3,"title","colorType"],["shape","check-circle",4,"ngIf"],["shape","check-circle"]],template:function(i,n){i&1&&(a(0,"vdr-chip",0),d(1,"translate"),f(2,wp,1,0,"clr-icon",1),u(3),d(4,"stateI18nToken"),d(5,"translate"),l()),i&2&&(o("title",s(1,4,"order.payment-state"))("colorType",n.chipColorType),r(2),o("ngIf",n.state==="Settled"),r(),_(" ",s(5,8,s(4,6,n.state)),`
`))},dependencies:[B,w,ue,I,fe],styles:[`[_nghost-%COMP%]{display:flex;font-size:14px}
/*# sourceMappingURL=refund-state-label.component-ZPPDCCUT.css.map */`],changeDetection:0})}}return t})();function Mp(t,p){if(t&1&&(a(0,"vdr-labeled-data",0),d(1,"translate"),u(2),l()),t&2){let e=m();o("label",s(1,2,"order.error-message")),r(2),_(" ",e.payment.errorMessage,`
`)}}function Fp(t,p){if(t&1&&(a(0,"vdr-labeled-data",0),d(1,"translate"),u(2),l()),t&2){let e=m();o("label",s(1,2,"order.transaction-id")),r(2),_(" ",e.payment.transactionId,`
`)}}var rn=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-payment-detail"]],inputs:{payment:"payment",currencyCode:"currencyCode"},standalone:!1,decls:12,vars:17,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"value"]],template:function(i,n){i&1&&(a(0,"vdr-labeled-data",0),d(1,"translate"),u(2),l(),a(3,"vdr-labeled-data",0),d(4,"translate"),u(5),d(6,"localeCurrency"),l(),f(7,Mp,3,4,"vdr-labeled-data",1)(8,Fp,3,4,"vdr-labeled-data",1),a(9,"vdr-labeled-data",0),d(10,"translate"),g(11,"vdr-object-tree",2),l()),i&2&&(o("label",s(1,8,"order.payment-method")),r(2),_(" ",n.payment.method,`
`),r(),o("label",s(4,10,"order.amount")),r(2),_(" ",x(6,12,n.payment.amount,n.currencyCode),`
`),r(2),o("ngIf",n.payment.errorMessage),r(),o("ngIf",n.payment.transactionId),r(),o("label",s(10,15,"order.payment-metadata")),r(2),o("value",n.payment.metadata))},dependencies:[w,X,He,I,k],styles:["/*# sourceMappingURL=payment-detail.component-EACTGXKS.css.map */"],changeDetection:0})}}return t})();var Ep=t=>({state:t});function Bp(t,p){if(t&1&&(T(0),u(1),d(2,"localeCurrency"),D()),t&2){let e=m();r(),v(x(2,1,e.payment.amount,e.currencyCode))}}function kp(t,p){if(t&1&&(a(0,"vdr-labeled-data",14),d(1,"translate"),u(2),l()),t&2){let e=m().$implicit;o("label",s(1,2,"order.transaction-id")),r(2),_(" ",e.transactionId," ")}}function Lp(t,p){if(t&1&&(a(0,"vdr-labeled-data",14),d(1,"translate"),u(2),l()),t&2){let e=m().$implicit;o("label",s(1,2,"order.refund-reason")),r(2),_(" ",e.reason," ")}}function Ap(t,p){if(t&1&&(a(0,"vdr-labeled-data",14),d(1,"translate"),g(2,"vdr-object-tree",16),l()),t&2){let e=m().$implicit;o("label",s(1,2,"order.refund-metadata")),r(2),o("value",e.metadata)}}function Vp(t,p){if(t&1){let e=S();a(0,"div",17)(1,"button",18),b("click",function(){h(e);let n=m().$implicit,c=m();return y(c.settleRefund.emit(n))}),u(2),d(3,"translate"),l()()}t&2&&(r(2),_(" ",s(3,1,"order.settle-refund")," "))}function Rp(t,p){if(t&1&&(T(0),a(1,"div",10)(2,"div",11),g(3,"clr-icon",12),u(4),d(5,"translate"),g(6,"div",13)(7,"vdr-refund-state-label",5),l(),a(8,"div",6)(9,"vdr-labeled-data",14),d(10,"translate"),u(11),d(12,"localeDate"),l(),a(13,"vdr-labeled-data",14),d(14,"translate"),u(15),d(16,"localeCurrency"),l(),f(17,kp,3,4,"vdr-labeled-data",15)(18,Lp,3,4,"vdr-labeled-data",15)(19,Ap,3,4,"vdr-labeled-data",15),l(),f(20,Vp,4,3,"div",9),l(),D()),t&2){let e=p.$implicit,i=m();r(4),ie(" ",s(5,11,"order.refund")," #",e.id," "),r(3),o("state",e.state),r(2),o("label",s(10,13,"common.created-at")),r(2),_(" ",x(12,15,e.createdAt,"medium")," "),r(2),o("label",s(14,18,"order.refund-total")),r(2),_(" ",x(16,20,e.total,i.currencyCode)," "),r(2),o("ngIf",e.transactionId),r(),o("ngIf",e.reason),r(),o("ngIf",i.refundHasMetadata(e)),r(),o("ngIf",e.state==="Pending")}}function Np(t,p){if(t&1){let e=S();a(0,"button",18),b("click",function(){h(e);let n=m(2);return y(n.settlePayment.emit(n.payment))}),u(1),d(2,"translate"),l()}t&2&&(r(),_(" ",s(2,1,"order.settle-payment")," "))}function $p(t,p){if(t&1&&(T(0),g(1,"clr-icon",25),u(2),d(3,"stateI18nToken"),d(4,"translate"),d(5,"translate"),D()),t&2){let e=m().$implicit;r(2),_(" ",x(5,5,"order.transition-to-state",A(8,Ep,s(4,3,s(3,1,e))))," ")}}function jp(t,p){t&1&&(g(0,"clr-icon",26),u(1),d(2,"translate")),t&2&&(r(),_(" ",s(2,1,"order.cancel-payment")," "))}function qp(t,p){if(t&1){let e=S();T(0),a(1,"button",23),b("click",function(){let n=h(e).$implicit,c=m(2);return y(c.transitionPaymentState.emit({payment:c.payment,state:n}))}),f(2,$p,6,10,"ng-container",24)(3,jp,3,3,"ng-template",null,0,ee),l(),D()}if(t&2){let e=p.$implicit,i=Y(4);r(2),o("ngIf",e!=="Cancelled")("ngIfElse",i)}}function Wp(t,p){if(t&1&&(a(0,"div",17),f(1,Np,3,3,"button",19),a(2,"vdr-dropdown")(3,"button",20),g(4,"clr-icon",21),l(),a(5,"vdr-dropdown-menu",22),f(6,qp,5,2,"ng-container",8),l()()()),t&2){let e=m();r(),o("ngIf",e.payment.nextStates.includes("Settled")),r(5),o("ngForOf",e.nextOtherStates())}}var vo=(()=>{class t{constructor(){this.settlePayment=new J,this.transitionPaymentState=new J,this.settleRefund=new J}refundHasMetadata(e){return!!e&&Object.keys(e.metadata).length>0}nextOtherStates(){return this.payment?this.payment.nextStates.filter(e=>e!=="Settled"&&e!=="Error"):[]}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-order-payment-card"]],inputs:{payment:"payment",currencyCode:"currencyCode"},outputs:{settlePayment:"settlePayment",transitionPaymentState:"transitionPaymentState",settleRefund:"settleRefund"},standalone:!1,decls:12,vars:9,consts:[["cancel",""],[1,"card"],[1,"card-header","payment-header"],[4,"ngIf"],[1,"payment-state"],[3,"state"],[1,"card-block"],[3,"payment","currencyCode"],[4,"ngFor","ngForOf"],["class","card-footer",4,"ngIf"],[1,"refund-wrapper","card-block"],[1,"card-header","payment-header","refund-header"],["shape","redo","dir","down",1,"refund-icon"],[1,"clr-flex-fill"],[3,"label"],[3,"label",4,"ngIf"],[3,"value"],[1,"card-footer"],[1,"btn","btn-sm","btn-primary",3,"click"],["class","btn btn-sm btn-primary",3,"click",4,"ngIf"],["vdrDropdownTrigger","",1,"icon-button"],["shape","ellipsis-vertical"],["vdrPosition","bottom-right"],["type","button","vdrDropdownItem","",3,"click"],[4,"ngIf","ngIfElse"],["shape","step-forward-2"],["shape","error-standard",1,"is-error"]],template:function(i,n){i&1&&(a(0,"div",1)(1,"div",2)(2,"div"),u(3),d(4,"translate"),f(5,Bp,3,4,"ng-container",3),l(),a(6,"div",4),g(7,"vdr-payment-state-label",5),l()(),a(8,"div",6),g(9,"vdr-payment-detail",7),l(),f(10,Rp,21,23,"ng-container",8)(11,Wp,7,2,"div",9),l()),i&2&&(r(3),_(" ",s(4,7,"order.payment")," "),r(2),o("ngIf",n.payment.amount),r(2),o("state",n.payment.state),r(2),o("payment",n.payment)("currencyCode",n.currencyCode),r(),o("ngForOf",n.payment.refunds),r(),o("ngIf",n.payment.nextStates.length))},dependencies:[B,M,w,Ci,Te,De,we,qe,X,He,_o,go,rn,I,fe,he,k],styles:[`[_nghost-%COMP%]{display:block}.payment-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;line-break:anywhere}.refund-icon[_ngcontent-%COMP%]{margin-inline-end:6px;color:var(--color-grey-400)}.card-footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end}.refund-wrapper[_ngcontent-%COMP%]{font-size:var(--font-size-xs)}
/*# sourceMappingURL=order-payment-card.component-OTGBXB3V.css.map */`],changeDetection:0})}}return t})();var Gp=["portal"],ho=(()=>{class t{constructor(e){this.historyEntryComponentService=e,this.expandClick=new J}ngOnInit(){let e=this.historyEntryComponentService.getComponent(this.entry.type),i=this.portalRef.createComponent(e);i.instance.entry=this.entry,i.instance.order=this.order,this.instance=i.instance,this.componentRef=i}ngOnDestroy(){this.componentRef?.destroy()}static{this.\u0275fac=function(i){return new(i||t)(P(qi))}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-order-history-entry-host"]],viewQuery:function(i,n){if(i&1&&li(Gp,7,En),i&2){let c;gt(c=Ct())&&(n.portalRef=c.first)}},inputs:{entry:"entry",order:"order",expanded:"expanded"},outputs:{expandClick:"expandClick"},exportAs:["historyEntry"],standalone:!1,decls:3,vars:6,consts:[["portal",""],[3,"expandClick","displayType","iconShape","createdAt","name","featured","collapsed"]],template:function(i,n){if(i&1){let c=S();a(0,"vdr-timeline-entry",1),b("expandClick",function(){return h(c),y(n.expandClick.emit())}),g(1,"div",null,0),l()}i&2&&o("displayType",n.instance.getDisplayType(n.entry))("iconShape",n.instance.getIconShape&&n.instance.getIconShape(n.entry))("createdAt",n.entry.createdAt)("name",n.instance.getName&&n.instance.getName(n.entry))("featured",n.instance.isFeatured(n.entry))("collapsed",!n.expanded&&!n.instance.isFeatured(n.entry))},dependencies:[$i],encapsulation:2})}}return t})();var yo=(t,p)=>({from:t,to:p}),xo=(t,p,e)=>({from:t,to:p,id:e}),Xp=t=>({count:t}),Yp=t=>["/marketing","promotions",t],Jp=t=>({newCustomerName:t}),bo=t=>["/customer","customers",t];function Zp(t,p){t&1&&(a(0,"span",15),u(1),d(2,"translate"),l()),t&2&&(r(),_(" ",s(2,1,"order.note-only-visible-to-administrators")," "))}function Kp(t,p){t&1&&(a(0,"span",16),u(1),d(2,"translate"),l()),t&2&&(r(),_(" ",s(2,1,"order.note-visible-to-customer")," "))}function es(t,p){if(t&1){let e=S();a(0,"vdr-order-history-entry-host",18),b("expandClick",function(){h(e);let n=m(2);return y(n.expanded=!n.expanded)}),l()}if(t&2){let e=m().$implicit,i=m();o("order",i.order)("entry",e)("expanded",i.expanded)}}function ts(t,p){t&1&&(a(0,"div",14),u(1),d(2,"translate"),l()),t&2&&(r(),_(" ",s(2,1,"order.history-order-fulfilled")," "))}function is(t,p){t&1&&(a(0,"div",14),u(1),d(2,"translate"),l()),t&2&&(r(),_(" ",s(2,1,"order.history-order-cancelled")," "))}function ns(t,p){if(t&1&&(u(0),d(1,"translate")),t&2){let e=m(3).$implicit;_(" ",x(1,1,"order.history-order-transition",Xe(4,yo,e.data.from,e.data.to))," ")}}function rs(t,p){if(t&1&&(T(0),f(1,ts,3,3,"div",23)(2,is,3,3,"div",23)(3,ns,2,7,"ng-template",24),D()),t&2){let e=m(2).$implicit;r(),o("ngIf",e.data.to==="Delivered"),r(),o("ngIf",e.data.to==="Cancelled"),r(),o("ngIf",e.data.to!=="Cancelled"&&e.data.to!=="Delivered")}}function os(t,p){t&1&&(a(0,"vdr-chip",30),u(1),d(2,"translate"),l()),t&2&&(r(),v(s(2,1,"order.modification-settled")))}function as(t,p){t&1&&(a(0,"vdr-chip",31),u(1),d(2,"translate"),l()),t&2&&(r(),v(s(2,1,"order.modification-not-settled")))}function ls(t,p){if(t&1&&(a(0,"div",26),u(1),d(2,"translate"),a(3,"strong"),u(4),d(5,"localeCurrency"),l(),f(6,os,3,3,"vdr-chip",27)(7,as,3,3,"vdr-chip",28),a(8,"vdr-history-entry-detail"),g(9,"vdr-modification-detail",29),l()()),t&2){let e=p.ngIf,i=m(4);r(),_(" ",s(2,6,"order.modify-order-price-difference"),": "),r(3),v(x(5,8,e.priceChange,i.order.currencyCode)),r(2),o("ngIf",e.isSettled),r(),o("ngIf",!e.isSettled),r(2),o("order",i.order)("modification",e)}}function ds(t,p){if(t&1&&(T(0),a(1,"div",14),u(2),d(3,"translate"),l(),f(4,ls,10,11,"div",25),D()),t&2){let e=m(2).$implicit,i=m();r(2),_(" ",s(3,2,"order.history-order-modified")," "),r(2),o("ngIf",i.getModification(e.data.modificationId))}}function ps(t,p){if(t&1&&(a(0,"vdr-chip",35),u(1),d(2,"localeCurrency"),l()),t&2){let e=p.ngIf,i=m(5);r(),v(x(2,1,e.amount,i.order.currencyCode))}}function ss(t,p){if(t&1&&(a(0,"vdr-history-entry-detail"),g(1,"vdr-payment-detail",36),l()),t&2){let e=p.ngIf,i=m(5);r(),o("payment",e)("currencyCode",i.order.currencyCode)}}function cs(t,p){if(t&1&&(T(0),a(1,"div",14),u(2),d(3,"translate"),l(),a(4,"div",26),f(5,ps,3,4,"vdr-chip",33)(6,ss,2,2,"vdr-history-entry-detail",34),l(),D()),t&2){let e=m(3).$implicit,i=m();r(2),_(" ",s(3,3,"order.history-payment-settled")," "),r(3),o("ngIf",i.getPayment(e)),r(),o("ngIf",i.getPayment(e))}}function ms(t,p){if(t&1&&(u(0),d(1,"translate")),t&2){let e,i=m(3).$implicit,n=m();_(" ",x(1,1,"order.history-payment-transition",sn(4,xo,i.data.from,i.data.to,(e=n.getPayment(i))==null?null:e.transactionId))," ")}}function us(t,p){if(t&1&&(T(0),f(1,cs,7,5,"ng-container",32)(2,ms,2,8,"ng-template",null,1,ee),D()),t&2){let e=Y(3),i=m(2).$implicit;r(),o("ngIf",i.data.to==="Settled")("ngIfElse",e)}}function fs(t,p){if(t&1&&(T(0),a(1,"div",14),u(2),d(3,"translate"),l(),a(4,"div",26)(5,"vdr-chip",37),u(6),d(7,"localeCurrency"),l(),a(8,"vdr-history-entry-detail")(9,"vdr-labeled-data",38),d(10,"translate"),u(11),l(),a(12,"vdr-labeled-data",38),d(13,"translate"),g(14,"vdr-simple-item-list",39),l()()(),D()),t&2){let e=p.ngIf,i=m(4).$implicit,n=m();r(2),ie("",s(3,7,"order.refund")," #",e.id,""),r(4),v(x(7,9,e.total,n.order.currencyCode)),r(3),o("label",s(10,12,"order.cancellation-reason")),r(2),_(" ",i.data.reason," "),r(),o("label",s(13,14,"order.contents")),r(2),o("items",n.getCancelledItems(e.lines))}}function _s(t,p){if(t&1&&(T(0),f(1,fs,15,16,"ng-container",34),D()),t&2){let e=m(3).$implicit,i=m();r(),o("ngIf",i.getRefund(e))}}function gs(t,p){if(t&1&&(u(0),d(1,"translate")),t&2){let e=m(3).$implicit;_(" ",x(1,1,"order.history-refund-transition",sn(4,xo,e.data.from,e.data.to,e.data.refundId))," ")}}function Cs(t,p){if(t&1&&(T(0),f(1,_s,2,1,"ng-container",32)(2,gs,2,8,"ng-template",null,2,ee),D()),t&2){let e=Y(3),i=m(2).$implicit;r(),o("ngIf",i.data.to==="Settled")("ngIfElse",e)}}function vs(t,p){if(t&1&&(a(0,"vdr-history-entry-detail")(1,"vdr-labeled-data",38),d(2,"translate"),u(3),l(),a(4,"vdr-labeled-data",38),d(5,"translate"),g(6,"vdr-simple-item-list",39),l(),a(7,"vdr-labeled-data",38),d(8,"translate"),u(9),l()()),t&2){let e=p.ngIf,i=m(3).$implicit;r(),o("label",s(2,6,"order.cancellation-reason")),r(2),_(" ",i.data.reason," "),r(),o("label",s(5,8,"order.contents")),r(2),o("items",e),r(),o("label",s(8,10,"order.shipping-cancelled")),r(2),_(" ",i.data.shippingCancelled," ")}}function hs(t,p){if(t&1&&(T(0),u(1),d(2,"translate"),f(3,vs,10,12,"vdr-history-entry-detail",34),D()),t&2){let e=m(2).$implicit,i=m();r(),_(" ",x(2,2,"order.history-items-cancelled",A(5,Xp,i.getCancelledQuantity(e)))," "),r(2),o("ngIf",i.getCancelledItems(e.data.lines))}}function ys(t,p){if(t&1&&(a(0,"vdr-history-entry-detail"),g(1,"vdr-fulfillment-detail",40),l()),t&2){let e=p.ngIf,i=m(4);r(),o("fulfillmentId",e.id)("order",i.order)}}function xs(t,p){if(t&1&&(T(0),u(1),d(2,"translate"),f(3,ys,2,2,"vdr-history-entry-detail",34),D()),t&2){let e=m(2).$implicit,i=m();r(),_(" ",s(2,2,"order.history-fulfillment-created")," "),r(2),o("ngIf",i.getFulfillment(e))}}function bs(t,p){if(t&1&&(T(0),a(1,"div",14),u(2),d(3,"translate"),l(),u(4),d(5,"translate"),D()),t&2){let e,i=m(3).$implicit,n=m();r(2),_(" ",s(3,3,"order.history-fulfillment-delivered")," "),r(2),ie(" ",s(5,5,"order.tracking-code"),": ",(e=n.getFulfillment(i))==null?null:e.trackingCode," ")}}function Ss(t,p){if(t&1&&(T(0),a(1,"div",14),u(2),d(3,"translate"),l(),u(4),d(5,"translate"),D()),t&2){let e,i=m(3).$implicit,n=m();r(2),_(" ",s(3,3,"order.history-fulfillment-shipped")," "),r(2),ie(" ",s(5,5,"order.tracking-code"),": ",(e=n.getFulfillment(i))==null?null:e.trackingCode," ")}}function Os(t,p){if(t&1&&(T(0),u(1),d(2,"translate"),D()),t&2){let e=m(3).$implicit;r(),_(" ",x(2,1,"order.history-fulfillment-transition",Xe(4,yo,e.data.from,e.data.to))," ")}}function Is(t,p){if(t&1&&(a(0,"vdr-history-entry-detail"),g(1,"vdr-fulfillment-detail",40),l()),t&2){let e=p.ngIf,i=m(4);r(),o("fulfillmentId",e.id)("order",i.order)}}function Ts(t,p){if(t&1&&(T(0),f(1,bs,6,7,"ng-container",34)(2,Ss,6,7,"ng-container",34)(3,Os,3,7,"ng-container",34)(4,Is,2,2,"vdr-history-entry-detail",34),D()),t&2){let e=m(2).$implicit,i=m();r(),o("ngIf",e.data.to==="Delivered"),r(),o("ngIf",e.data.to==="Shipped"),r(),o("ngIf",e.data.to!=="Delivered"&&e.data.to!=="Shipped"),r(),o("ngIf",i.getFulfillment(e))}}function Ds(t,p){t&1&&(a(0,"span",53),u(1),d(2,"translate"),l()),t&2&&(r(),v(s(2,1,"common.public")))}function ws(t,p){t&1&&(a(0,"span",54),u(1),d(2,"translate"),l()),t&2&&(r(),v(s(2,1,"common.private")))}function Ps(t,p){if(t&1){let e=S();T(0),a(1,"div",41)(2,"div",42),f(3,Ds,3,3,"span",43)(4,ws,3,3,"span",44),u(5),l(),g(6,"div",45),a(7,"vdr-dropdown")(8,"button",46),g(9,"clr-icon",47),l(),a(10,"vdr-dropdown-menu",48)(11,"button",49),d(12,"hasPermission"),b("click",function(){h(e);let n=m(2).$implicit,c=m();return y(c.updateNote.emit(n))}),g(13,"clr-icon",50),u(14),d(15,"translate"),l(),g(16,"div",51),a(17,"button",49),d(18,"hasPermission"),b("click",function(){h(e);let n=m(2).$implicit,c=m();return y(c.deleteNote.emit(n))}),g(19,"clr-icon",52),u(20),d(21,"translate"),l()()()(),D()}if(t&2){let e=m(2).$implicit;r(3),o("ngIf",e.isPublic),r(),o("ngIf",!e.isPublic),r(),_(" ",e.data.note," "),r(6),o("disabled",!s(12,7,"UpdateOrder")),r(3),_(" ",s(15,9,"common.edit")," "),r(3),o("disabled",!s(18,11,"UpdateOrder")),r(3),_(" ",s(21,13,"common.delete")," ")}}function Ms(t,p){if(t&1&&(T(0),u(1),d(2,"translate"),a(3,"vdr-chip")(4,"a",55),u(5),l()(),D()),t&2){let e=m(2).$implicit;r(),_(" ",s(2,3,"order.history-coupon-code-applied"),": "),r(3),o("routerLink",A(5,Yp,e.data.promotionId)),r(),v(e.data.couponCode)}}function Fs(t,p){if(t&1&&(T(0),u(1),d(2,"translate"),a(3,"vdr-chip")(4,"span",56),u(5),l()(),D()),t&2){let e=m(2).$implicit;r(),_(" ",s(2,2,"order.history-coupon-code-removed"),": "),r(4),v(e.data.couponCode)}}function Es(t,p){if(t&1&&(a(0,"a",58),g(1,"clr-icon",59),a(2,"span"),u(3),l(),g(4,"clr-icon",60),l()),t&2){let e=m(3).$implicit;o("routerLink",A(2,bo,e.data.previousCustomerId)),r(3),v(e.data.previousCustomerName)}}function Bs(t,p){if(t&1&&(a(0,"a",58),g(1,"clr-icon",59),a(2,"span"),u(3),l(),g(4,"clr-icon",60),l()),t&2){let e=m(3).$implicit;o("routerLink",A(2,bo,e.data.newCustomerId)),r(3),v(e.data.newCustomerName)}}function ks(t,p){if(t&1&&(T(0),a(1,"div",14),u(2),d(3,"translate"),l(),a(4,"div",41)(5,"div",42),u(6),l(),g(7,"div",45),a(8,"vdr-history-entry-detail")(9,"vdr-labeled-data",38),d(10,"translate"),f(11,Es,5,4,"a",57),l(),a(12,"vdr-labeled-data",38),d(13,"translate"),f(14,Bs,5,4,"a",57),l()()(),D()),t&2){let e=m(2).$implicit;r(2),_(" ",x(3,6,"order.history-customer-updated",A(13,Jp,e.data.newCustomerName))," "),r(4),_(" ",e.data.note," "),r(3),o("label",s(10,9,"order.previous-customer")),r(2),o("ngIf",e.data.previousCustomerId),r(),o("label",s(13,11,"order.new-customer")),r(2),o("ngIf",e.data.newCustomerId)}}function Ls(t,p){if(t&1&&(a(0,"vdr-history-entry-detail"),g(1,"vdr-object-tree",61),l()),t&2){let e=m(3).$implicit;r(),o("value",e.data)}}function As(t,p){if(t&1&&(T(0),a(1,"div",14),u(2),d(3,"translate"),l(),f(4,Ls,2,1,"vdr-history-entry-detail",34),D()),t&2){let e=m(2).$implicit;r(2),_(" ",s(3,2,e.type)," "),r(2),o("ngIf",e.data)}}function Vs(t,p){if(t&1){let e=S();a(0,"vdr-timeline-entry",19),b("expandClick",function(){h(e);let n=m(2);return y(n.expanded=!n.expanded)}),T(1,20),f(2,rs,4,3,"ng-container",21)(3,ds,5,4,"ng-container",21)(4,us,4,2,"ng-container",21)(5,Cs,4,2,"ng-container",21)(6,hs,4,7,"ng-container",21)(7,xs,4,4,"ng-container",21)(8,Ts,5,4,"ng-container",21)(9,Ps,22,15,"ng-container",21)(10,Ms,6,7,"ng-container",21)(11,Fs,6,4,"ng-container",21)(12,ks,15,15,"ng-container",21)(13,As,5,4,"ng-container",22),D(),l()}if(t&2){let e=m().$implicit,i=m();o("displayType",i.getDisplayType(e))("iconShape",i.getTimelineIcon(e))("createdAt",e.createdAt)("name",i.getName(e))("featured",i.isFeatured(e))("collapsed",!i.expanded&&!i.isFeatured(e)),r(),o("ngSwitch",e.type),r(),o("ngSwitchCase",i.type.ORDER_STATE_TRANSITION),r(),o("ngSwitchCase",i.type.ORDER_MODIFIED),r(),o("ngSwitchCase",i.type.ORDER_PAYMENT_TRANSITION),r(),o("ngSwitchCase",i.type.ORDER_REFUND_TRANSITION),r(),o("ngSwitchCase",i.type.ORDER_CANCELLATION),r(),o("ngSwitchCase",i.type.ORDER_FULFILLMENT),r(),o("ngSwitchCase",i.type.ORDER_FULFILLMENT_TRANSITION),r(),o("ngSwitchCase",i.type.ORDER_NOTE),r(),o("ngSwitchCase",i.type.ORDER_COUPON_APPLIED),r(),o("ngSwitchCase",i.type.ORDER_COUPON_REMOVED),r(),o("ngSwitchCase",i.type.ORDER_CUSTOMER_UPDATED)}}function Rs(t,p){if(t&1&&(T(0),f(1,es,1,3,"vdr-order-history-entry-host",17)(2,Vs,14,18,"ng-template",null,0,ee),D()),t&2){let e=p.$implicit,i=Y(3),n=m();r(),o("ngIf",n.hasCustomComponent(e.type))("ngIfElse",i)}}var So=(()=>{class t{constructor(e){this.historyEntryComponentService=e,this.addNote=new J,this.updateNote=new J,this.deleteNote=new J,this.note="",this.noteIsPrivate=!0,this.expanded=!1,this.type=q}hasCustomComponent(e){return!!this.historyEntryComponentService.getComponent(e)}getDisplayType(e){if(e.type===q.ORDER_STATE_TRANSITION){if(e.data.to==="Delivered")return"success";if(e.data.to==="Cancelled")return"error"}return e.type===q.ORDER_FULFILLMENT_TRANSITION&&e.data.to==="Delivered"?"success":e.type===q.ORDER_PAYMENT_TRANSITION&&(e.data.to==="Declined"||e.data.to==="Cancelled")?"error":e.type===q.ORDER_CANCELLATION||e.type===q.ORDER_REFUND_TRANSITION?"warning":"default"}getTimelineIcon(e){if(e.type===q.ORDER_STATE_TRANSITION){if(e.data.to==="Delivered")return["success-standard","is-solid"];if(e.data.to==="Cancelled")return"ban"}if(e.type===q.ORDER_PAYMENT_TRANSITION&&e.data.to==="Settled"||e.type===q.ORDER_REFUND_TRANSITION&&e.data.to==="Settled")return"credit-card";if(e.type===q.ORDER_NOTE)return"note";if(e.type===q.ORDER_MODIFIED)return"pencil";if(e.type===q.ORDER_CUSTOMER_UPDATED)return"switch";if(e.type===q.ORDER_FULFILLMENT_TRANSITION&&(e.data.to==="Shipped"||e.data.to==="Delivered"))return"truck"}isFeatured(e){switch(e.type){case q.ORDER_STATE_TRANSITION:return e.data.to==="Delivered"||e.data.to==="Cancelled"||e.data.to==="Settled";case q.ORDER_REFUND_TRANSITION:return e.data.to==="Settled";case q.ORDER_PAYMENT_TRANSITION:return e.data.to==="Settled"||e.data.to==="Cancelled";case q.ORDER_FULFILLMENT_TRANSITION:return e.data.to==="Delivered"||e.data.to==="Shipped";case q.ORDER_NOTE:case q.ORDER_MODIFIED:case q.ORDER_CUSTOMER_UPDATED:return!0;default:return!1}}getFulfillment(e){if((e.type===q.ORDER_FULFILLMENT||e.type===q.ORDER_FULFILLMENT_TRANSITION)&&this.order.fulfillments)return this.order.fulfillments.find(i=>i.id===e.data.fulfillmentId)}getPayment(e){if(e.type===q.ORDER_PAYMENT_TRANSITION&&this.order.payments)return this.order.payments.find(i=>i.id===e.data.paymentId)}getRefund(e){if(e.type===q.ORDER_REFUND_TRANSITION&&this.order.payments)return this.order.payments.reduce((n,c)=>n.concat(c.refunds),[]).find(n=>n.id===e.data.refundId)}getCancelledQuantity(e){return e.data.lines.reduce((i,n)=>i+n.quantity,0)}getCancelledItems(e){let i=new Map;for(let n of this.order.lines){let c=e.find(C=>C.orderLineId===n.id);if(c){let C=i.get(n.productVariant.name);i.set(n.productVariant.name,c.quantity)}}return Array.from(i.entries()).map(([n,c])=>({name:n,quantity:c}))}getModification(e){return this.order.modifications.find(i=>i.id===e)}getName(e){let{administrator:i}=e;if(i)return`${i.firstName} ${i.lastName}`;{let n=this.order.customer;if(n)return`${n.firstName} ${n.lastName}`}return""}addNoteToOrder(){this.addNote.emit({note:this.note,isPublic:!this.noteIsPrivate}),this.note="",this.noteIsPrivate=!0}static{this.\u0275fac=function(i){return new(i||t)(P(qi))}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-order-history"]],inputs:{order:"order",history:"history"},outputs:{addNote:"addNote",updateNote:"updateNote",deleteNote:"deleteNote"},standalone:!1,decls:20,vars:22,consts:[["defaultComponents",""],["regularPaymentTransition",""],["regularRefundTransition",""],[1,"entry-list"],["iconShape","note","displayType","muted",3,"featured","isFirst"],[1,"note-entry"],["name","note",1,"note",3,"ngModelChange","ngModel"],[1,"btn","btn-secondary",3,"click","disabled"],[1,"visibility-select"],["type","checkbox","clrCheckbox","",3,"ngModelChange","ngModel"],["class","private",4,"ngIf"],["class","public",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"isLast","createdAt","featured"],[1,"title"],[1,"private"],[1,"public"],[3,"order","entry","expanded","expandClick",4,"ngIf","ngIfElse"],[3,"expandClick","order","entry","expanded"],[3,"expandClick","displayType","iconShape","createdAt","name","featured","collapsed"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["class","title",4,"ngIf"],[3,"ngIf"],["class","flex items-center",4,"ngIf"],[1,"flex","items-center"],["colorType","success","class","mx-1",4,"ngIf"],["colorType","error","class","mx-1",4,"ngIf"],[3,"order","modification"],["colorType","success",1,"mx-1"],["colorType","error",1,"mx-1"],[4,"ngIf","ngIfElse"],["class","mr-1",4,"ngIf"],[4,"ngIf"],[1,"mr-1"],[3,"payment","currencyCode"],["colorType","warning",1,"mr-1"],[3,"label"],[3,"items"],[3,"fulfillmentId","order"],[1,"flex"],[1,"note-text"],["class","note-visibility public",4,"ngIf"],["class","note-visibility private",4,"ngIf"],[1,"flex-spacer"],["vdrDropdownTrigger","",1,"button-small","ml-1"],["shape","ellipsis-vertical","size","12"],["vdrPosition","bottom-right"],["vdrDropdownItem","",3,"click","disabled"],["shape","edit"],[1,"dropdown-divider"],["shape","trash",1,"is-danger"],[1,"note-visibility","public"],[1,"note-visibility","private"],[3,"routerLink"],[1,"cancelled-coupon-code"],["class","button-ghost",3,"routerLink",4,"ngIf"],[1,"button-ghost",3,"routerLink"],["shape","user",1,"is-solid"],["shape","arrow right"],[3,"value"]],template:function(i,n){i&1&&(a(0,"div",3)(1,"vdr-timeline-entry",4)(2,"div",5)(3,"textarea",6),$("ngModelChange",function(C){return N(n.note,C)||(n.note=C),C}),l(),a(4,"button",7),b("click",function(){return n.addNoteToOrder()}),u(5),d(6,"translate"),l()(),a(7,"div",8)(8,"clr-checkbox-wrapper")(9,"input",9),$("ngModelChange",function(C){return N(n.noteIsPrivate,C)||(n.noteIsPrivate=C),C}),l(),a(10,"label"),u(11),d(12,"translate"),l()(),f(13,Zp,3,3,"span",10)(14,Kp,3,3,"span",11),l()(),f(15,Rs,4,2,"ng-container",12),a(16,"vdr-timeline-entry",13)(17,"div",14),u(18),d(19,"translate"),l()()()),i&2&&(Q("expanded",n.expanded),r(),o("featured",!0)("isFirst",!0),r(2),R("ngModel",n.note),r(),o("disabled",!n.note),r(),_(" ",s(6,16,"common.add-note")," "),r(4),R("ngModel",n.noteIsPrivate),r(2),v(s(12,18,"order.note-is-private")),r(2),o("ngIf",n.noteIsPrivate),r(),o("ngIf",!n.noteIsPrivate),r(),o("ngForOf",n.history),r(),o("isLast",!0)("createdAt",n.order.createdAt)("featured",!0),r(2),_(" ",s(19,20,"order.history-order-created")," "))},dependencies:[B,Ce,tt,dr,M,w,jn,qn,Wn,ne,xt,z,oe,Re,ue,U,Te,De,we,qe,X,He,$i,Pr,Ki,rn,qt,ro,ho,I,Ei,k],styles:[`[_nghost-%COMP%]{display:block}.entry-list[_ngcontent-%COMP%]{margin-inline-start:calc(var(--space-unit) * 2)}.note-entry[_ngcontent-%COMP%]{display:flex;align-items:center}.note-entry[_ngcontent-%COMP%]   .note[_ngcontent-%COMP%]{flex:1}.note-entry[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0}.visibility-select[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:baseline}.visibility-select[_ngcontent-%COMP%]   .public[_ngcontent-%COMP%]{color:var(--color-warning-700)}.visibility-select[_ngcontent-%COMP%]   .private[_ngcontent-%COMP%]{color:var(--color-success-700)}textarea.note[_ngcontent-%COMP%]{flex:1;height:36px;border-radius:3px;margin-inline-end:6px}.note-text[_ngcontent-%COMP%]{color:var(--color-grey-800);white-space:pre-wrap;max-width:580px}.cancelled-coupon-code[_ngcontent-%COMP%]{text-decoration:line-through}.note-visibility[_ngcontent-%COMP%]{text-transform:lowercase}.note-visibility.public[_ngcontent-%COMP%]{color:var(--color-warning-700)}.note-visibility.private[_ngcontent-%COMP%]{color:var(--color-success-700)}
/*# sourceMappingURL=order-history.component-OST3F3XT.css.map */`],changeDetection:0})}}return t})();var Io=Ee(Ao());var Oo=be`
    query GetSellerOrders($orderId: ID!) {
        order(id: $orderId) {
            id
            sellerOrders {
                id
                code
                state
                orderPlacedAt
                currencyCode
                totalWithTax
                channels {
                    id
                    code
                    seller {
                        id
                        name
                    }
                }
            }
        }
    }
`;var $s=t=>["seller-orders",t];function js(t,p){if(t&1&&(a(0,"vdr-labeled-data",5),d(1,"translate"),u(2),l()),t&2){let e=p.ngIf;o("label",s(1,2,"common.seller")),r(2),_(" ",e.name," ")}}function qs(t,p){if(t&1&&(a(0,"vdr-labeled-data",5),d(1,"translate"),u(2),d(3,"localeCurrency"),l()),t&2){let e=m().$implicit;o("label",s(1,2,"order.total")),r(2),_(" ",x(3,4,e.totalWithTax,e.currencyCode)," ")}}function Ws(t,p){if(t&1&&(a(0,"div")(1,"a",3),u(2),g(3,"clr-icon",4),l(),a(4,"vdr-labeled-data",5),d(5,"translate"),g(6,"vdr-order-state-label",6),l(),f(7,js,3,4,"vdr-labeled-data",7)(8,qs,4,7,"vdr-labeled-data",7),l()),t&2){let e=p.$implicit,i=m();r(),o("routerLink",A(8,$s,e.id)),r(),_("",e.code," "),r(2),o("label",s(5,6,"order.state")),r(2),o("state",e.state),r(),o("ngIf",i.getSeller(e)),r(),o("ngIf",i.getSeller(e))}}var To=(()=>{class t{constructor(e,i,n){this.router=e,this.dataService=i,this.channelService=n}ngOnInit(){this.sellerOrders$=this.dataService.query(Oo,{orderId:this.orderId}).mapSingle(({order:e})=>e?.sellerOrders??[])}getSeller(e){return e.channels.find(n=>n.code!==Io.DEFAULT_CHANNEL_CODE)?.seller}navigateToSellerOrder(e){this.router.navigate(["/orders",e.id])}static{this.\u0275fac=function(i){return new(i||t)(P(fi),P(Z),P(wi))}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-seller-orders-card"]],inputs:{orderId:"orderId"},standalone:!1,decls:5,vars:6,consts:[[3,"title"],[1,"form-grid"],[4,"ngFor","ngForOf"],[1,"button-ghost","mb-1",3,"routerLink"],["shape","arrow right"],[3,"label"],[3,"state"],[3,"label",4,"ngIf"]],template:function(i,n){i&1&&(a(0,"vdr-card",0),d(1,"translate"),a(2,"div",1),f(3,Ws,9,10,"div",2),d(4,"async"),l()()),i&2&&(o("title",s(1,2,"order.seller-orders")),r(3),o("ngForOf",s(4,4,n.sellerOrders$)))},dependencies:[B,M,w,Re,dt,X,ye,W,I,k],styles:[`[_nghost-%COMP%]{display:block}
/*# sourceMappingURL=seller-orders-card.component-SJ66SDRB.css.map */`],changeDetection:0})}}return t})();var Gs=t=>({state:t}),Qs=()=>["UpdateOrder","ReadCustomer"];function zs(t,p){if(t&1){let e=S();a(0,"button",10),b("click",function(){h(e);let n=m().ngIf,c=m();return y(c.addManualPayment(n))}),u(1),d(2,"translate"),d(3,"localeCurrency"),l()}if(t&2){let e=m().ngIf,i=m();r(),ie(" ",s(2,2,"order.add-payment-to-order")," (",x(3,4,i.outstandingPaymentAmount(e),e.currencyCode),") ")}}function Xs(t,p){if(t&1){let e=S();a(0,"button",10),b("click",function(){h(e);let n=m(2);return y(n.transitionToState("ArrangingAdditionalPayment"))}),u(1),d(2,"translate"),l()}t&2&&(r(),_(" ",s(2,1,"order.arrange-additional-payment")," "))}function Ys(t,p){if(t&1){let e=S();a(0,"button",11),b("click",function(){h(e);let n=m(2);return y(n.fulfillOrder())}),u(1),d(2,"translate"),l()}if(t&2){let e=m().ngIf,i=m();o("disabled",!i.canAddFulfillment(e)),r(),_(" ",s(2,2,"order.fulfill-order")," ")}}function Js(t,p){if(t&1){let e=S();T(0),a(1,"button",8),b("click",function(){h(e);let n=m(2);return y(n.transitionToModifying())}),g(2,"clr-icon",12),u(3),d(4,"translate"),l(),g(5,"div",7),D()}t&2&&(r(3),_(" ",s(4,1,"order.modify-order")," "))}function Zs(t,p){t&1&&(T(0),u(1),d(2,"translate"),D()),t&2&&(r(),_(" ",s(2,1,"order.refund-and-cancel-order")," "))}function Ks(t,p){t&1&&(u(0),d(1,"translate")),t&2&&_(" ",s(1,1,"order.cancel-order")," ")}function ec(t,p){if(t&1){let e=S();a(0,"button",8),b("click",function(){h(e);let n=m().ngIf,c=m();return y(c.cancelOrRefund(n))}),g(1,"clr-icon",13),f(2,Zs,3,3,"ng-container",14)(3,Ks,2,3,"ng-template",null,0,ee),l()}if(t&2){let e=Y(4),i=m().ngIf,n=m();r(2),o("ngIf",n.orderHasSettledPayments(i))("ngIfElse",e)}}function tc(t,p){if(t&1){let e=S();a(0,"button",8),b("click",function(){let n=h(e).$implicit,c=m(3);return y(c.transitionToState(n))}),g(1,"clr-icon",16),u(2),d(3,"stateI18nToken"),d(4,"translate"),d(5,"translate"),l()}if(t&2){let e=p.$implicit;r(2),_(" ",x(5,5,"order.transition-to-state",A(8,Gs,s(4,3,s(3,1,e))))," ")}}function ic(t,p){if(t&1&&(T(0),g(1,"div",7),f(2,tc,6,10,"button",15),d(3,"async"),D()),t&2){let e=m(2);r(2),o("ngForOf",s(3,1,e.nextStates$))}}function nc(t,p){if(t&1){let e=S();a(0,"vdr-action-bar"),g(1,"vdr-ab-left"),a(2,"vdr-ab-right"),g(3,"vdr-action-bar-items",2),f(4,zs,4,7,"button",3)(5,Xs,3,3,"button",3)(6,Ys,3,4,"button",4),a(7,"vdr-action-bar-dropdown-menu",5),f(8,Js,6,3,"ng-container",1)(9,ec,5,2,"button",6)(10,ic,4,3,"ng-container",1),d(11,"async"),g(12,"div",7),a(13,"button",8),b("click",function(){let n=h(e).ngIf,c=m();return y(c.manuallyTransitionToState(n))}),g(14,"clr-icon",9),u(15),d(16,"translate"),l()()()()}if(t&2){let e,i=p.ngIf,n=m();r(4),o("ngIf",i.type!=="Aggregate"&&(i.state==="ArrangingPayment"||i.state==="ArrangingAdditionalPayment")&&(n.hasUnsettledModifications(i)||0<n.outstandingPaymentAmount(i))),r(),o("ngIf",i.type!=="Aggregate"&&i.active===!1&&i.state!=="ArrangingAdditionalPayment"&&i.state!=="ArrangingPayment"&&0<n.outstandingPaymentAmount(i)),r(),o("ngIf",i.type!=="Aggregate"),r(),o("alwaysShow",!0),r(),o("ngIf",i.type!=="Aggregate"&&i.nextStates.includes("Modifying")),r(),o("ngIf",i.type!=="Aggregate"&&i.nextStates.includes("Cancelled")),r(),o("ngIf",(e=s(11,8,n.nextStates$))==null?null:e.length),r(5),_(" ",s(16,10,"order.manually-transition-to-state")," ")}}function rc(t,p){if(t&1){let e=S();a(0,"button",33),d(1,"translate"),b("click",function(){h(e);let n=m(2);return y(n.openStateDiagram())}),g(2,"clr-icon",34),l()}t&2&&o("title",s(1,1,"order.order-state-diagram"))}function oc(t,p){if(t&1){let e=S();a(0,"button",33),d(1,"translate"),b("click",function(){h(e);let n=m(3);return y(n.setOrderCustomer())}),g(2,"clr-icon",36),l()}t&2&&o("title",s(1,1,"order.assign-order-to-another-customer"))}function ac(t,p){t&1&&f(0,oc,3,3,"button",35),t&2&&o("vdrIfPermissions",Gt(1,Qs))}function lc(t,p){if(t&1&&(a(0,"vdr-labeled-data",37),d(1,"translate"),g(2,"vdr-formatted-address",38),l()),t&2){let e=m().ngIf;o("label",s(1,2,"order.shipping-address")),r(2),o("address",e.shippingAddress)}}function dc(t,p){if(t&1&&(a(0,"vdr-labeled-data",39),d(1,"translate"),g(2,"vdr-formatted-address",38),l()),t&2){let e=m().ngIf;o("label",s(1,2,"order.billing-address")),r(2),o("address",e.billingAddress)}}function pc(t,p){if(t&1){let e=S();a(0,"vdr-order-payment-card",41),b("settlePayment",function(n){h(e);let c=m(3);return y(c.settlePayment(n))})("transitionPaymentState",function(n){h(e);let c=m(3);return y(c.transitionPaymentState(n))})("settleRefund",function(n){h(e);let c=m(3);return y(c.settleRefund(n))}),l()}if(t&2){let e=p.$implicit,i=m(2).ngIf;o("currencyCode",i.currencyCode)("payment",e)}}function sc(t,p){if(t&1&&(a(0,"vdr-card",17),d(1,"translate"),f(2,pc,1,2,"vdr-order-payment-card",40),l()),t&2){let e=m().ngIf;o("title",s(1,2,"order.payments")),r(2),o("ngForOf",e.payments)}}function cc(t,p){if(t&1){let e=S();a(0,"vdr-fulfillment-card",43),b("transitionState",function(n){let c=h(e).$implicit,C=m(3);return y(C.transitionFulfillment(c.id,n))}),l()}if(t&2){let e=p.$implicit,i=m(2).ngIf;o("fulfillment",e)("order",i)}}function mc(t,p){if(t&1&&(a(0,"vdr-card"),f(1,cc,1,2,"vdr-fulfillment-card",42),l()),t&2){let e=m().ngIf;r(),o("ngForOf",e.fulfillments)}}function uc(t,p){if(t&1&&g(0,"vdr-page-entity-info",44),t&2){let e=p.ngIf;o("entity",e)}}function fc(t,p){if(t&1&&g(0,"vdr-seller-orders-card",45),t&2){let e=m().ngIf;o("orderId",e.id)}}function _c(t,p){if(t&1&&(a(0,"tr")(1,"td"),u(2),l(),a(3,"td"),u(4),d(5,"percent"),l(),a(6,"td"),u(7),d(8,"localeCurrency"),l(),a(9,"td"),u(10),d(11,"localeCurrency"),l()()),t&2){let e=p.$implicit,i=m().ngIf;r(2),v(e.description),r(2),v(x(5,4,e.taxRate/100,"0.0-3")),r(3),v(x(8,7,e.taxBase,i.currencyCode)),r(3),v(x(11,10,e.taxTotal,i.currencyCode))}}function gc(t,p){if(t&1){let e=S();a(0,"vdr-card",17),d(1,"translate"),g(2,"vdr-tabbed-custom-fields",46),d(3,"hasPermission"),a(4,"button",47),b("click",function(){h(e);let n=m(2);return y(n.updateCustomFields())}),u(5),d(6,"translate"),l()()}if(t&2){let e,i=m(2);o("title",s(1,6,"common.custom-fields")),r(2),o("customFields",i.customFields)("customFieldsFormGroup",i.detailForm.get("customFields"))("readonly",!s(3,8,"UpdateOrder")),r(2),o("disabled",((e=i.detailForm.get("customFields"))==null?null:e.pristine)||((e=i.detailForm.get("customFields"))==null?null:e.invalid)),r(),_(" ",s(6,10,"common.update")," ")}}function Cc(t,p){if(t&1){let e=S();a(0,"vdr-page-detail-layout")(1,"vdr-page-detail-sidebar")(2,"vdr-card",17),d(3,"translate"),f(4,rc,3,3,"ng-template",18),g(5,"vdr-order-state-label",19),l(),a(6,"vdr-card",17),d(7,"translate"),f(8,ac,1,2,"ng-template",18),g(9,"vdr-customer-label",20),f(10,lc,3,4,"vdr-labeled-data",21)(11,dc,3,4,"vdr-labeled-data",22),l(),f(12,sc,3,4,"vdr-card",23)(13,mc,2,1,"vdr-card",1),a(14,"vdr-card"),f(15,uc,1,1,"vdr-page-entity-info",24),d(16,"async"),l()(),a(17,"vdr-page-block"),f(18,fc,1,1,"vdr-seller-orders-card",25),a(19,"vdr-card",26),g(20,"vdr-order-table",27),l(),a(21,"vdr-card",28),d(22,"translate"),a(23,"table",29)(24,"thead")(25,"tr")(26,"th"),u(27),d(28,"translate"),l(),a(29,"th"),u(30),d(31,"translate"),l(),a(32,"th"),u(33),d(34,"translate"),l(),a(35,"th"),u(36),d(37,"translate"),l()()(),a(38,"tbody"),f(39,_c,12,13,"tr",30),l()()(),f(40,gc,7,12,"vdr-card",23),g(41,"vdr-custom-detail-component-host",31),a(42,"vdr-card",17),d(43,"translate"),a(44,"vdr-order-history",32),d(45,"async"),b("addNote",function(n){h(e);let c=m();return y(c.addNote(n))})("updateNote",function(n){h(e);let c=m();return y(c.updateNote(n))})("deleteNote",function(n){h(e);let c=m();return y(c.deleteNote(n))}),l()()()()}if(t&2){let e=p.ngIf,i=m();r(2),o("title",s(3,26,"order.state")),r(3),o("state",e.state),r(),o("title",s(7,28,"order.customer")),r(3),o("customer",e.customer),r(),o("ngIf",i.getOrderAddressLines(e.shippingAddress).length),r(),o("ngIf",i.getOrderAddressLines(e.billingAddress).length),r(),o("ngIf",e.payments==null?null:e.payments.length),r(),o("ngIf",e.fulfillments==null?null:e.fulfillments.length),r(2),o("ngIf",s(16,30,i.entity$)),r(3),o("ngIf",e.sellerOrders.length),r(),o("paddingX",!1),r(),o("order",e)("orderLineCustomFields",i.orderLineCustomFields),r(),o("title",s(22,32,"order.tax-summary"))("paddingX",!1),r(6),v(s(28,34,"common.description")),r(3),v(s(31,36,"order.tax-rate")),r(3),v(s(34,38,"order.tax-base")),r(3),v(s(37,40,"order.tax-total")),r(3),o("ngForOf",e.taxSummary),r(),o("ngIf",i.customFields.length),r(),o("entity$",i.entity$)("detailForm",i.detailForm),r(),o("title",s(43,42,"order.order-history")),r(2),o("order",e)("history",s(45,44,i.history$))}}var mf=be`
    query OrderDetailQuery($id: ID!) {
        order(id: $id) {
            ...OrderDetail
        }
    }
    ${Kn}
`,uf=be`
    mutation SetOrderCustomer($input: SetOrderCustomerInput!) {
        setOrderCustomer(input: $input) {
            id
            customer {
                id
                firstName
                lastName
                emailAddress
            }
        }
    }
`,Do=(()=>{class t extends Lt{constructor(e,i,n,c,C,F){super(),this.changeDetector=e,this.dataService=i,this.notificationService=n,this.modalService=c,this.orderTransitionService=C,this.formBuilder=F,this.customFields=this.getCustomFieldConfig("Order"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.detailForm=new bt({customFields:this.formBuilder.group(kr(this.customFields))}),this.fetchHistory=new Be,this.defaultStates=["AddingItems","ArrangingPayment","PaymentAuthorized","PaymentSettled","PartiallyShipped","Shipped","PartiallyDelivered","Delivered","Cancelled","Modifying","ArrangingAdditionalPayment"]}ngOnInit(){this.init(),this.entity$.pipe(Oe(1)).subscribe(e=>{e.state==="Modifying"&&this.router.navigate(["./","modify"],{relativeTo:this.route})}),this.history$=this.fetchHistory.pipe(ri(null),L(()=>this.dataService.order.getOrderHistory(this.id,{sort:{createdAt:vt.DESC}}).mapStream(e=>e.order?.history.items))),this.nextStates$=this.entity$.pipe(_e(e=>!this.defaultStates.includes(e.state)?e.nextStates:e.nextStates.filter(n=>!this.defaultStates.includes(n))))}ngOnDestroy(){this.destroy()}openStateDiagram(){this.entity$.pipe(Oe(1),L(e=>this.modalService.fromComponent(lo,{closable:!0,locals:{activeState:e.state}}))).subscribe()}setOrderCustomer(){this.modalService.fromComponent(Qi,{locals:{canCreateNew:!1,includeNoteInput:!0,title:"order.assign-order-to-another-customer"}}).pipe(L(e=>{function i(n){return typeof n=="object"&&!!n.id}return i(e)?this.dataService.mutate(Jn,{input:{customerId:e.id,orderId:this.id,note:e.note}}):Fe}),L(e=>this.refetchOrder(e))).subscribe(e=>{e&&this.notificationService.success("order.set-customer-success")})}transitionToState(e){this.dataService.order.transitionToState(this.id,e).subscribe(({transitionOrderToState:i})=>{switch(i?.__typename){case"Order":this.notificationService.success("order.transitioned-to-state-success",{state:e}),this.fetchHistory.next();break;case"OrderStateTransitionError":this.notificationService.error(i.transitionError)}})}manuallyTransitionToState(e){this.orderTransitionService.manuallyTransitionToState({orderId:e.id,nextStates:e.nextStates,cancellable:!0,message:"order.manually-transition-to-state-message",retry:0}).subscribe()}transitionToModifying(){this.dataService.order.transitionToState(this.id,"Modifying").subscribe(({transitionOrderToState:e})=>{switch(e?.__typename){case"Order":this.router.navigate(["./modify"],{relativeTo:this.route});break;case"OrderStateTransitionError":this.notificationService.error(e.transitionError)}})}updateCustomFields(){this.dataService.order.updateOrderCustomFields({id:this.id,customFields:this.detailForm.value.customFields}).subscribe(()=>{this.notificationService.success("common.notify-update-success",{entity:"Order"})})}getOrderAddressLines(e){return e?Object.values(e).filter(i=>i!=="OrderAddress").filter(i=>!!i):[]}settlePayment(e){this.dataService.order.settlePayment(e.id).subscribe(({settlePayment:i})=>{switch(i.__typename){case"Payment":i.state==="Settled"?this.notificationService.success("order.settle-payment-success"):this.notificationService.error("order.settle-payment-error"),this.dataService.order.getOrder(this.id).single$.subscribe(),this.fetchHistory.next();break;case"OrderStateTransitionError":case"PaymentStateTransitionError":case"SettlePaymentError":this.notificationService.error(i.message)}})}transitionPaymentState({payment:e,state:i}){i==="Cancelled"?this.dataService.order.cancelPayment(e.id).subscribe(({cancelPayment:n})=>{switch(n.__typename){case"Payment":this.notificationService.success("order.transitioned-payment-to-state-success",{state:i}),this.dataService.order.getOrder(this.id).single$.subscribe(),this.fetchHistory.next();break;case"PaymentStateTransitionError":this.notificationService.error(n.transitionError);break;case"CancelPaymentError":this.notificationService.error(n.paymentErrorMessage);break}}):this.dataService.order.transitionPaymentToState(e.id,i).subscribe(({transitionPaymentToState:n})=>{switch(n.__typename){case"Payment":this.notificationService.success("order.transitioned-payment-to-state-success",{state:i}),this.dataService.order.getOrder(this.id).single$.subscribe(),this.fetchHistory.next();break;case"PaymentStateTransitionError":this.notificationService.error(n.message);break}})}canAddFulfillment(e){let i=(e.fulfillments??[]).filter(c=>c.state!=="Cancelled").reduce((c,C)=>[...c,...C.lines],[]),n=!0;for(let c of e.lines)i.filter(F=>F.orderLineId===c.id).reduce((F,Ht)=>F+Ht.quantity,0)<c.quantity&&(n=!1);return!n&&!this.hasUnsettledModifications(e)&&this.outstandingPaymentAmount(e)===0&&(e.nextStates.includes("Shipped")||e.nextStates.includes("PartiallyShipped")||e.nextStates.includes("Delivered"))}hasUnsettledModifications(e){return 0<e.modifications.filter(i=>!i.isSettled).length}getOutstandingModificationAmount(e){return(0,Wt.summate)(e.modifications.filter(i=>!i.isSettled),"priceChange")}outstandingPaymentAmount(e){let i=c=>c.state!=="Cancelled"&&c.state!=="Declined"&&c.state!=="Error",n=0;for(let c of e.payments?.filter(i)??[]){let C=c.refunds.filter(Ht=>Ht.state!=="Failed")??[],F=(0,Wt.summate)(C,"total");n+=c.amount-F}return e.totalWithTax-n}addManualPayment(e){let i=e.state;this.modalService.fromComponent(Ar,{closable:!0,locals:{outstandingAmount:this.outstandingPaymentAmount(e),currencyCode:e.currencyCode}}).pipe(L(n=>n?this.dataService.order.addManualPaymentToOrder({orderId:this.id,transactionId:n.transactionId,method:n.method,metadata:n.metadata||{}}):Fe),L(({addManualPaymentToOrder:n})=>{switch(n.__typename){case"Order":return this.notificationService.success("order.add-payment-to-order-success"),i==="ArrangingAdditionalPayment"?this.orderTransitionService.transitionToPreModifyingState(e.id,e.nextStates):ce("PaymentSettled");case"ManualPaymentStateError":return this.notificationService.error(n.message),Fe;default:return Fe}})).subscribe(n=>{n&&this.refetchOrder({result:n})})}fulfillOrder(){this.entity$.pipe(Oe(1),L(e=>this.modalService.fromComponent(Zr,{size:"xl",locals:{order:e}})),L(e=>e?this.dataService.order.createFulfillment(e):ce(void 0)),L(e=>this.refetchOrder(e).pipe(ii(e)))).subscribe(e=>{if(e){let{addFulfillmentToOrder:i}=e;switch(i.__typename){case"Fulfillment":this.notificationService.success("order.create-fulfillment-success");break;case"EmptyOrderLineSelectionError":case"InsufficientStockOnHandError":case"ItemsAlreadyFulfilledError":case"InvalidFulfillmentHandlerError":this.notificationService.error(i.message);break;case"FulfillmentStateTransitionError":this.notificationService.error(i.transitionError);break;case"CreateFulfillmentError":this.notificationService.error(i.fulfillmentHandlerError);break;case void 0:this.notificationService.error(JSON.stringify(i));break;default:(0,Wt.assertNever)(i)}}})}transitionFulfillment(e,i){this.dataService.order.transitionFulfillmentToState(e,i).pipe(L(n=>this.refetchOrder(n))).subscribe(()=>{this.notificationService.success("order.successfully-updated-fulfillment")})}cancelOrRefund(e){let i=this.orderHasSettledPayments(e);e.state==="PaymentAuthorized"||e.active===!0||!i?this.cancelOrder(e):this.refundOrder(e)}settleRefund(e){this.modalService.fromComponent(fo,{size:"md",locals:{refund:e}}).pipe(L(i=>i?this.dataService.order.settleRefund({transactionId:i,id:e.id},this.id):ce(void 0))).subscribe(i=>{i&&this.notificationService.success("order.settle-refund-success")})}addNote(e){let{note:i,isPublic:n}=e;this.dataService.order.addNoteToOrder({id:this.id,note:i,isPublic:n}).pipe(L(c=>this.refetchOrder(c))).subscribe(c=>{this.notificationService.success("common.notify-create-success",{entity:"Note"})})}updateNote(e){this.modalService.fromComponent(wr,{closable:!0,locals:{displayPrivacyControls:!0,note:e.data.note,noteIsPrivate:!e.isPublic}}).pipe(L(i=>i?this.dataService.order.updateOrderNote({noteId:e.id,isPublic:!i.isPrivate,note:i.note}):Fe)).subscribe(i=>{this.fetchHistory.next(),this.notificationService.success("common.notify-update-success",{entity:"Note"})})}deleteNote(e){return this.modalService.dialog({title:"common.confirm-delete-note",body:e.data.note,buttons:[{type:"secondary",label:"common.cancel"},{type:"danger",label:"common.delete",returnValue:!0}]}).pipe(L(i=>i?this.dataService.order.deleteOrderNote(e.id):Fe)).subscribe(()=>{this.fetchHistory.next(),this.notificationService.success("common.notify-delete-success",{entity:"Note"})})}orderHasSettledPayments(e){return!!e.payments?.find(i=>i.state==="Settled")}cancelOrder(e){this.modalService.fromComponent(Vr,{size:"xl",locals:{order:e}}).pipe(L(i=>i?this.dataService.order.cancelOrder(i):ce(void 0)),L(i=>this.refetchOrder(i))).subscribe(i=>{i&&this.notificationService.success("order.cancelled-order-success")})}refundOrder(e){this.modalService.fromComponent(uo,{size:"xl",locals:{order:e}}).pipe(L(i=>i?i.cancel.lines?.length?this.dataService.order.cancelOrder(i.cancel).pipe(_e(n=>{let c=n.cancelOrder;switch(c.__typename){case"Order":return this.refetchOrder(c).subscribe(),this.notificationService.success("order.cancelled-order-items-success",{count:(0,Wt.summate)(i.cancel.lines,"quantity")}),i;case"CancelActiveOrderError":case"QuantityTooGreatError":case"MultipleOrderError":case"OrderStateTransitionError":case"EmptyOrderLineSelectionError":this.notificationService.error(c.message);return}})):[i]:ce(void 0)),L(i=>i?i.refunds.length?ei(i.refunds.map(n=>this.dataService.order.refundOrder(n).pipe(_e(c=>c.refundOrder)))):[void 0]:ce(void 0))).subscribe(i=>{for(let n of i??[])if(n)switch(n.__typename){case"Refund":n.state==="Failed"?this.notificationService.error("order.refund-order-failed"):this.notificationService.success("order.refund-order-success");break;case"AlreadyRefundedError":case"NothingToRefundError":case"PaymentOrderMismatchError":case"RefundOrderStateError":case"RefundStateTransitionError":this.notificationService.error(n.message);break}this.refetchOrder(i?.[0]).subscribe()})}refetchOrder(e){return this.fetchHistory.next(),e?this.dataService.order.getOrder(this.id).single$:ce(void 0)}setFormValues(e){this.customFields.length&&this.setCustomFieldFormValues(this.customFields,this.detailForm.get(["customFields"]),e)}static{this.\u0275fac=function(i){return new(i||t)(P(Ve),P(Z),P(it),P(je),P(Vt),P(lr))}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-order-detail"]],standalone:!1,features:[Ie],decls:5,vars:6,consts:[["cancelOnly",""],[4,"ngIf"],["locationId","order-detail"],["class","button primary mr-1",3,"click",4,"ngIf"],["class","button primary mr-1",3,"disabled","click",4,"ngIf"],["locationId","order-detail",3,"alwaysShow"],["type","button","vdrDropdownItem","",3,"click",4,"ngIf"],[1,"dropdown-divider"],["type","button","vdrDropdownItem","",3,"click"],["shape","step-forward-2",1,"is-warning"],[1,"button","primary","mr-1",3,"click"],[1,"button","primary","mr-1",3,"click","disabled"],["shape","pencil"],["shape","error-standard",1,"is-error"],[4,"ngIf","ngIfElse"],["type","button","vdrDropdownItem","",3,"click",4,"ngFor","ngForOf"],["shape","step-forward-2"],[3,"title"],["vdrCardControls",""],[3,"state"],[3,"customer"],["class","mt-2",3,"label",4,"ngIf"],[3,"label",4,"ngIf"],[3,"title",4,"ngIf"],[3,"entity",4,"ngIf"],["class","mb-2",3,"orderId",4,"ngIf"],[3,"paddingX"],[3,"order","orderLineCustomFields"],[3,"title","paddingX"],[1,"table"],[4,"ngFor","ngForOf"],["locationId","order-detail",3,"entity$","detailForm"],[3,"addNote","updateNote","deleteNote","order","history"],[1,"button-small",3,"click","title"],["shape","list"],["class","button-small",3,"title","click",4,"vdrIfPermissions"],["shape","switch"],[1,"mt-2",3,"label"],[1,"mt-1",3,"address"],[3,"label"],[3,"currencyCode","payment","settlePayment","transitionPaymentState","settleRefund",4,"ngFor","ngForOf"],[3,"settlePayment","transitionPaymentState","settleRefund","currencyCode","payment"],[3,"fulfillment","order","transitionState",4,"ngFor","ngForOf"],[3,"transitionState","fulfillment","order"],[3,"entity"],[1,"mb-2",3,"orderId"],["entityName","Order",3,"customFields","customFieldsFormGroup","readonly"],[1,"button","primary",3,"click","disabled"]],template:function(i,n){i&1&&(a(0,"vdr-page-block"),f(1,nc,17,12,"vdr-action-bar",1),d(2,"async"),l(),f(3,Cc,46,46,"vdr-page-detail-layout",1),d(4,"async")),i&2&&(r(),o("ngIf",s(2,2,n.entity$)),r(2),o("ngIf",s(4,4,n.entity$)))},dependencies:[B,M,w,at,Ft,ot,kt,Et,qe,dt,Ge,X,Bi,Mt,nt,Li,pt,Fi,wt,Pt,ye,rt,vo,So,no,$t,To,W,ci,I,Ei,fe,k],styles:[`.shipping-address[_ngcontent-%COMP%]{list-style-type:none;line-height:1.3em}.order-cards[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin-top:6px;color:var(--color-text-200)}vdr-order-payment-card[_ngcontent-%COMP%] + vdr-order-payment-card[_ngcontent-%COMP%]{margin-top:calc(var(--space-unit) * 2)}
/*# sourceMappingURL=order-detail.component-ZBHDQDBB.css.map */`],changeDetection:0})}}return t})();var ln=Ee(mt()),Mo=Ee(Lo());var on=Ee(mt());var On=t=>({count:t});function vc(t,p){if(t&1&&(a(0,"div",4),u(1),l()),t&2){let e=p.$implicit;r(),_(" ",e," ")}}function hc(t,p){if(t&1&&(a(0,"vdr-labeled-data",2),d(1,"translate"),f(2,vc,2,1,"div",3),l()),t&2){let e=m();o("label",x(1,2,"order.modification-adjusting-lines",A(5,On,e.modifyOrderInput.adjustOrderLines==null?null:e.modifyOrderInput.adjustOrderLines.length))),r(2),o("ngForOf",e.adjustedLines)}}function yc(t,p){if(t&1&&(a(0,"div"),u(1),l()),t&2){let e=p.$implicit;r(),ie(" ",e.productVariant.name," x ",e.quantity," ")}}function xc(t,p){if(t&1&&(a(0,"vdr-labeled-data",2),d(1,"translate"),f(2,yc,2,2,"div",5),l()),t&2){let e=m();o("label",x(1,2,"order.modification-adding-items",A(5,On,e.modifyOrderInput.addItems==null?null:e.modifyOrderInput.addItems.length))),r(2),o("ngForOf",e.addedLines)}}function bc(t,p){if(t&1&&(a(0,"div",4),u(1),d(2,"localeCurrency"),l()),t&2){let e=p.$implicit,i=m(2);r(),ie(" ",e.description,": ",x(2,2,e.price,i.orderSnapshot.currencyCode)," ")}}function Sc(t,p){if(t&1&&(a(0,"vdr-labeled-data",2),d(1,"translate"),f(2,bc,3,5,"div",3),l()),t&2){let e=m();o("label",x(1,2,"order.modification-adding-surcharges",A(5,On,e.modifyOrderInput.surcharges==null?null:e.modifyOrderInput.surcharges.length))),r(2),o("ngForOf",e.modifyOrderInput.surcharges)}}function Oc(t,p){if(t&1&&(a(0,"vdr-labeled-data",2),d(1,"translate"),u(2),l()),t&2){let e=p.ngIf;o("label",s(1,2,"order.modification-updating-shipping-address")),r(2),_(" ",e,`
`)}}function Ic(t,p){if(t&1&&(a(0,"vdr-labeled-data",2),d(1,"translate"),u(2),l()),t&2){let e=p.ngIf;o("label",s(1,2,"order.modification-updating-billing-address")),r(2),_(" ",e,`
`)}}function Tc(t,p){if(t&1&&(a(0,"div",4),u(1),l()),t&2){let e=p.$implicit;r(),v(e)}}function Dc(t,p){if(t&1&&(a(0,"vdr-labeled-data",2),d(1,"translate"),f(2,Tc,2,1,"div",3),l()),t&2){let e=m();o("label",s(1,2,"order.set-coupon-codes")),r(2),o("ngForOf",e.couponCodeChanges)}}function wc(t,p){if(t&1&&(a(0,"div",4),u(1),l()),t&2){let e=p.$implicit;r(),v(e)}}function Pc(t,p){if(t&1&&(a(0,"vdr-labeled-data",2),d(1,"translate"),f(2,wc,2,1,"div",3),l()),t&2){let e=m().ngIf;o("label",s(1,2,"order.shipping-method")),r(2),o("ngForOf",e)}}function Mc(t,p){if(t&1&&(T(0),f(1,Pc,3,4,"vdr-labeled-data",0),D()),t&2){let e=p.ngIf;r(),o("ngIf",e.length)}}var an=(()=>{class t{get adjustedLines(){return(this.modifyOrderInput.adjustOrderLines||[]).map(e=>{let i=this.orderSnapshot.lines.find(n=>n.id===e.orderLineId);if(i){let n=e.quantity-i.quantity,c=n===0?"":n>0?"+":"-";return n?`${c}${Math.abs(n)} ${i.productVariant.name}`:i.productVariant.name}}).filter(on.notNullOrUndefined)}getModifiedFields(e){return e.dirty?Object.entries(e.controls).map(([i,n])=>{if(n.dirty)return i}).filter(on.notNullOrUndefined).join(", "):""}getUpdatedShippingMethodLines(){return Object.entries(this.updatedShippingMethods||{}).map(([e,i])=>{let n=this.orderSnapshot.shippingLines.find(F=>F.id===e);if(!n)return;let c=n.shippingMethod.name||n.shippingMethod.code,C=i.name||i.code;return`${c} -> ${C}`}).filter(on.notNullOrUndefined)}get couponCodeChanges(){let e=this.orderSnapshot.couponCodes||[],i=this.couponCodesControl.value||[],n=i.filter(C=>!e.includes(C)).map(C=>`+ ${C}`),c=e.filter(C=>!i.includes(C)).map(C=>`- ${C}`);return[...n,...c]}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-order-modification-summary"]],inputs:{orderSnapshot:"orderSnapshot",modifyOrderInput:"modifyOrderInput",addedLines:"addedLines",shippingAddressForm:"shippingAddressForm",billingAddressForm:"billingAddressForm",updatedShippingMethods:"updatedShippingMethods",couponCodesControl:"couponCodesControl"},standalone:!1,decls:7,vars:7,consts:[[3,"label",4,"ngIf"],[4,"ngIf"],[3,"label"],["class","mb-1",4,"ngFor","ngForOf"],[1,"mb-1"],[4,"ngFor","ngForOf"]],template:function(i,n){i&1&&f(0,hc,3,7,"vdr-labeled-data",0)(1,xc,3,7,"vdr-labeled-data",0)(2,Sc,3,7,"vdr-labeled-data",0)(3,Oc,3,4,"vdr-labeled-data",0)(4,Ic,3,4,"vdr-labeled-data",0)(5,Dc,3,4,"vdr-labeled-data",0)(6,Mc,2,1,"ng-container",1),i&2&&(o("ngIf",n.modifyOrderInput.adjustOrderLines==null?null:n.modifyOrderInput.adjustOrderLines.length),r(),o("ngIf",n.modifyOrderInput.addItems==null?null:n.modifyOrderInput.addItems.length),r(),o("ngIf",n.modifyOrderInput.surcharges==null?null:n.modifyOrderInput.surcharges.length),r(),o("ngIf",n.getModifiedFields(n.shippingAddressForm)),r(),o("ngIf",n.getModifiedFields(n.billingAddressForm)),r(),o("ngIf",n.couponCodeChanges.length),r(),o("ngIf",n.getUpdatedShippingMethodLines()))},dependencies:[M,w,X,I,k],encapsulation:2,changeDetection:0})}}return t})();function Fc(t,p){t&1&&(u(0),d(1,"translate")),t&2&&v(s(1,1,"order.confirm-modifications"))}function Ec(t,p){if(t&1){let e=S();a(0,"vdr-payment-for-refund-selector",10),b("paymentSelected",function(n){h(e);let c=m();return y(c.onPaymentSelected(n.payment,n.selected))}),l()}if(t&2){let e=m();o("refundablePayments",e.refundablePayments)("order",e.order)}}function Bc(t,p){if(t&1){let e=S();a(0,"vdr-form-field",7),d(1,"translate"),a(2,"textarea",11),$("ngModelChange",function(n){h(e);let c=m();return N(c.refundNote,n)||(c.refundNote=n),y(n)}),l()()}if(t&2){let e=m();o("label",s(1,2,"order.refund-cancellation-reason")),r(2),R("ngModel",e.refundNote)}}function kc(t,p){t&1&&(a(0,"clr-alert",18)(1,"clr-alert-item"),u(2),d(3,"translate"),l()()),t&2&&(o("clrAlertType","danger")("clrAlertClosable",!1),r(2),_(" ",s(3,3,"order.refund-total-warning")," "))}function Lc(t,p){if(t&1){let e=S();a(0,"div")(1,"div",12),f(2,kc,4,5,"clr-alert",13),l(),a(3,"div",14)(4,"clr-alert",15)(5,"clr-alert-item"),u(6),d(7,"translate"),d(8,"localeCurrency"),l()(),a(9,"button",16),b("click",function(){h(e);let n=m();return y(n.cancel())}),u(10),d(11,"translate"),l(),a(12,"button",17),b("click",function(){h(e);let n=m();return y(n.submit())}),u(13),d(14,"translate"),l()()()}if(t&2){let e=m();r(2),o("ngIf",e.priceDifference<0&&!e.refundsCoverDifference()),r(2),o("clrAlertType","primary")("clrAlertClosable",!1),r(2),di(" ",s(7,9,"order.modify-order-price-difference")," ",0<e.priceDifference?"+":"","",x(8,11,e.priceDifference,e.order.currencyCode)," "),r(4),_(" ",s(11,14,"common.cancel")," "),r(2),o("disabled",e.priceDifference<0?!e.refundsCoverDifference():!1),r(),_(" ",s(14,16,"common.confirm")," ")}}var st=function(t){return t[t.Refund=0]="Refund",t[t.Payment=1]="Payment",t[t.PriceUnchanged=2]="PriceUnchanged",t[t.Cancel=3]="Cancel",t}(st||{}),Po=(()=>{class t{get priceDifference(){return this.order.totalWithTax-this.orderSnapshot.totalWithTax}get amountToRefundTotal(){return this.refundablePayments.reduce((e,i)=>e+i.amountToRefundControl.value,0)}ngOnInit(){this.refundNote=this.modifyOrderInput.note||"",this.refundablePayments=Wi(this.order.payments||[]),this.refundablePayments.forEach(e=>{e.amountToRefundControl.addValidators(re.max(this.priceDifference*-1))}),this.priceDifference<0&&this.refundablePayments.length&&this.onPaymentSelected(this.refundablePayments[0],!0)}onPaymentSelected(e,i){if(i){let n=this.priceDifference*-1-this.refundablePayments.filter(c=>c.id!==e.id).reduce((c,C)=>c+C.amountToRefundControl.value,0);0<n&&e.amountToRefundControl.setValue(Math.min(n,e.refundableAmount))}else e.amountToRefundControl.setValue(0)}refundsCoverDifference(){return this.priceDifference*-1===this.amountToRefundTotal}cancel(){this.resolveWith({result:st.Cancel})}submit(){0<this.priceDifference?this.resolveWith({result:st.Payment}):this.priceDifference<0?this.resolveWith({result:st.Refund,refunds:this.refundablePayments.filter(e=>e.selected&&0<e.amountToRefundControl.value).map(e=>({reason:this.refundNote||this.modifyOrderInput.note,paymentId:e.id,amount:e.amountToRefundControl.value}))}):this.resolveWith({result:st.PriceUnchanged})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-order-edits-preview-dialog"]],standalone:!1,decls:14,vars:18,consts:[["vdrDialogTitle",""],[1,"order-edits-preview-table",3,"order","orderLineCustomFields"],[1,"payments-wrapper","mb-2"],[1,"flex-spacer"],["class","",3,"refundablePayments","order","paymentSelected",4,"ngIf"],[3,"title"],[3,"orderSnapshot","modifyOrderInput","addedLines","shippingAddressForm","billingAddressForm","couponCodesControl","updatedShippingMethods"],[3,"label"],[3,"label",4,"ngIf"],["vdrDialogButtons",""],[1,"",3,"paymentSelected","refundablePayments","order"],["name","refundNote","required","",3,"ngModelChange","ngModel"],[1,"errors"],["class","mb-1",3,"clrAlertType","clrAlertClosable",4,"ngIf"],[1,"modal-buttons"],[1,"",3,"clrAlertType","clrAlertClosable"],["type","button",1,"btn",3,"click"],["type","submit",1,"btn","btn-primary",3,"click","disabled"],[1,"mb-1",3,"clrAlertType","clrAlertClosable"]],template:function(i,n){i&1&&(f(0,Fc,2,3,"ng-template",0),g(1,"vdr-order-table",1),a(2,"div",2)(3,"div",3),f(4,Ec,1,2,"vdr-payment-for-refund-selector",4),l(),a(5,"div",3)(6,"vdr-card",5),d(7,"translate"),g(8,"vdr-order-modification-summary",6),a(9,"vdr-labeled-data",7),d(10,"translate"),u(11),l(),f(12,Bc,3,4,"vdr-form-field",8),l()()(),f(13,Lc,15,18,"ng-template",9)),i&2&&(r(),o("order",n.order)("orderLineCustomFields",n.orderLineCustomFields),r(3),o("ngIf",n.priceDifference<0),r(2),o("title",s(7,14,"order.modify-order")),r(2),o("orderSnapshot",n.orderSnapshot)("modifyOrderInput",n.modifyOrderInput)("addedLines",n.addedLines)("shippingAddressForm",n.shippingAddressForm)("billingAddressForm",n.billingAddressForm)("couponCodesControl",n.couponCodesControl)("updatedShippingMethods",n.updatedShippingMethods),r(),o("label",s(10,16,"order.note")),r(2),_(" ",n.modifyOrderInput.note||"-"," "),r(),o("ngIf",n.priceDifference<0))},dependencies:[Ii,Ti,w,ne,z,gi,oe,ve,U,ae,te,X,ye,$t,nn,an,I,k],styles:[`.order-edits-preview-table .table-wrapper{max-width:initial!important}.payments-wrapper[_ngcontent-%COMP%]{display:flex;gap:calc(var(--space-unit) * 2)}.modal-buttons[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.6rem;gap:var(--clr-modal-footer-gap, .6rem)}
/*# sourceMappingURL=order-edits-preview-dialog.component-AY3UNAFV.css.map */`],changeDetection:0})}}return t})();var Ac=t=>({rate:t});function Vc(t,p){if(t&1){let e=S();a(0,"vdr-action-bar")(1,"vdr-ab-left"),g(2,"div",2),l(),a(3,"vdr-ab-right")(4,"button",3),b("click",function(){let n=h(e).ngIf,c=m();return y(c.transitionToPriorState(n))}),u(5),d(6,"translate"),l()()()}t&2&&(r(5),_(" ",s(6,1,"order.cancel-modification")," "))}function Rc(t,p){t&1&&(a(0,"div",51),u(1),d(2,"translate"),l()),t&2&&(r(),_(" ",s(2,1,"order.no-modifications-made")," "))}function Nc(t,p){if(t&1){let e=S();a(0,"button",52),d(1,"translate"),b("click",function(){h(e);let n=m(2);return y(n.editingShippingAddress=!n.editingShippingAddress)}),g(2,"clr-icon",53),l()}t&2&&o("title",s(1,1,"order.edit-shipping-address"))}function $c(t,p){if(t&1&&g(0,"vdr-formatted-address",54),t&2){let e=m(2);o("address",e.shippingAddressForm.value)}}function jc(t,p){if(t&1&&(g(0,"vdr-address-form",55),d(1,"async")),t&2){let e=m(2);o("formGroup",e.shippingAddressForm)("availableCountries",s(1,3,e.availableCountries$))("customFields",e.addressCustomFields)}}function qc(t,p){if(t&1){let e=S();a(0,"button",52),d(1,"translate"),b("click",function(){h(e);let n=m(2);return y(n.editingBillingAddress=!n.editingBillingAddress)}),g(2,"clr-icon",53),l()}t&2&&o("title",s(1,1,"order.edit-billing-address"))}function Wc(t,p){if(t&1&&g(0,"vdr-formatted-address",54),t&2){let e=m(2);o("address",e.billingAddressForm.value)}}function Hc(t,p){if(t&1&&(g(0,"vdr-address-form",55),d(1,"async")),t&2){let e=m(2);o("formGroup",e.billingAddressForm)("availableCountries",s(1,3,e.availableCountries$))("customFields",e.addressCustomFields)}}function Uc(t,p){if(t&1&&u(0),t&2){let e=p.item;_(" ",e.id," ")}}function Gc(t,p){if(t&1&&(u(0),d(1,"localeDate")),t&2){let e=p.item;_(" ",x(1,1,e.createdAt,"short")," ")}}function Qc(t,p){if(t&1&&(u(0),d(1,"localeDate")),t&2){let e=p.item;_(" ",x(1,1,e.updatedAt,"short")," ")}}function zc(t,p){if(t&1&&(g(0,"img",58),d(1,"assetPreview")),t&2){let e=p.ngIf;o("src",x(1,1,e,"tiny"),xe)}}function Xc(t,p){t&1&&(a(0,"div",59),g(1,"clr-icon",60),l())}function Yc(t,p){if(t&1&&(a(0,"div",56),f(1,zc,2,4,"img",57)(2,Xc,2,0,"ng-template",null,0,ee),l()),t&2){let e=p.item,i=Y(3);r(),o("ngIf",e.featuredAsset)("ngIfElse",i)}}function Jc(t,p){if(t&1&&u(0),t&2){let e=p.item;_(" ",e.productVariant.name," ")}}function Zc(t,p){if(t&1&&u(0),t&2){let e=p.item;_(" ",e.productVariant.sku," ")}}function Kc(t,p){if(t&1&&(a(0,"div",61)(1,"div"),u(2),d(3,"localeCurrency"),l(),a(4,"div",62),d(5,"translate"),u(6),d(7,"localeCurrency"),l()()),t&2){let e=p.item,i=m().ngIf;r(2),v(x(3,3,e.unitPriceWithTax,i.currencyCode)),r(2),o("title",s(5,6,"order.net-price")),r(2),_(" ",x(7,8,e.unitPrice,i.currencyCode)," ")}}function em(t,p){if(t&1){let e=S();a(0,"button",67),b("click",function(){h(e);let n=m().item,c=m(2);return y(c.removeAddedItem(n.id))}),g(1,"clr-icon",68),l()}}function tm(t,p){if(t&1){let e=S();a(0,"input",63),b("input",function(n){let c=h(e).item,C=m(2);return y(C.updateLineQuantity(c,n.target.value))}),l(),f(1,em,2,0,"button",64),g(2,"vdr-line-refunds",65)(3,"vdr-line-fulfillment",66)}if(t&2){let e=p.item,i=m().ngIf,n=m();o("value",n.getInitialLineQuantity(e.id)),r(),o("ngIf",n.isAddedLine(e)),r(),o("line",e)("payments",i.payments),r(),o("line",e)("allOrderFulfillments",i.fulfillments)("orderState",i.state)}}function im(t,p){if(t&1&&g(0,"vdr-custom-field-control",70),t&2){let e=p.index,i=m().$implicit,n=m(2);o("compact",!0)("entityName","OrderLine")("customField",i)("customFieldsFormGroup",n.orderLineCustomFieldsFormArray.at(e))}}function nm(t,p){if(t&1&&(a(0,"vdr-dt2-column",69),d(1,"async"),d(2,"customFieldLabel"),f(3,im,1,4,"ng-template"),l()),t&2){let e=p.$implicit,i=m(2);o("id",e.name)("heading",x(2,5,e,s(1,3,i.uiLanguage$)))("hiddenByDefault",!0)}}function rm(t,p){if(t&1&&(g(0,"img",74),d(1,"assetPreview")),t&2){let e=p.ngIf;o("src",x(1,1,e,"tiny"),xe)}}function om(t,p){if(t&1&&(a(0,"div",71),f(1,rm,2,4,"img",72),a(2,"div")(3,"strong",73),u(4),l(),a(5,"small"),u(6),l(),a(7,"div"),u(8),d(9,"localeCurrency"),l()()()),t&2){let e=m().ngIf,i=m();r(),o("ngIf",i.addItemSelectedVariant.productAsset),r(3),v(i.addItemSelectedVariant.productVariantName),r(2),v(i.addItemSelectedVariant.sku),r(2),_(" ",x(9,4,i.getSelectedItemPrice(i.addItemSelectedVariant),e.currencyCode)," ")}}function am(t,p){if(t&1&&(a(0,"div"),g(1,"vdr-tabbed-custom-fields",75),l()),t&2){let e=m(2);r(),o("customFields",e.orderLineCustomFields)("customFieldsFormGroup",e.addItemCustomFieldsForm)}}function lm(t,p){if(t&1){let e=S();a(0,"button",76),b("click",function(){h(e);let n=m(2);return y(n.addItemToOrder(n.addItemSelectedVariant))}),u(1),d(2,"translate"),l()}if(t&2){let e=m(2);o("disabled",!e.addItemSelectedVariant||e.addItemCustomFieldsForm.invalid),r(),_(" ",s(2,2,"order.add-item-to-order")," ")}}function dm(t,p){if(t&1){let e=S();T(0),a(1,"div"),u(2),l(),a(3,"div",77),u(4),d(5,"localeCurrency"),l(),a(6,"button",67),b("click",function(){h(e);let n=m().$implicit,c=m(2);return y(c.setShippingMethod(n.id))}),u(7),d(8,"translate"),l(),D()}if(t&2){let e=p.ngIf,i=m(2).ngIf;r(2),_("",e.name,":"),r(2),_(" ",x(5,3,e.price,i.currencyCode)," "),r(3),_(" ",s(8,6,"order.set-shipping-method")," ")}}function pm(t,p){if(t&1&&(a(0,"div",10),f(1,dm,9,8,"ng-container",1),l()),t&2){let e=p.$implicit,i=m(2);r(),o("ngIf",i.getShippingLineDetails(e))}}function sm(t,p){if(t&1){let e=S();a(0,"vdr-page-detail-layout")(1,"vdr-page-detail-sidebar")(2,"vdr-card",4),d(3,"translate"),g(4,"vdr-order-modification-summary",5),f(5,Rc,3,3,"div",6),a(6,"div",7)(7,"vdr-form-field",8),d(8,"translate"),a(9,"textarea",9),$("ngModelChange",function(n){h(e);let c=m();return N(c.note,n)||(c.note=n),y(n)}),l()(),a(10,"label",10)(11,"input",11),$("ngModelChange",function(n){h(e);let c=m();return N(c.recalculateShipping,n)||(c.recalculateShipping=n),y(n)}),l(),a(12,"div",12),u(13),d(14,"translate"),l()(),a(15,"button",13),b("click",function(){let n=h(e).ngIf,c=m();return y(c.previewAndModify(n))}),u(16),d(17,"translate"),l()()(),a(18,"vdr-card",4),d(19,"translate"),g(20,"vdr-coupon-code-selector",14),l(),a(21,"vdr-card",4),d(22,"translate"),f(23,Nc,3,3,"ng-template",15)(24,$c,1,1,"vdr-formatted-address",16)(25,jc,2,5,"vdr-address-form",17),l(),a(26,"vdr-card",4),d(27,"translate"),f(28,qc,3,3,"ng-template",15)(29,Wc,1,1,"vdr-formatted-address",16)(30,Hc,2,5,"vdr-address-form",17),l()(),a(31,"vdr-page-block")(32,"vdr-card",18)(33,"vdr-data-table-2",19)(34,"vdr-dt2-column",20),d(35,"translate"),f(36,Uc,1,1,"ng-template"),l(),a(37,"vdr-dt2-column",21),d(38,"translate"),f(39,Gc,2,4,"ng-template"),l(),a(40,"vdr-dt2-column",22),d(41,"translate"),f(42,Qc,2,4,"ng-template"),l(),a(43,"vdr-dt2-column",23),d(44,"translate"),f(45,Yc,4,2,"ng-template"),l(),a(46,"vdr-dt2-column",24),d(47,"translate"),f(48,Jc,1,1,"ng-template"),l(),a(49,"vdr-dt2-column",25),d(50,"translate"),f(51,Zc,1,1,"ng-template"),l(),a(52,"vdr-dt2-column",26),d(53,"translate"),f(54,Kc,8,11,"ng-template"),l(),a(55,"vdr-dt2-column",27),d(56,"translate"),f(57,tm,4,7,"ng-template"),l(),f(58,nm,4,8,"vdr-dt2-column",28),l()(),a(59,"vdr-card",4),d(60,"translate"),a(61,"vdr-product-variant-selector",29),b("productSelected",function(n){h(e);let c=m();return y(c.addItemSelectedVariant=n)}),l(),a(62,"div",30)(63,"div"),f(64,om,10,7,"div",31)(65,am,2,2,"div",1),l(),g(66,"div",32),a(67,"div"),f(68,lm,3,4,"button",33),l()()(),a(69,"vdr-card",4),d(70,"translate"),f(71,pm,2,1,"div",34),l(),a(72,"vdr-card",4),d(73,"translate"),a(74,"form",35),b("submit",function(){h(e);let n=m();return y(n.addSurcharge(n.surchargeForm.value))}),a(75,"div",36)(76,"vdr-form-field",37),d(77,"translate"),g(78,"input",38),l(),a(79,"vdr-form-field",39),d(80,"translate"),g(81,"input",40),l(),a(82,"vdr-form-field",41),d(83,"translate"),g(84,"vdr-currency-input",42),l(),a(85,"vdr-form-field",43),d(86,"translate"),g(87,"input",44),l(),a(88,"vdr-form-field",45),d(89,"translate"),a(90,"vdr-affixed-input",46),g(91,"input",47),l()(),a(92,"vdr-form-field",48),d(93,"translate"),g(94,"input",49),l()(),a(95,"button",50),u(96),d(97,"translate"),l()()()()()}if(t&2){let e,i,n=p.ngIf,c=m();r(2),o("title",s(3,58,"order.modification-summary")),r(2),o("orderSnapshot",c.orderSnapshot)("modifyOrderInput",c.modifyOrderInput)("addedLines",c.addedLines)("shippingAddressForm",c.shippingAddressForm)("billingAddressForm",c.billingAddressForm)("couponCodesControl",c.couponCodesControl)("updatedShippingMethods",c.updatedShippingMethods),r(),o("ngIf",!c.hasModifications()),r(2),o("label",s(8,60,"order.note")),r(2),R("ngModel",c.note),o("disabled",!c.hasModifications()),r(2),R("ngModel",c.recalculateShipping),o("disabled",!c.hasModifications()),r(2),v(s(14,62,"order.modification-recalculate-shipping")),r(2),o("disabled",!c.hasModifications()),r(),_(" ",s(17,64,"order.preview-changes")," "),r(2),o("title",s(19,66,"order.set-coupon-codes")),r(2),o("control",c.couponCodesControl),r(),o("title",s(22,68,"order.shipping-address")),r(3),o("ngIf",!c.editingShippingAddress),r(),o("ngIf",c.editingShippingAddress),r(),o("title",s(27,70,"order.billing-address")),r(3),o("ngIf",!c.editingBillingAddress),r(),o("ngIf",c.editingBillingAddress),r(2),o("paddingX",!1),r(),o("items",n.lines.concat(c.addedLines)),r(),o("heading",s(35,72,"common.id"))("hiddenByDefault",!0),r(3),o("heading",s(38,74,"common.created-at"))("hiddenByDefault",!0),r(3),o("heading",s(41,76,"common.updated-at"))("hiddenByDefault",!0),r(3),o("heading",s(44,78,"common.image")),r(3),o("heading",s(47,80,"order.product-name"))("optional",!1),r(3),o("heading",s(50,82,"order.product-sku")),r(3),o("heading",s(53,84,"order.unit-price")),r(3),o("heading",s(56,86,"order.quantity"))("optional",!1),r(3),o("ngForOf",c.orderLineCustomFields),r(),o("title",s(60,88,"order.add-item-to-order")),r(5),o("ngIf",c.addItemSelectedVariant),r(),o("ngIf",c.addItemSelectedVariant),r(3),o("ngIf",c.addItemSelectedVariant),r(),o("title",s(70,90,"order.shipping")),r(2),o("ngForOf",n.shippingLines),r(),o("title",s(73,92,"order.add-surcharge")),r(2),o("formGroup",c.surchargeForm),r(2),o("label",s(77,94,"common.description")),r(3),o("label",s(80,96,"order.product-sku")),r(3),o("label",s(83,98,"common.price")),r(2),o("currencyCode",n.currencyCode),r(),o("label",x(86,100,"catalog.price-includes-tax-at",A(109,Ac,(e=(e=c.surchargeForm.get("taxRate"))==null?null:e.value)!==null&&e!==void 0?e:0))),r(3),o("label",s(89,103,"order.tax-rate")),r(4),o("label",s(93,105,"order.tax-description")),r(3),o("disabled",c.surchargeForm.invalid||c.surchargeForm.pristine||((i=c.surchargeForm.get("price"))==null?null:i.value)===0||!((i=c.surchargeForm.get("description"))!=null&&i.value)),r(),_(" ",s(97,107,"order.add-surcharge")," ")}}var Fo=(()=>{class t extends Lt{constructor(e,i,n,c,C){super(),this.dataService=e,this.notificationService=i,this.modalService=n,this.orderTransitionService=c,this.changeDetectorRef=C,this.detailForm=new me({}),this.couponCodesControl=new H([]),this.modifyOrderInput={dryRun:!0,orderId:"",addItems:[],adjustOrderLines:[],surcharges:[],note:"",refunds:[],updateShippingAddress:{},updateBillingAddress:{}},this.surchargeForm=new bt({description:new H("",re.minLength(1)),sku:new H(""),price:new H(0),priceIncludesTax:new H(!0),taxRate:new H(0),taxDescription:new H("")}),this.shippingAddressForm=new bt({fullName:new H(""),company:new H(""),streetLine1:new H(""),streetLine2:new H(""),city:new H(""),province:new H(""),postalCode:new H(""),countryCode:new H(""),phoneNumber:new H("")}),this.billingAddressForm=new bt({fullName:new H(""),company:new H(""),streetLine1:new H(""),streetLine2:new H(""),city:new H(""),province:new H(""),postalCode:new H(""),countryCode:new H(""),phoneNumber:new H("")}),this.note="",this.recalculateShipping=!0,this.editingShippingAddress=!1,this.editingBillingAddress=!1,this.updatedShippingMethods={},this.addedVariants=new Map}ngOnInit(){this.init(),this.addressCustomFields=this.getCustomFieldConfig("Address"),this.modifyOrderInput.orderId=this.route.snapshot.paramMap.get("id"),this.orderLineCustomFields=this.getCustomFieldConfig("OrderLine"),this.entity$.pipe(Oe(1)).subscribe(e=>{this.orderSnapshot=this.createOrderSnapshot(e),e.couponCodes.length&&this.couponCodesControl.setValue(e.couponCodes),this.surchargeForm.reset();for(let[i,n]of Object.entries(this.shippingAddressForm.controls))n.setValue(e.shippingAddress?.[i]);this.addAddressCustomFieldsFormGroup(this.shippingAddressForm,e.shippingAddress);for(let[i,n]of Object.entries(this.billingAddressForm.controls))n.setValue(e.billingAddress?.[i]);this.addAddressCustomFieldsFormGroup(this.billingAddressForm,e.billingAddress),this.orderLineCustomFieldsFormArray=new un([]);for(let i of e.lines){let n=new me({});for(let{name:c}of this.orderLineCustomFields)n.addControl(c,new pe(i.customFields[c]));n.valueChanges.pipe(pn(this.destroy$)).subscribe(c=>{let C=this.modifyOrderInput.adjustOrderLines.find(F=>F.orderLineId===i.id);C||(C={orderLineId:i.id,quantity:i.quantity},this.modifyOrderInput.adjustOrderLines.push(C)),this.orderLineCustomFields.length&&(C.customFields=c)}),this.orderLineCustomFieldsFormArray.push(n)}}),this.addItemCustomFieldsFormArray=new un([]),this.addItemCustomFieldsForm=new me({});for(let e of this.orderLineCustomFields)this.addItemCustomFieldsForm.addControl(e.name,new pe);this.availableCountries$=this.dataService.settings.getAvailableCountries().mapSingle(e=>e.countries.items).pipe(Pn(1)),this.dataService.order.getOrderHistory(this.id,{take:1,sort:{createdAt:vt.DESC},filter:{type:{eq:q.ORDER_STATE_TRANSITION}}}).single$.subscribe(({order:e})=>{this.previousState=e?.history.items[0].data.from}),this.uiLanguage$=this.dataService.client.uiState().stream$.pipe(_e(({uiState:e})=>e.language))}ngOnDestroy(){this.destroy()}get addedLines(){let e=i=>i.__typename==="SinglePrice"?i.value:0;return(this.modifyOrderInput.addItems||[]).map(i=>{let n=this.addedVariants.get(i.productVariantId);if(n)return{id:this.getIdForAddedItem(i),featuredAsset:n.productAsset,productVariant:{id:n.productVariantId,name:n.productVariantName,sku:n.sku},unitPrice:e(n.price),unitPriceWithTax:e(n.priceWithTax),quantity:i.quantity}}).filter(ln.notNullOrUndefined)}getIdForAddedItem(e){return`added-${e.productVariantId}-${JSON.stringify(e.customFields||{})}`}transitionToPriorState(e){this.orderTransitionService.transitionToPreModifyingState(e.id,e.nextStates).subscribe(i=>{this.router.navigate([".."],{relativeTo:this.route})})}hasModifications(){let{addItems:e,adjustOrderLines:i,surcharges:n}=this.modifyOrderInput;return!!e?.length||!!n?.length||!!i?.length||this.shippingAddressForm.dirty&&this.shippingAddressForm.valid||this.billingAddressForm.dirty&&this.billingAddressForm.valid||this.couponCodesControl.dirty||Object.entries(this.updatedShippingMethods).length>0}isLineModified(e){return!!this.modifyOrderInput.adjustOrderLines?.find(i=>i.orderLineId===e.id&&i.quantity!==e.quantity)}getInitialLineQuantity(e){let i=this.modifyOrderInput.adjustOrderLines?.find(C=>C.orderLineId===e);if(i)return i.quantity;let n=this.modifyOrderInput.addItems?.find(C=>this.getIdForAddedItem(C)===e);if(n)return n.quantity??1;let c=this.orderSnapshot.lines.find(C=>C.id===e);return c?c.quantity:1}updateLineQuantity(e,i){let{adjustOrderLines:n}=this.modifyOrderInput;if(this.isAddedLine(e)){let c=this.modifyOrderInput.addItems?.find(C=>C.productVariantId===e.productVariant.id);c&&(c.quantity=+i)}else{let c=n?.find(C=>C.orderLineId===e.id);c&&+i===e.quantity&&n?.splice(n?.indexOf(c),1),c||(c={orderLineId:e.id,quantity:+i},n?.push(c)),c.quantity=+i}}isAddedLine(e){return e.id.startsWith("added-")}updateAddedItemQuantity(e,i){let n=this.modifyOrderInput.addItems?.find(c=>c.productVariantId===e.productVariant.id);n&&(n.quantity=+i)}trackByProductVariantId(e,i){return i.productVariant.id}getSelectedItemPrice(e){switch(e?.priceWithTax.__typename){case"SinglePrice":return e.priceWithTax.value;default:return 0}}addItemToOrder(e){if(!e)return;let i=this.orderLineCustomFields.length?this.addItemCustomFieldsForm.value:void 0,n=this.modifyOrderInput.addItems?.find(c=>this.isMatchingAddItemRow(c,e,i));if(n?n.quantity++:(n={productVariantId:e.productVariantId,quantity:1},i&&(n.customFields=i),this.modifyOrderInput.addItems?.push(n)),i){let c=new me({});for(let[C,F]of Object.entries(i))c.addControl(C,new pe(F));this.addItemCustomFieldsFormArray.push(c),c.valueChanges.pipe(pn(this.destroy$)).subscribe(C=>{n&&(n.customFields=C)})}this.addItemCustomFieldsForm.reset({}),this.addItemSelectedVariant=void 0,this.addedVariants.set(e.productVariantId,e)}getShippingLineDetails(e){let i=this.updatedShippingMethods[e.id];return i?{name:i.name||i.code,price:i.priceWithTax}:{name:e.shippingMethod.name||e.shippingMethod.code,price:e.discountedPriceWithTax}}setShippingMethod(e){let i=this.updatedShippingMethods[e]??this.entity?.shippingLines.find(n=>n.id===e)?.shippingMethod;i&&this.dataService.order.getDraftOrderEligibleShippingMethods(this.id).mapSingle(({eligibleShippingMethodsForDraftOrder:n})=>n).pipe(L(n=>this.modalService.fromComponent(Xi,{locals:{eligibleShippingMethods:n,currencyCode:this.entity?.currencyCode,currentSelectionId:i.id}}).pipe(_e(c=>{if(c)return n.find(C=>C.id===c)})))).subscribe(n=>{n&&(this.updatedShippingMethods[e]=n,this.changeDetectorRef.markForCheck())})}isMatchingAddItemRow(e,i,n){return e.productVariantId===i.productVariantId&&JSON.stringify(e.customFields)===JSON.stringify(n)}removeAddedItem(e){this.modifyOrderInput.addItems=this.modifyOrderInput.addItems?.filter(i=>this.getIdForAddedItem(i)!==e)}getSurchargePrices(e){let i=e.priceIncludesTax?e.price:Math.round(e.price*((100+(e.taxRate||0))/100));return{price:e.priceIncludesTax?Math.round(e.price/((100+(e.taxRate||0))/100)):e.price,priceWithTax:i}}addSurcharge(e){this.modifyOrderInput.surcharges?.push(e),this.surchargeForm.reset({price:0,priceIncludesTax:!0,taxRate:0})}removeSurcharge(e){this.modifyOrderInput.surcharges?.splice(e,1)}previewAndModify(e){let i=se(G({},this.modifyOrderInput),{adjustOrderLines:this.modifyOrderInput.adjustOrderLines.map(c=>er((0,Mo.simpleDeepClone)(c),this.orderLineCustomFields))}),n=se(G(G(G({},i),this.billingAddressForm.dirty?{updateBillingAddress:this.billingAddressForm.value}:{}),this.shippingAddressForm.dirty?{updateShippingAddress:this.shippingAddressForm.value}:{}),{dryRun:!0,couponCodes:this.couponCodesControl.dirty?this.couponCodesControl.value:void 0,note:this.note??"",options:{recalculateShipping:this.recalculateShipping}});Object.entries(this.updatedShippingMethods).length&&(n.shippingMethodIds=e.shippingLines.map(c=>this.updatedShippingMethods[c.id]?this.updatedShippingMethods[c.id].id:c.shippingMethod.id)),this.dataService.order.modifyOrder(n).pipe(L(({modifyOrder:c})=>{switch(c.__typename){case"Order":return this.modalService.fromComponent(Po,{size:"xl",closable:!1,locals:{order:c,orderSnapshot:this.orderSnapshot,orderLineCustomFields:this.orderLineCustomFields,modifyOrderInput:n,addedLines:this.addedLines,shippingAddressForm:this.shippingAddressForm,billingAddressForm:this.billingAddressForm,couponCodesControl:this.couponCodesControl,updatedShippingMethods:this.updatedShippingMethods}});case"InsufficientStockError":case"NegativeQuantityError":case"NoChangesSpecifiedError":case"OrderLimitError":case"OrderModificationStateError":case"PaymentMethodMissingError":case"RefundPaymentIdMissingError":case"CouponCodeLimitError":case"CouponCodeExpiredError":case"IneligibleShippingMethodError":case"CouponCodeInvalidError":return this.notificationService.error(c.message),ce(!1);case null:case void 0:return ce(!1);default:(0,ln.assertNever)(c)}}),L(c=>{if(!c||c.result===st.Cancel)return this.dataService.order.getOrder(this.id).mapSingle(()=>!1);{let C=se(G({},n),{dryRun:!1});return c.result===st.Refund&&(C.refunds=c.refunds),this.dataService.order.modifyOrder(C).pipe(L(({modifyOrder:F})=>{if(F.__typename==="Order"){let dn=0<F.totalWithTax-this.orderSnapshot.totalWithTax?"ArrangingAdditionalPayment":this.previousState;return this.dataService.order.transitionToState(e.id,dn).pipe(ii(!0))}else return this.notificationService.error(F.message),Fe}))}})).subscribe(c=>{c&&this.router.navigate(["../"],{relativeTo:this.route})})}addAddressCustomFieldsFormGroup(e,i){if(i&&this.addressCustomFields.length){let n=new me({});for(let c of this.addressCustomFields){let C=c.name,F=i.customFields?.[C];n.addControl(C,new pe(F))}e.addControl("customFields",n)}}createOrderSnapshot(e){return{totalWithTax:e.totalWithTax,currencyCode:e.currencyCode,couponCodes:e.couponCodes,lines:[...e.lines].map(i=>G({},i)),shippingLines:[...e.shippingLines].map(i=>G({},i))}}setFormValues(e,i){}static{this.\u0275fac=function(i){return new(i||t)(P(Z),P(it),P(je),P(Vt),P(Ve))}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-order-editor"]],standalone:!1,features:[Ie],decls:4,vars:4,consts:[["imagePlaceholder",""],[4,"ngIf"],[1,"flex","clr-align-items-center"],[1,"btn","btn-secondary",3,"click"],[3,"title"],[3,"orderSnapshot","modifyOrderInput","addedLines","shippingAddressForm","billingAddressForm","couponCodesControl","updatedShippingMethods"],["class","no-modifications",4,"ngIf"],[1,"summary-controls"],[3,"label"],["name","note","required","",3,"ngModelChange","ngModel","disabled"],[1,"flex","items-center"],["type","checkbox",3,"ngModelChange","ngModel","disabled"],[1,"ml-1"],[1,"btn","btn-primary","mt-2",3,"click","disabled"],[3,"control"],["vdrCardControls",""],[3,"address",4,"ngIf"],[3,"formGroup","availableCountries","customFields",4,"ngIf"],[3,"paddingX"],["id","modify-order",1,"order-table",3,"items"],["id","id",3,"heading","hiddenByDefault"],["id","created-at",3,"heading","hiddenByDefault"],["id","updated-at",3,"heading","hiddenByDefault"],["id","image",3,"heading"],["id","product-name",3,"heading","optional"],["id","product-sku",3,"heading"],["id","unit-price",3,"heading"],["id","quantity",3,"heading","optional"],[3,"id","heading","hiddenByDefault",4,"ngFor","ngForOf"],[1,"mb-4",3,"productSelected"],[1,"flex"],["class","flex mb-4",4,"ngIf"],[1,"flex-spacer"],["class","btn btn-secondary",3,"disabled","click",4,"ngIf"],["class","flex items-center",4,"ngFor","ngForOf"],[3,"submit","formGroup"],[1,"form-grid"],["for","description",3,"label"],["id","description","type","text","formControlName","description"],["for","sku",3,"label"],["id","sku","type","text","formControlName","sku"],["for","price",3,"label"],["id","price","formControlName","price",3,"currencyCode"],["for","priceIncludesTax",3,"label"],["id","priceIncludesTax","type","checkbox","clrCheckbox","","formControlName","priceIncludesTax"],["for","taxRate",3,"label"],["suffix","%"],["id","taxRate","type","number","min","0","max","100","formControlName","taxRate"],["for","taxDescription",3,"label"],["id","taxDescription","type","text","formControlName","taxDescription"],[1,"btn","btn-secondary","mt-2",3,"disabled"],[1,"no-modifications"],[1,"button-small",3,"click","title"],["shape","edit"],[3,"address"],[3,"formGroup","availableCountries","customFields"],[1,"image-placeholder"],[3,"src",4,"ngIf","ngIfElse"],[3,"src"],[1,"placeholder"],["shape","image","size","48"],[1,"text-center"],[1,"net-price",3,"title"],["type","number","min","0",1,"draft-qty","mr-1",3,"input","value"],["class","button-small",3,"click",4,"ngIf"],[3,"line","payments"],[3,"line","allOrderFulfillments","orderState"],[1,"button-small",3,"click"],["shape","trash"],[3,"id","heading","hiddenByDefault"],[3,"compact","entityName","customField","customFieldsFormGroup"],[1,"flex","mb-4"],["class","mr-4 add-item-thumb",3,"src",4,"ngIf"],[1,"mr-4"],[1,"mr-4","add-item-thumb",3,"src"],["entityName","Order",3,"customFields","customFieldsFormGroup"],[1,"btn","btn-secondary",3,"click","disabled"],[1,"mx-1"]],template:function(i,n){i&1&&(a(0,"vdr-page-block"),f(1,Vc,7,3,"vdr-action-bar",1),d(2,"async"),l(),f(3,sm,98,111,"vdr-page-detail-layout",1)),i&2&&(r(),o("ngIf",s(2,2,n.entity$)),r(2),o("ngIf",n.entity))},dependencies:[B,Ce,tt,M,w,St,ne,Ne,xt,z,Ze,gi,$e,et,oe,Ke,It,at,Ft,ot,hr,Dt,Mi,ve,U,Ge,Pi,ki,nt,lt,Ue,pt,wt,Pt,ye,rt,Yi,Nt,Ui,an,W,I,br,Pe,he,k],styles:[`.order-table[_ngcontent-%COMP%]   .is-cancelled[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{text-decoration:line-through;background-color:var(--color-component-bg-200)}.order-table[_ngcontent-%COMP%]   .sub-total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   .total[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-weight:700;border-top:1px dashed var(--color-component-border-200)}.order-table[_ngcontent-%COMP%]   td.custom-fields-row[_ngcontent-%COMP%]{border-top-style:dashed;border-top-color:var(--color-grey-200)}.order-table[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{border-radius:var(--border-radius-img)}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}.order-table[_ngcontent-%COMP%]   .order-line-custom-fields[_ngcontent-%COMP%]   .custom-field[_ngcontent-%COMP%]{text-align:start;max-width:200px;overflow:hidden;text-overflow:ellipsis;margin-bottom:6px;margin-inline-end:18px}.order-table[_ngcontent-%COMP%]   .draft-qty[_ngcontent-%COMP%]{max-width:48px}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{background-color:var(--color-component-bg-100)}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]   .custom-field-ellipsis[_ngcontent-%COMP%]{color:var(--color-text-300)}.order-table[_ngcontent-%COMP%]   .net-price[_ngcontent-%COMP%]{font-size:11px;color:var(--color-text-300);line-height:14px}.order-table[_ngcontent-%COMP%]   .promotions-label[_ngcontent-%COMP%]{text-decoration:underline dotted var(--color-text-200);font-size:11px;margin-top:6px;cursor:pointer;text-transform:lowercase}.order-table[_ngcontent-%COMP%]   .thumb[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px;height:50px}.order-table[_ngcontent-%COMP%]   .shipping-method-name[_ngcontent-%COMP%]{font-size:var(--font-size-xs);margin-inline-end:2px}.order-table[_ngcontent-%COMP%]   .order-placed-quantity[_ngcontent-%COMP%]{text-decoration:line-through;color:var(--color-text-300);margin-inline-end:2px}.order-table[_ngcontent-%COMP%]   tr.modified[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:var(--color-warning-100)}.order-table[_ngcontent-%COMP%]   .order-line-custom-field[_ngcontent-%COMP%]{text-align:start}.add-item-thumb[_ngcontent-%COMP%]{max-width:50px}.no-modifications[_ngcontent-%COMP%]{color:var(--color-grey-400)}.summary-controls[_ngcontent-%COMP%]{border-top:1px solid var(--color-weight-200);margin-top:calc(var(--space-unit) * 2);padding-top:calc(var(--space-unit) * 1)}
/*# sourceMappingURL=order-editor.component-J3BGLLWY.css.map */`],changeDetection:0})}}return t})();var cm=()=>["CreateOrder"],mm=()=>["./draft/create"],um=t=>["./draft",t],fm=t=>["./",t];function _m(t,p){t&1&&(a(0,"a",17),g(1,"clr-icon",18),u(2),d(3,"translate"),l()),t&2&&(o("routerLink",Gt(4,mm)),r(2),_(" ",s(3,2,"catalog.create-draft-order")," "))}function gm(t,p){t&1&&(T(0),f(1,_m,4,5,"a",16),D()),t&2&&(r(),o("vdrIfPermissions",Gt(1,cm)))}function Cm(t,p){if(t&1&&u(0),t&2){let e=p.item;_(" ",e.id," ")}}function vm(t,p){if(t&1&&(u(0),d(1,"localeDate")),t&2){let e=p.item;_(" ",x(1,1,e.createdAt,"short")," ")}}function hm(t,p){if(t&1&&(a(0,"a",19)(1,"span"),u(2),l(),g(3,"clr-icon",20),l()),t&2){let e=p.item;o("routerLink",e.state==="Draft"?A(2,um,e.id):A(4,fm,e.id)),r(2),v(e.code)}}function ym(t,p){if(t&1){let e=S();a(0,"vdr-customer-label",21),b("click",function(n){return h(e),y(n.stopPropagation())}),l()}if(t&2){let e=p.item;o("customer",e.customer)}}function xm(t,p){t&1&&(a(0,"vdr-chip"),u(1),d(2,"translate"),l()),t&2&&(r(),v(s(2,1,"order.order-type-regular")))}function bm(t,p){t&1&&(a(0,"vdr-chip"),u(1),d(2,"translate"),l()),t&2&&(r(),v(s(2,1,"order.order-type-aggregate")))}function Sm(t,p){t&1&&(a(0,"vdr-chip"),u(1),d(2,"translate"),l()),t&2&&(r(),v(s(2,1,"order.order-type-seller")))}function Om(t,p){if(t&1&&f(0,xm,3,3,"vdr-chip",1)(1,bm,3,3,"vdr-chip",1)(2,Sm,3,3,"vdr-chip",1),t&2){let e=p.item,i=m();o("ngIf",e.type===i.OrderType.Regular),r(),o("ngIf",e.type===i.OrderType.Aggregate),r(),o("ngIf",e.type===i.OrderType.Seller)}}function Im(t,p){if(t&1&&g(0,"vdr-order-state-label",22),t&2){let e=p.item;o("state",e.state)}}function Tm(t,p){if(t&1&&(u(0),d(1,"localeCurrency")),t&2){let e=p.item;_(" ",x(1,1,e.totalWithTax,e.currencyCode)," ")}}function Dm(t,p){if(t&1&&(u(0),d(1,"timeAgo")),t&2){let e=p.item;_(" ",s(1,1,e.updatedAt)," ")}}function wm(t,p){if(t&1&&(u(0),d(1,"localeDate")),t&2){let e=p.item;_(" ",x(1,1,e.orderPlacedAt,"short")," ")}}function Pm(t,p){if(t&1&&u(0),t&2){let e=p.item,i=m();_(" ",i.getShippingNames(e)," ")}}function Mm(t,p){if(t&1&&g(0,"vdr-dt2-custom-field-column",23),t&2){let e=p.$implicit,i=m();o("customField",e)("sorts",i.sorts)}}var Eo=(()=>{class t extends Br{constructor(e,i){super(),this.serverConfigService=e,this.channelService=i,this.dataTableListId="order-list",this.orderStates=this.serverConfigService.getOrderProcessStates().map(n=>n.name),this.OrderType=ct,this.customFields=this.getCustomFieldConfig("Order"),this.filters=this.createFilterCollection().addIdFilter().addDateFilters().addFilter({name:"active",type:{kind:"boolean"},label:"order.filter-is-active",filterField:"active"}).addFilter({name:"totalWithTax",type:{kind:"number",inputType:"currency",currencyCode:"USD"},label:"order.total",filterField:"totalWithTax"}).addFilter({name:"state",type:{kind:"select",options:this.orderStates.map(n=>({value:n,label:Mr(n)}))},label:"order.state",filterField:"state"}).addFilter({name:"type",type:{kind:"select",options:[{value:ct.Regular,label:"order.order-type-regular"},{value:ct.Aggregate,label:"order.order-type-aggregate"},{value:ct.Seller,label:"order.order-type-seller"}]},label:"order.order-type",filterField:"type"}).addFilter({name:"orderPlacedAt",type:{kind:"dateRange"},label:"order.placed-at",filterField:"orderPlacedAt"}).addFilter({name:"customerLastName",type:{kind:"text"},label:"customer.last-name",filterField:"customerLastName"}).addFilter({name:"transactionId",type:{kind:"text"},label:"order.transaction-id",filterField:"transactionId"}).addCustomFieldFilters(this.customFields).connectToRoute(this.route),this.sorts=this.createSortCollection().defaultSort("updatedAt","DESC").addSort({name:"id"}).addSort({name:"createdAt"}).addSort({name:"updatedAt"}).addSort({name:"orderPlacedAt"}).addSort({name:"customerLastName"}).addSort({name:"state"}).addSort({name:"totalWithTax"}).addCustomFieldSorts(this.customFields).connectToRoute(this.route),this.canCreateDraftOrder=!1,this.activeChannelIsDefaultChannel=!1,super.configure({document:zn,getItems:n=>n.orders,setVariables:(n,c)=>this.createQueryOptions(n,c,this.searchTermControl.value),refreshListOnChanges:[this.filters.valueChanges,this.sorts.valueChanges]}),this.canCreateDraftOrder=!!this.serverConfigService.getOrderProcessStates().find(n=>n.name==="Created")?.to.includes("Draft")}ngOnInit(){super.ngOnInit();let e=this.channelService.defaultChannelIsActive$.pipe(ze(i=>this.activeChannelIsDefaultChannel=i));super.refreshListOnChanges(this.filters.valueChanges,this.sorts.valueChanges,e)}createQueryOptions(e,i,n){let c=this.filters.createFilterInput();return this.activeChannelIsDefaultChannel&&(c=G({},c??{})),n&&(c={code:{contains:n},customerLastName:{contains:n},transactionId:{contains:n}}),{options:{skip:e,take:i,filter:G({},c??{}),filterOperator:n?mn.OR:mn.AND,sort:this.sorts.createSortInput()}}}getShippingNames(e){return e.shippingLines.length?e.shippingLines.map(i=>i.shippingMethod.name).join(", "):""}static{this.\u0275fac=function(i){return new(i||t)(P(ht),P(wi))}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-order-list"]],standalone:!1,features:[Ie],decls:45,vars:61,consts:[["locationId","order-list"],[4,"ngIf"],[1,"mt-2",3,"pageChange","itemsPerPageChange","visibleColumnsChange","id","items","itemsPerPage","totalItems","currentPage","filters"],["locationId","order-list",3,"hostComponent","selectionManager"],[3,"searchTermControl","searchTermPlaceholder"],["id","id",3,"heading","hiddenByDefault","sort"],["id","created-at",3,"heading","hiddenByDefault"],["id","code",3,"heading","optional"],["id","customer",3,"heading","sort"],["id","order-type",3,"heading","hiddenByDefault"],["id","state",3,"heading","sort"],["id","total",3,"heading","sort"],["id","updated-at",3,"heading"],["id","placed-at",3,"heading","sort"],["id","shipping",3,"heading"],[3,"customField","sorts",4,"ngFor","ngForOf"],["class","btn",3,"routerLink",4,"vdrIfPermissions"],[1,"btn",3,"routerLink"],["shape","plus"],[1,"button-ghost",3,"routerLink"],["shape","arrow right"],[3,"click","customer"],[3,"state"],[3,"customField","sorts"]],template:function(i,n){i&1&&(a(0,"vdr-page-block")(1,"vdr-action-bar")(2,"vdr-ab-right"),g(3,"vdr-action-bar-items",0),f(4,gm,2,2,"ng-container",1),g(5,"vdr-action-bar-dropdown-menu",0),l()()(),a(6,"vdr-data-table-2",2),d(7,"async"),d(8,"async"),d(9,"async"),d(10,"async"),b("pageChange",function(C){return n.setPageNumber(C)})("itemsPerPageChange",function(C){return n.setItemsPerPage(C)})("visibleColumnsChange",function(C){return n.setVisibleColumns(C)}),g(11,"vdr-bulk-action-menu",3)(12,"vdr-dt2-search",4),d(13,"translate"),a(14,"vdr-dt2-column",5),d(15,"translate"),f(16,Cm,1,1,"ng-template"),l(),a(17,"vdr-dt2-column",6),d(18,"translate"),f(19,vm,2,4,"ng-template"),l(),a(20,"vdr-dt2-column",7),d(21,"translate"),f(22,hm,4,6,"ng-template"),l(),a(23,"vdr-dt2-column",8),d(24,"translate"),f(25,ym,1,1,"ng-template"),l(),a(26,"vdr-dt2-column",9),d(27,"translate"),f(28,Om,3,3,"ng-template"),l(),a(29,"vdr-dt2-column",10),d(30,"translate"),f(31,Im,1,1,"ng-template"),l(),a(32,"vdr-dt2-column",11),d(33,"translate"),f(34,Tm,2,4,"ng-template"),l(),a(35,"vdr-dt2-column",12),d(36,"translate"),f(37,Dm,2,3,"ng-template"),l(),a(38,"vdr-dt2-column",13),d(39,"translate"),f(40,wm,2,4,"ng-template"),l(),a(41,"vdr-dt2-column",14),d(42,"translate"),f(43,Pm,1,1,"ng-template"),l(),f(44,Mm,1,2,"vdr-dt2-custom-field-column",15),l()),i&2&&(r(4),o("ngIf",n.canCreateDraftOrder),r(2),o("id",n.dataTableListId)("items",s(7,31,n.items$))("itemsPerPage",s(8,33,n.itemsPerPage$))("totalItems",s(9,35,n.totalItems$))("currentPage",s(10,37,n.currentPage$))("filters",n.filters),r(5),o("hostComponent",n)("selectionManager",n.selectionManager),r(),o("searchTermControl",n.searchTermControl)("searchTermPlaceholder",s(13,39,"order.search-by-order-filters")),r(2),o("heading",s(15,41,"common.id"))("hiddenByDefault",!0)("sort",n.sorts.get("id")),r(3),o("heading",s(18,43,"common.created-at"))("hiddenByDefault",!0),r(3),o("heading",s(21,45,"common.code"))("optional",!1),r(3),o("heading",s(24,47,"order.customer"))("sort",n.sorts.get("customerLastName")),r(3),o("heading",s(27,49,"order.order-type"))("hiddenByDefault",!0),r(3),o("heading",s(30,51,"order.state"))("sort",n.sorts.get("state")),r(3),o("heading",s(33,53,"order.total"))("sort",n.sorts.get("totalWithTax")),r(3),o("heading",s(36,55,"common.updated-at")),r(3),o("heading",s(39,57,"order.placed-at"))("sort",n.sorts.get("orderPlacedAt")),r(3),o("heading",s(42,59,"order.shipping")),r(3),o("ngForOf",n.customFields))},dependencies:[B,M,w,Re,at,ot,kt,ue,Et,dt,Bi,Mt,Sr,lt,Ue,Or,Ai,pt,W,I,Fr,he,k],styles:[`.search-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:baseline;width:100%;max-width:100vw;margin-bottom:6px}.filter-presets[_ngcontent-%COMP%]{max-width:90vw;overflow-x:auto}.search-input[_ngcontent-%COMP%]{margin-top:6px;min-width:300px}.custom-filters[_ngcontent-%COMP%]{overflow:hidden;max-height:0;padding-bottom:6px}.custom-filters.expanded[_ngcontent-%COMP%]{max-height:initial}.custom-filters[_ngcontent-%COMP%] > form[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.custom-filters[_ngcontent-%COMP%] > form[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{width:100%}ng-select[_ngcontent-%COMP%]{flex:1;min-width:200px;height:36px}ng-select[_ngcontent-%COMP%]     .ng-select-container{height:36px}
/*# sourceMappingURL=order-list.component-SBNMQZQY.css.map */`],changeDetection:0})}}return t})();function Fm(t,p){if(t&1&&(a(0,"vdr-labeled-data",0),d(1,"translate"),u(2),l()),t&2){let e=m();o("label",s(1,2,"order.transaction-id")),r(2),_(" ",e.refund.transactionId,`
`)}}var Lf=(()=>{class t{static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=O({type:t,selectors:[["vdr-refund-detail"]],inputs:{refund:"refund",currencyCode:"currencyCode"},standalone:!1,decls:8,vars:12,consts:[[3,"label"],[3,"label",4,"ngIf"],[3,"value"]],template:function(i,n){i&1&&(a(0,"vdr-labeled-data",0),d(1,"translate"),u(2),d(3,"localeCurrency"),l(),f(4,Fm,3,4,"vdr-labeled-data",1),a(5,"vdr-labeled-data",0),d(6,"translate"),g(7,"vdr-object-tree",2),l()),i&2&&(o("label",s(1,5,"order.amount")),r(2),_(" ",x(3,7,n.refund.total,n.currencyCode),`
`),r(2),o("ngIf",n.refund.transactionId),r(),o("label",s(6,10,"order.payment-metadata")),r(2),o("value",n.refund.metadata))},dependencies:[w,X,He,I,k],styles:["/*# sourceMappingURL=refund-detail.component-JBEV26B3.css.map */"],changeDetection:0})}}return t})();var Nf=be`
    query GetCustomerAddresses($customerId: ID!) {
        customer(id: $customerId) {
            id
            addresses {
                ...Address
            }
        }
    }
    ${Zn}
`;var Em=be`
    query GetOrderState($id: ID!) {
        order(id: $id) {
            id
            state
        }
    }
`,Zt=(()=>{class t{constructor(e,i){this.dataService=e,this.router=i}canActivate(e,i){let n=i.url.includes("orders/draft"),c=i.url.includes("/modify"),C=e.paramMap.get("id");return n?C==="create"?this.dataService.order.createDraftOrder().pipe(_e(({createDraftOrder:F})=>this.router.parseUrl(`/orders/draft/${F.id}`))):!0:this.dataService.query(Em,{id:C}).single$.pipe(_e(({order:F})=>F?.state==="Modifying"&&!c?this.router.parseUrl(`/orders/${C}/modify`):!0))}static{this.\u0275fac=function(i){return new(i||t)(ke(Z),ke(fi))}}static{this.\u0275prov=oi({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var Bo=t=>[{path:"",component:Bt,data:{locationId:"order-list",breadcrumb:"breadcrumb.orders"},children:t.getPageTabRoutes("order-list")},{path:"draft/:id",component:Bt,canActivate:[Zt],data:{locationId:"draft-order-detail",breadcrumb:{label:"breadcrumb.orders",link:["../"]}},children:t.getPageTabRoutes("draft-order-detail")},{path:":id",component:Bt,canActivate:[Zt],data:{locationId:"order-detail",breadcrumb:{label:"breadcrumb.orders",link:["../"]}},children:t.getPageTabRoutes("order-detail")},{path:":aggregateOrderId/seller-orders/:id",component:Bt,canActivate:[Zt],data:{locationId:"order-detail",breadcrumb:{label:"breadcrumb.orders",link:["../"]}},children:t.getPageTabRoutes("order-detail")},{path:":id/modify",component:Bt,canActivate:[Zt],data:{locationId:"modify-order",breadcrumb:{label:"breadcrumb.orders",link:["../"]}},children:t.getPageTabRoutes("modify-order")}];var yg=(()=>{class t{static{this.hasRegisteredTabsAndBulkActions=!1}constructor(e){t.hasRegisteredTabsAndBulkActions||(e.registerPageTab({priority:0,location:"order-list",tab:"order.orders",route:"",component:Eo}),e.registerPageTab({priority:0,location:"order-detail",tab:"order.order",route:"",component:ji({component:Do,query:mi,entityKey:"order",getBreadcrumbs:i=>i?.type!==ct.Seller||!i?.aggregateOrder?[{label:`${i?.code}`,link:[i?.id]}]:[{label:`${i?.aggregateOrder?.code}`,link:["/orders/",i?.aggregateOrder?.id]},{label:"breadcrumb.seller-orders",link:["/orders/",i?.aggregateOrder?.id]},{label:`${i?.code}`,link:[i?.id]}]})}),e.registerPageTab({priority:0,location:"draft-order-detail",tab:"order.order",route:"",component:ji({component:Jr,query:mi,entityKey:"order",getBreadcrumbs:i=>[{label:"order.draft-order",link:[i?.id]}]})}),e.registerPageTab({priority:0,location:"modify-order",tab:"order.order",route:"",component:ji({component:Fo,query:mi,entityKey:"order",getBreadcrumbs:i=>[{label:i?.code||"order",link:["/orders/",i?.id]},{label:"breadcrumb.modifying-order",link:[i?.id]}]})}),t.hasRegisteredTabsAndBulkActions=!0)}static{this.\u0275fac=function(i){return new(i||t)(ke(Vi))}}static{this.\u0275mod=Bn({type:t})}static{this.\u0275inj=Mn({providers:[{provide:tr,useFactory:e=>Bo(e),multi:!0,deps:[Vi]}],imports:[Er,ir.forChild([])]})}}return t})();export{Ar as AddManualPaymentDialogComponent,Vr as CancelOrderDialogComponent,Ui as CouponCodeSelectorComponent,Jr as DraftOrderDetailComponent,Ur as DraftOrderVariantSelectorComponent,Zr as FulfillOrderDialogComponent,no as FulfillmentCardComponent,Ki as FulfillmentDetailComponent,to as FulfillmentStateLabelComponent,e0 as GET_COUPON_CODE_SELECTOR_PROMOTION_LIST,Nf as GET_CUSTOMER_ADDRESSES,Em as GET_ORDER_STATE,Oo as GET_SELLER_ORDERS,Yi as LineFulfillmentComponent,Nt as LineRefundsComponent,ro as ModificationDetailComponent,en as NODE_HEIGHT,mf as ORDER_DETAIL_QUERY,jr as OrderCustomFieldsCardComponent,Hr as OrderDataTableComponent,Do as OrderDetailComponent,st as OrderEditResultType,Fo as OrderEditorComponent,Po as OrderEditsPreviewDialogComponent,Zt as OrderGuard,So as OrderHistoryComponent,ho as OrderHistoryEntryHostComponent,Eo as OrderListComponent,an as OrderModificationSummaryComponent,yg as OrderModule,vo as OrderPaymentCardComponent,oo as OrderProcessEdgeComponent,ao as OrderProcessGraphComponent,lo as OrderProcessGraphDialogComponent,tn as OrderProcessNodeComponent,$r as OrderStateSelectDialogComponent,$t as OrderTableComponent,Ji as OrderTotalColumnComponent,Vt as OrderTransitionService,rn as PaymentDetailComponent,nn as PaymentForRefundSelectorComponent,_o as PaymentStateLabelComponent,Lf as RefundDetailComponent,uo as RefundOrderDialogComponent,go as RefundStateLabelComponent,uf as SET_ORDER_CUSTOMER_MUTATION,fn as SelectAddressDialogComponent,Qi as SelectCustomerDialogComponent,Xi as SelectShippingMethodDialogComponent,To as SellerOrdersCardComponent,fo as SettleRefundDialogComponent,qt as SimpleItemListComponent,Bo as createRoutes,Wi as getRefundablePayments};
//# sourceMappingURL=chunk-ZRWMV2P4.js.map
